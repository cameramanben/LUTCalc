function LUTColourSpace(){this.ready=0,this.lutMaker=new LUTs,this.g=[],this.csIn=[],this.csOut=[],this.csM=[],this.CATs=new CSCAT,this.sysCAT="CIECAT02",this.sysCATIdx=this.CATs.setDefault(this.sysCAT),this.matList=[],this.xyzMatrices(),this.system=this.g[this.sysIdx],this.system.fromXYZ=this.mInverse(this.system.toXYZ),this.y=new Float64Array([.2126,.7152,.0722]),this.systemMatrices(),this.setSaturated(),this.Ys={},this.setYCoeffs(),this.defLUTs={},this.nul=!1,this.isTrans=!1,this.ver=0,this.curIn=0,this.curOut=0,this.planck=new Planck(this.lutMaker),this.system.CCT=this.planck.getCCT(this.system.white),this.system.Dxy=this.planck.getDxy(this.system.white,this.system.CCT),this.wb=new CSWB(this.system.white,this.system.toXYZ,this.planck,this.CATs),this.curHG=0,this.hgLow=0,this.hgHigh=0,this.hgLin=!0,this.hgLowStop=0,this.hgHighStop=0,this.sdrSatGamma=1.2,this.LA=0,this.pass=0,this.inList=[],this.outList=[],this.laList=[],this.csInSub=[],this.csOutSub=[],this.csLASub=[],0<new Int8Array(new Int16Array([1]).buffer)[0]?this.isLE=!0:this.isLE=!1,this.asc=new Float64Array([1,1,1,0,0,0,1,1,1,1]),this.initPSSTCDL(),this.fcVals=new Float64Array([78125e-8,.002915728,.174110113,.229739671,.354307008,.451585762,.885767519,1.128964405,10.39683067,12.36398501]),this.gLimLin=!1,this.gLimL=1,this.gLimY=new Float64Array(this.y.buffer.slice(0)),this.gLimGIn=0,this.gLimGOut=0,this.gLimC=!1,this.gLimB=!0,this.doHG=!1,this.doWB=!1,this.doASCCDL=!1,this.doPSSTCDL=!1,this.doGamutLim=!1,this.doFC=!1,this.loadColourSpaces(),this.buildColourSquare(),this.buildMultiColours(),this.ready++}function CCTxy(t){this.lut=t,this.u=.32,this.v=.21}function Planck(t){this.setLoci(t),this.slope=new CCTxy(this.loci),this.brent=new Brent(this.slope,0,5e4),this.brent.setDelta(1e3)}function CSCAT(){this.def=0,this.names=[],this.lower=[],this.M=[],this.models()}function CSWB(t,i,s,h){this.fromSys=i,this.toSys=this.mInverse(i),this.planck=s,this.sysWhiteXYZ=new Float64Array([t[0]/t[1],1,(1-t[0]-t[1])/t[1]]),this.CCT0=this.planck.getCCT(t),this.Duv0=this.planck.getDuvMag(t,this.CCT0)[0];s=this.planck.uv(this.CCT0),t=this.planck.Duv(this.CCT0);s[0]+=this.Duv0*Math.cos(t[0]),s[1]+=this.Duv0*Math.sin(t[0]),this.w0=this.planck.uv2xy(s),this.W0=this.planck.uv2XYZ(s),this.CATs=h,this.ref=5500,this.ct=5500,this.lamp=5500,this.duv=0,this.dpl=0,this.setModel(0)}function CSSL3(){}function CSLogC(t){var i,s,h,r,e,o;this.nomEI=400,this.blackSig=.003907,this.blackOff=0,this.midGray=.01,this.encGain=.256598,this.encOff=.391007,this.iso=t,this.cut=1/9,r=1/(this.cut*Math.LN10),e=Math.log(this.cut)/Math.LN10-r*this.cut,o=t/this.nomEI,o=this.midGray/o,i=(Math.log(t/this.nomEI)/Math.log(2)*(.89-1)/3+1)*this.encGain,s=this.encOff;for(var a=0;a<3;a++)h=((95/1023-s)/i-e)/r,s=this.encOff-Math.log(1+h)/Math.LN10*i;this.a=1/o,this.b=h-this.blackSig/o,this.e=r*this.a*i,this.ff=i*(r*this.b+e)+s,o=4/(.18*t),t=this.blackSig,this.b=this.b+this.a*t,this.a=this.a*o,this.ff=this.ff+this.e*t,this.e=this.e*o,this.c=i,this.d=s,this.cut=(this.cut-this.b)/this.a,this.ecf=this.e*this.cut+this.ff}function CSVLog(){}function CSMatrix(t,i,s){this.name=t,this.m=i,this.mInv=this.mInverse(this.m),this.wp=s}function CSToneCurve(t,i){this.name=t,this.o=i.isOut,i.isOut?(this.m1=i.linMatrix,this.m2=i.tcMatrix):(this.m1=this.mInverse(i.linMatrix),this.m2=this.mInverse(i.tcMatrix)),this.l=i.logBase,this.tc=i.tc,this.wp=i.wp,this.sb=!0,this.sb=i.sb,this.cB=!1,this.cB=i.cb}function CSToneCurvePlus(t,i){this.name=t,this.o=i.isOut,i.isOut?(this.m1=i.linMatrix,this.m2=i.tcMatrix):(this.m1=this.mInverse(i.linMatrix),this.m2=this.mInverse(i.tcMatrix)),this.l=i.logBase,this.tc=i.tc,this.wp=i.wp,this.lY=i.linY,this.lC=i.linClamp,this.tcY=i.tcY,this.tcC=i.tcClamp,this.sb=!0,this.sb=i.sb,this.cB=!1,this.cB=i.cb}function CSLUT(t,i,s,h){this.name=t,this.wp=i.wp.buffer,void 0!==i.format?this.format=i.format:this.format="cube",void 0!==i.min?this.min=i.min:this.min=[0,0,0],void 0!==i.max?this.max=i.max:this.max=[1,1,1],this.lutMaker=s,this.colours=h,"number"==typeof i.genInt&&"number"==typeof i.preInt?(this.genInt=i.genInt,this.preInt=i.preInt):(this.genInt=1,this.preInt=1),this.im=!1,this.natTF=0,this.inL=!1}function CSCanonIDT(t,i,s,h){this.name=t,this.day=i,this.toSys=s,this.wp=h,this.setParams()}function CSLabSpace(t,i,s,h,r,e){this.name=t,this.toSys=r,this.XYZ=e,this.Xn=i/s,this.Yn=1,this.Zn=h/s,this.d=6/29,this.d3=Math.pow(this.d,3),this.oneover3d2=1/(3*this.d*this.d),this.threed2=3*this.d*this.d,this.fourover29=4/29,this.p1=24389/2700,this.p2=.16,this.p3=216/24389,this.p4=.08}function LUTCSWorker(){this.cs=new LUTColourSpace,addEventListener("message",function(t){var i=t.data;if(void 0!==i.t)if(0!==i.t&&i.t<20&&i.v!==lutCSWorker.cs.ver)postMessage({p:i.p,t:i.t,v:i.v,resend:!0,d:i.d});else switch(i.t){case 0:lutCSWorker.sendCSMessage(lutCSWorker.cs.setParams(i.d));break;case 1:lutCSWorker.sendCSMessage(lutCSWorker.cs.calc(i.p,i.t,i.d,!0));break;case 2:lutCSWorker.sendCSMessage(lutCSWorker.cs.laCalc(i.p,i.t,i.d));break;case 3:lutCSWorker.sendCSMessage(lutCSWorker.cs.recalcMatrix(i.p,i.t,i.d));break;case 4:lutCSWorker.sendCSMessage(lutCSWorker.cs.loadDefaultLUTs(i.p,i.t,i.d));break;case 5:lutCSWorker.sendCSMessage(lutCSWorker.cs.getLists(i.p,i.t));break;case 6:lutCSWorker.sendCSMessage(lutCSWorker.cs.setLA(i.p,i.t,i.d));break;case 7:lutCSWorker.sendCSMessage(lutCSWorker.cs.setLATitle(i.p,i.t,i.d));break;case 8:lutCSWorker.sendCSMessage(lutCSWorker.cs.getColSqr(i.p,i.t,i.d));break;case 9:lutCSWorker.sendCSMessage(lutCSWorker.cs.multiColours(i.p,i.t,i.d));break;case 10:lutCSWorker.sendCSMessage(lutCSWorker.cs.ioNames(i.p,i.t));break;case 11:lutCSWorker.sendCSMessage(lutCSWorker.cs.chartVals(i.p,i.t,i.d));break;case 12:lutCSWorker.sendCSMessage(lutCSWorker.cs.calc(i.p,i.t,i.d,!1));break;case 14:lutCSWorker.sendCSMessage(lutCSWorker.cs.previewLin(i.p,i.t,i.d));break;case 15:lutCSWorker.sendCSMessage(lutCSWorker.cs.getPrimaries(i.p,i.t));break;case 16:lutCSWorker.sendCSMessage(lutCSWorker.cs.psstColours(i.p,i.t));break;case 17:lutCSWorker.sendCSMessage(lutCSWorker.cs.getCATs(i.p,i.t));break;case 18:lutCSWorker.sendCSMessage(lutCSWorker.cs.getCCTDuv(i.p,i.t,i.d));break;case 19:lutCSWorker.sendCSMessage(lutCSWorker.cs.calcPrimaries(i.p,i.t))}},!1)}function getCSString(){var t,i="";for(t in i+=LUTColourSpace.toString()+"\n",LUTColourSpace.prototype)i+="LUTColourSpace.prototype."+t+"="+LUTColourSpace.prototype[t].toString()+"\n";for(t in i+=CCTxy.toString()+"\n",CCTxy.prototype)i+="CCTxy.prototype."+t+"="+CCTxy.prototype[t].toString()+"\n";for(t in i+=Planck.toString()+"\n",Planck.prototype)i+="Planck.prototype."+t+"="+Planck.prototype[t].toString()+"\n";for(t in i+=CSCAT.toString()+"\n",CSCAT.prototype)i+="CSCAT.prototype."+t+"="+CSCAT.prototype[t].toString()+"\n";for(t in i+=CSWB.toString()+"\n",CSWB.prototype)i+="CSWB.prototype."+t+"="+CSWB.prototype[t].toString()+"\n";for(t in i+=CSSL3.toString()+"\n",CSSL3.prototype)i+="CSSL3.prototype."+t+"="+CSSL3.prototype[t].toString()+"\n";for(t in i+=CSLogC.toString()+"\n",CSLogC.prototype)i+="CSLogC.prototype."+t+"="+CSLogC.prototype[t].toString()+"\n";for(t in i+=CSVLog.toString()+"\n",CSVLog.prototype)i+="CSVLog.prototype."+t+"="+CSVLog.prototype[t].toString()+"\n";for(t in i+=CSMatrix.toString()+"\n",CSMatrix.prototype)i+="CSMatrix.prototype."+t+"="+CSMatrix.prototype[t].toString()+"\n";for(t in i+=CSToneCurve.toString()+"\n",CSToneCurve.prototype)i+="CSToneCurve.prototype."+t+"="+CSToneCurve.prototype[t].toString()+"\n";for(t in i+=CSToneCurvePlus.toString()+"\n",CSToneCurvePlus.prototype)i+="CSToneCurvePlus.prototype."+t+"="+CSToneCurvePlus.prototype[t].toString()+"\n";for(t in i+=CSLUT.toString()+"\n",CSLUT.prototype)i+="CSLUT.prototype."+t+"="+CSLUT.prototype[t].toString()+"\n";for(t in i+=CSCanonIDT.toString()+"\n",CSCanonIDT.prototype)i+="CSCanonIDT.prototype."+t+"="+CSCanonIDT.prototype[t].toString()+"\n";for(t in i+=CSLabSpace.toString()+"\n",CSLabSpace.prototype)i+="CSLabSpace.prototype."+t+"="+CSLabSpace.prototype[t].toString()+"\n";for(t in i+=LUTCSWorker.toString()+"\n",LUTCSWorker.prototype)i+="LUTCSWorker.prototype."+t+"="+LUTCSWorker.prototype[t].toString()+"\n";return i+="var lutCSWorker = new LUTCSWorker();\n"}LUTColourSpace.prototype.subIdx=function(t){switch(t){case"Sony":return 0;case"ARRI":return 1;case"Canon":return 2;case"Apple":return 3;case"Panasonic":return 4;case"Fujifilm":return 5;case"RED":return 6;case"DJI":return 7;case"GoPro":return 8;case"Blackmagic":return 9;case"Nikon":return 10;case"Bolex":return 11;case"Adobe":return 12;case"Rec709":return 13;case"Rec2020":return 14;case"Rec2100":return 15;case"P3":return 16;case"Wide Gamut":return 17;case"ACES":return 18;case"All":return 19}return!1},LUTColourSpace.prototype.loadColourSpaces=function(){this.subNames=["Sony","ARRI","Canon","Apple","Panasonic","Fujifilm","RED","DJI","GoPro","Blackmagic","Nikon","Bolex","Adobe","Rec709","Rec2020","Rec2100","P3","Wide Gamut","ACES","All"],this.SG3C=this.csIn.length,this.csIn.push(this.toSys("Sony S-Gamut3.cine")),this.csInSub.push([this.subIdx("Sony"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("Sony S-Gamut3.cine (Venice)")),this.csInSub.push([this.subIdx("Sony"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("Sony S-Gamut3")),this.csInSub.push([this.subIdx("Sony"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("Sony S-Gamut3 (Venice)")),this.csInSub.push([this.subIdx("Sony"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("Sony S-Gamut")),this.csInSub.push([this.subIdx("Sony"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("ARRI Wide Gamut 4")),this.csInSub.push([this.subIdx("ARRI"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("Alexa Wide Gamut")),this.csInSub.push([this.subIdx("ARRI"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("Canon Cinema Gamut")),this.csInSub.push([this.subIdx("Canon"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("Panasonic V-Gamut")),this.csInSub.push([this.subIdx("Panasonic"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("Fujifilm F-Log Gamut")),this.csInSub.push([this.subIdx("Fujifilm"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("Blackmagic Wide Gamut")),this.csInSub.push([this.subIdx("Blackmagic"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("DaVinci Wide Gamut")),this.csInSub.push([this.subIdx("Blackmagic"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("Blackmagic 4.6k Film")),this.csInSub.push([this.subIdx("Blackmagic"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("Blackmagic 4k Film")),this.csInSub.push([this.subIdx("Blackmagic"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("Blackmagic Pocket 6k Film")),this.csInSub.push([this.subIdx("Blackmagic"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("DRAGONColor")),this.csInSub.push([this.subIdx("RED")]),this.csIn.push(this.toSys("DRAGONColor2")),this.csInSub.push([this.subIdx("RED")]),this.csIn.push(this.toSys("REDColor")),this.csInSub.push([this.subIdx("RED")]),this.csIn.push(this.toSys("REDColor2")),this.csInSub.push([this.subIdx("RED")]),this.csIn.push(this.toSys("REDColor3")),this.csInSub.push([this.subIdx("RED")]),this.csIn.push(this.toSys("REDColor4")),this.csInSub.push([this.subIdx("RED")]),this.csIn.push(this.toSys("REDWideGamutRGB")),this.csInSub.push([this.subIdx("RED")]),this.csIn.push(this.toSys("DJI D-Gamut")),this.csInSub.push([this.subIdx("DJI"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("DJI D-GamutM")),this.csInSub.push([this.subIdx("DJI"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("Protune Native")),this.csInSub.push([this.subIdx("GoPro"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("Bolex Wide Gamut")),this.csInSub.push([this.subIdx("Bolex"),this.subIdx("Wide Gamut")]),this.rec709In=this.csIn.length,this.csIn.push(this.toSys("Rec709")),this.csInSub.push([this.subIdx("Rec709"),this.subIdx("DJI")]),this.csIn.push(this.toSys("Rec2020")),this.csInSub.push([this.subIdx("Rec2020"),this.subIdx("Apple"),this.subIdx("Nikon"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("Rec2100")),this.csInSub.push([this.subIdx("Rec2100"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("sRGB")),this.csInSub.push([]),this.csIn.push(this.toSys("ACES AP0")),this.csInSub.push([this.subIdx("ACES"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("ACEScg AP1")),this.csInSub.push([this.subIdx("ACES"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("XYZ")),this.csInSub.push([this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("P3 - DCI")),this.csInSub.push([this.subIdx("P3")]),this.csIn.push(this.toSys("P3 - D60")),this.csInSub.push([this.subIdx("P3")]),this.csIn.push(this.toSys("P3 - D65")),this.csInSub.push([this.subIdx("P3")]),this.csIn.push(new CSCanonIDT("Canon CP IDT (Daylight)",!0,this.toSys("ACES AP0").m,this.system.white.buffer.slice(0))),this.csInSub.push([this.subIdx("Canon"),this.subIdx("Rec709")]),this.csIn.push(new CSCanonIDT("Canon CP IDT (Tungsten)",!1,this.toSys("ACES AP0").m,this.system.white.buffer.slice(0))),this.csInSub.push([this.subIdx("Canon"),this.subIdx("Rec709")]),this.csIn.push(this.toSys("Canon DCI-P3+")),this.csInSub.push([this.subIdx("Canon"),this.subIdx("P3")]),this.csIn.push(this.toSys("Adobe RGB")),this.csInSub.push([this.subIdx("Adobe")]),this.csIn.push(this.toSys("Adobe Wide Gamut RGB")),this.csInSub.push([this.subIdx("Adobe"),this.subIdx("Wide Gamut")]),this.csIn.push(this.toSys("ProPhoto RGB")),this.csInSub.push([this.subIdx("Wide Gamut")]),this.csIn.push(new CSLabSpace("CIELAB D65",95.0489,100,108.884,!0,this.toSys("XYZ"))),this.csInSub.push([this.subIdx("Wide Gamut")]),this.csIn.push(new CSLabSpace("CIELAB D50",96.4212,100,82.5188,!0,this.toSys("XYZ"))),this.csInSub.push([this.subIdx("Wide Gamut")]),this.custIn=this.csIn.length,this.csIn.push(this.toSys("Custom In")),this.csInSub.push([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),this.csIn.push(new CSMatrix("Passthrough",new Float64Array([1,0,0,0,1,0,0,0,1]),this.system.white.buffer.slice(0))),this.csInSub.push([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),this.csOut.push(this.fromSys("Sony S-Gamut3.cine")),this.csOutSub.push([this.subIdx("Sony"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("Sony S-Gamut3.cine (Venice)")),this.csOutSub.push([this.subIdx("Sony"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("Sony S-Gamut3")),this.csOutSub.push([this.subIdx("Sony"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("Sony S-Gamut3 (Venice)")),this.csOutSub.push([this.subIdx("Sony"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("Sony S-Gamut")),this.csOutSub.push([this.subIdx("Sony"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("ARRI Wide Gamut 4")),this.csOutSub.push([this.subIdx("ARRI"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("Alexa Wide Gamut")),this.csOutSub.push([this.subIdx("ARRI"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("Canon Cinema Gamut")),this.csOutSub.push([this.subIdx("Canon"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("Panasonic V-Gamut")),this.csOutSub.push([this.subIdx("Panasonic"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("Fujifilm F-Log Gamut")),this.csOutSub.push([this.subIdx("Fujifilm"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("Blackmagic Wide Gamut")),this.csOutSub.push([this.subIdx("Blackmagic"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("DaVinci Wide Gamut")),this.csOutSub.push([this.subIdx("Blackmagic"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("Blackmagic 4.6k Film")),this.csOutSub.push([this.subIdx("Blackmagic"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("Blackmagic 4k Film")),this.csOutSub.push([this.subIdx("Blackmagic"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("Blackmagic Pocket 6k Film")),this.csOutSub.push([this.subIdx("Blackmagic"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("DRAGONColor")),this.csOutSub.push([this.subIdx("RED")]),this.csOut.push(this.fromSys("DRAGONColor2")),this.csOutSub.push([this.subIdx("RED")]),this.csOut.push(this.fromSys("REDColor")),this.csOutSub.push([this.subIdx("RED")]),this.csOut.push(this.fromSys("REDColor2")),this.csOutSub.push([this.subIdx("RED")]),this.csOut.push(this.fromSys("REDColor3")),this.csOutSub.push([this.subIdx("RED")]),this.csOut.push(this.fromSys("REDColor4")),this.csOutSub.push([this.subIdx("RED")]),this.csOut.push(this.fromSys("REDWideGamutRGB")),this.csOutSub.push([this.subIdx("RED")]),this.csOut.push(this.fromSys("DJI D-Gamut")),this.csOutSub.push([this.subIdx("DJI"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("DJI D-GamutM")),this.csOutSub.push([this.subIdx("DJI"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("Protune Native")),this.csOutSub.push([this.subIdx("GoPro"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("Bolex Wide Gamut")),this.csOutSub.push([this.subIdx("Bolex"),this.subIdx("Wide Gamut")]),this.rec709Out=this.csIn.length,this.csOut.push(this.fromSys("Rec709")),this.csOutSub.push([this.subIdx("Rec709"),this.subIdx("DJI")]),this.defLUTs.Amira709=this.csOut.length,this.csOut.push(this.fromSysLUT("Amira709",{format:"cube",min:[0,0,0],max:[1,1,1],wp:this.illuminant("d65"),genInt:1,preInt:1})),this.csOutSub.push([this.subIdx("ARRI"),this.subIdx("Rec709")]),this.defLUTs.AlexaX2=this.csOut.length,this.csOut.push(this.fromSysLUT("Alexa-X-2",{format:"cube",min:[0,0,0],max:[1,1,1],wp:this.illuminant("d65"),genInt:1,preInt:1})),this.csOutSub.push([this.subIdx("ARRI"),this.subIdx("Rec709")]),this.defLUTs.s709=this.csOut.length,this.csOut.push(this.fromSysLUT("s709",{format:"cube",min:[0,0,0],max:[1,1,1],wp:this.illuminant("d65"),genInt:1,preInt:1})),this.csOutSub.push([this.subIdx("Sony"),this.subIdx("Rec709")]),this.defLUTs.LC709=this.csOut.length,this.csOut.push(this.fromSysLUT("LC709",{format:"cube",min:[0,0,0],max:[1,1,1],wp:this.illuminant("d65"),genInt:1,preInt:1})),this.csOutSub.push([this.subIdx("Sony"),this.subIdx("Rec709")]),this.defLUTs.LC709A=this.csOut.length,this.csOut.push(this.fromSysLUT("LC709A",{format:"cube",min:[0,0,0],max:[1,1,1],wp:this.illuminant("d65"),genInt:1,preInt:1})),this.csOutSub.push([this.subIdx("Sony"),this.subIdx("Rec709")]),this.defLUTs.Cine709=this.csOut.length,this.csOut.push(this.fromSysLUT("Sony Cine+709",{format:"cube",min:[0,0,0],max:[1,1,1],wp:this.illuminant("d65"),genInt:1,preInt:1})),this.csOutSub.push([this.subIdx("Sony"),this.subIdx("Rec709")]),this.defLUTs.cpoutdaylight=this.csOut.length,this.csOut.push(this.fromSysLUT("Canon CP IDT (Daylight)",{format:"cube",min:[0,0,0],max:[1,1,1],wp:this.illuminant("d65"),genInt:1,preInt:1})),this.csOutSub.push([this.subIdx("Canon"),this.subIdx("Rec709")]),this.defLUTs.cpouttungsten=this.csOut.length,this.csOut.push(this.fromSysLUT("Canon CP IDT (Tungsten)",{format:"cube",min:[0,0,0],max:[1,1,1],wp:this.illuminant("d65"),genInt:1,preInt:1})),this.csOutSub.push([this.subIdx("Canon"),this.subIdx("Rec709")]),this.defLUTs.V709=this.csOut.length,this.csOut.push(this.fromSysLUT("Varicam V709",{format:"cube",min:[0,0,0],max:[1,1,1],wp:this.illuminant("d65"),genInt:1,preInt:1})),this.csOutSub.push([this.subIdx("Panasonic"),this.subIdx("Rec709")]),this.csOut.push(this.fromSys("Rec2020")),this.csOutSub.push([this.subIdx("Rec2020"),this.subIdx("Nikon"),this.subIdx("Apple"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("Rec2100")),this.csOutSub.push([this.subIdx("Rec2100"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("sRGB")),this.csOutSub.push([]),this.csOut.push(this.fromSysMatrix("Luma B&W",new Float64Array([this.y[0],this.y[1],this.y[2],this.y[0],this.y[1],this.y[2],this.y[0],this.y[1],this.y[2]]),this.system.white.buffer.slice(0))),this.csOutSub.push([]),this.csOut.push(this.fromSys("ACES AP0")),this.csOutSub.push([this.subIdx("ACES"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("ACEScg AP1")),this.csOutSub.push([this.subIdx("ACES"),this.subIdx("Wide Gamut")]),this.XYZOut=this.csOut.length,this.csOut.push(this.fromSys("XYZ")),this.csOutSub.push([this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("P3 - DCI")),this.csOutSub.push([this.subIdx("P3")]),this.csOut.push(this.fromSys("P3 - D60")),this.csOutSub.push([this.subIdx("P3")]),this.csOut.push(this.fromSys("P3 - D65")),this.csOutSub.push([this.subIdx("P3")]),this.csOut.push(this.fromSys("Canon DCI-P3+")),this.csOutSub.push([this.subIdx("Canon"),this.subIdx("P3")]),this.csOut.push(this.fromSys("Adobe RGB")),this.csOutSub.push([this.subIdx("Adobe")]),this.csOut.push(this.fromSys("Adobe Wide Gamut RGB")),this.csOutSub.push([this.subIdx("Adobe"),this.subIdx("Wide Gamut")]),this.csOut.push(this.fromSys("ProPhoto RGB")),this.csOutSub.push([this.subIdx("Wide Gamut")]),this.csOut.push(new CSLabSpace("CIELAB D65",95.0489,100,108.884,!1,this.fromSys("XYZ"))),this.csOutSub.push([this.subIdx("Wide Gamut")]),this.csOut.push(new CSLabSpace("CIELAB D50",96.4212,100,82.5188,!1,this.fromSys("XYZ"))),this.csOutSub.push([this.subIdx("Wide Gamut")]),this.custOut=this.csOut.length,this.csOut.push(this.toSys("Custom Out")),this.csOutSub.push([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),this.pass=this.csOut.length,this.csOut.push(this.fromSysMatrix("Passthrough",new Float64Array([1,0,0,0,1,0,0,0,1]),this.system.white.buffer.slice(0))),this.csM.push(this.csOut[this.csOut.length-1]),this.csOutSub.push([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),this.LA=this.csOut.length,this.csOut.push(this.fromSysLA("LA",{wp:this.illuminant("d65")})),this.csOutSub.push([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]);var t=this.csIn.length;this.inCATs=[],this.outCATs=[];for(var i=0;i<t;i++)this.inList.push({name:this.csIn[i].name,idx:i}),this.inCATs.push(this.getCSCat(this.csIn[i].name));for(var s=this.csOut.length,i=0;i<s;i++)i!==this.LA&&this.outList.push({name:this.csOut[i].name,idx:i}),this.outCATs.push(this.getCSCat(this.csOut[i].name));s=this.outList.length;for(var h=0,r=0;r<t;r++)if(this.csIn[r].isMatrix()&&"Passthrough"!==this.csIn[r].name){if(this.laList.push({name:this.csIn[r].name}),this.csLASub.push(this.csInSub[r].slice(0)),"Custom In"===this.laList[h].name)this.laList[h].idx=this.custOut,this.csLASub[h]=this.csOutSub[this.custOut].slice(0);else for(i=0;i<s;i++)if(this.laList[h].name===this.outList[i].name){this.laList[h].idx=this.outList[i].idx,this.csLASub[h]=this.csOutSub[i].slice(0);break}h++}},LUTColourSpace.prototype.getCSCat=function(t){for(var i=this.g.length,s=0;s<i;s++)if(t===this.g[s].name)return this.g[s].cat;return this.sysCATIdx},LUTColourSpace.prototype.RGBtoXYZ=function(t,i){if(void 0===i||!i)return!1;var s=new Float64Array([t[0]/t[1],t[2]/t[3],t[4]/t[5],1,1,1,(1-t[0]-t[1])/t[1],(1-t[2]-t[3])/t[3],(1-t[4]-t[5])/t[5]]),t=this.mInverse(s);if(!t)return!1;i=this.mMult(t,new Float64Array([i[0]/i[1],1,i[2]/i[1]]));return new Float64Array([i[0]*s[0],i[1]*s[1],i[2]*s[2],i[0]*s[3],i[1]*s[4],i[2]*s[5],i[0]*s[6],i[1]*s[7],i[2]*s[8]])},LUTColourSpace.prototype.calcCAT=function(t,i,s,h){var r=this.CATs.getModel(h),h=this.mInverse(r),i=this.mMult(r,new Float64Array([i[0]/i[1],1,i[2]/i[1]])),s=this.mMult(r,new Float64Array([s[0]/s[1],1,s[2]/s[1]])),i=new Float64Array([s[0]/i[0],0,0,0,s[1]/i[1],0,0,0,s[2]/i[2]]),r=this.mMult(h,this.mMult(i,r));return this.mMult(r,t)},LUTColourSpace.prototype.toSys=function(t){for(var i=this.g.length,s=0;s<i;s++)if(t===this.g[s].name)return new CSMatrix(t,this.g[s].toSys,this.g[s].white.buffer.slice(0));return!1},LUTColourSpace.prototype.fromSys=function(t){for(var i=this.g.length,s=0;s<i;s++)if(t===this.g[s].name){var h=new CSMatrix(t,this.mInverse(this.g[s].toSys),this.g[s].white.buffer.slice(0));return this.csM.push(h),this.Ys[t]=this.getYCoeffs(s),h}return!1},LUTColourSpace.prototype.matrixVals=function(t,i){for(var s=this.g.length,h=0;h<s;h++)if(t===this.g[h].name)return i?this.g[h].toSys:this.mInverse(this.g[h].toSys);return!1},LUTColourSpace.prototype.fromSysMatrix=function(t,i,s){s=new CSMatrix(t,i,s);return this.csM.push(s),s},LUTColourSpace.prototype.fromSysLUT=function(t,i){var s=new Float64Array([1,0,0,0,1,0,0,0,1,1,1,1,.8,0,0,0,.8,0,0,0,.8,.4,0,0,0,.4,0,0,0,.4,.2,0,0,0,.2,0,0,0,.2,.8,.8,.8,.4,.4,.4,.2,.2,.2]);this.csIn[this.rec709In].lc(s.buffer);s=new CSLUT(t,i,this.lutMaker,s);return this.csM.push(s),s},LUTColourSpace.prototype.fromSysTC=function(t,i,s,h,r){r=this.CATs.getModel(r),s=this.RGBtoXYZ(s,h);return this.csM.push(new CSMatrix(t,this.mInverse(this.mMult(this.system.fromXYZ,this.calcCAT(s,h,this.system.white,r))),h)),new CSToneCurve(t,i)},LUTColourSpace.prototype.fromSysLA=function(t,i){var s=new Float64Array([1,0,0,0,1,0,0,0,1,1,1,1,.8,0,0,0,.8,0,0,0,.8,.4,0,0,0,.4,0,0,0,.4,.2,0,0,0,.2,0,0,0,.2,.8,.8,.8,.4,.4,.4,.2,.2,.2]);this.csIn[this.rec709In].lc(s.buffer);s=new CSLUT(t,i,this.lutMaker,s);return this.csM.push(s),s},LUTColourSpace.prototype.fx=function(t){var i,s=new Float64Array(t),h=s.length,r=this.y;if(this.doWB&&this.wb.lc(t),this.doASCCDL)for(var e=0;e<h;e+=3)s[e]=s[e]*this.asc[0]+this.asc[3],s[e]=s[e]<0?s[e]:Math.pow(s[e],this.asc[6]),s[e]=isNaN(s[e])?0:s[e],s[e+1]=s[e+1]*this.asc[1]+this.asc[4],s[e+1]=s[e+1]<0?s[e+1]:Math.pow(s[e+1],this.asc[7]),s[e+1]=isNaN(s[e+1])?0:s[e+1],s[e+2]=s[e+2]*this.asc[2]+this.asc[5],s[e+2]=s[e+2]<0?s[e+2]:Math.pow(s[e+2],this.asc[8]),s[e+2]=isNaN(s[e+2])?0:s[e+2],i=(r[0]*s[e]+r[1]*s[e+1]+r[2]*s[e+2])*(1-this.asc[9]),s[e]=i+this.asc[9]*s[e],s[e+1]=i+this.asc[9]*s[e+1],s[e+2]=i+this.asc[9]*s[e+2];return this.csM[this.curOut].lc(t),s},LUTColourSpace.prototype.rx=function(t){var i,s=new Float64Array(t),h=s.length,r=this.y;if(this.csM[this.curOut].rc(t),this.doWB&&this.wb.rc(t),this.doASCCDL)for(var e=1/Math.max(this.asc[9],1e-8),o=0;o<h;o+=3)i=(r[0]*s[o]+r[1]*s[o+1]+r[2]*s[o+2])*(1-e),s[o]=s[o]*e+i,s[o+1]=s[o+1]*e+i,s[o+2]=s[o+2]*e+i,s[o]=s[o]<0?s[o]:Math.pow(s[o],1/this.asc[6]),s[o]=(s[o]-this.asc[3])/this.asc[0],s[o]=isNaN(s[o])?0:s[o],s[o+1]=s[o+1]<0?s[o+1]:Math.pow(s[o+1],1/this.asc[7]),s[o+1]=(s[o+1]-this.asc[4])/this.asc[1],s[o+1]=isNaN(s[o+1])?0:s[o+1],s[o+2]=s[o+2]<0?s[o+2]:Math.pow(s[o+2],1/this.asc[8]),s[o+2]=(s[o+2]-this.asc[5])/this.asc[2],s[o+2]=isNaN(s[o+2])?0:s[o+2];return s},LUTColourSpace.prototype.firstGuess=function(t,i,s){var h=2*s,s=new Float64Array([i[0],i[1],i[2],i[0]+s,i[1],i[2],i[0]-s,i[1],i[2],i[0],i[1]+s,i[2],i[0],i[1]-s,i[2],i[0],i[1],i[2]+s,i[0],i[1],i[2]-s]),s=this.fx(s.buffer);return{x:i,f:new Float64Array([s[0]-t[0],s[1]-t[1],s[2]-t[2]]),J:new Float64Array([(s[3]-s[6])/h,(s[9]-s[12])/h,(s[15]-s[18])/h,(s[4]-s[7])/h,(s[10]-s[13])/h,(s[16]-s[19])/h,(s[5]-s[8])/h,(s[11]-s[14])/h,(s[17]-s[20])/h])}},LUTColourSpace.prototype.roundOff=function(t){return parseFloat(t.toFixed(8))},LUTColourSpace.prototype.mInverse=function(t){var i=t[0]*(t[4]*t[8]-t[5]*t[7])-t[1]*(t[3]*t[8]-t[5]*t[6])+t[2]*(t[3]*t[7]-t[4]*t[6]);return 0!=i&&new Float64Array([(t[4]*t[8]-t[5]*t[7])/i,(t[2]*t[7]-t[1]*t[8])/i,(t[1]*t[5]-t[2]*t[4])/i,(t[5]*t[6]-t[3]*t[8])/i,(t[0]*t[8]-t[2]*t[6])/i,(t[2]*t[3]-t[0]*t[5])/i,(t[3]*t[7]-t[4]*t[6])/i,(t[1]*t[6]-t[0]*t[7])/i,(t[0]*t[4]-t[1]*t[3])/i])},LUTColourSpace.prototype.mMult=function(t,i){if(9!==t.length)return!1;var s,h=i.length;return 3!==h?9===h&&((s=new Float64Array(9))[0]=t[0]*i[0]+t[1]*i[3]+t[2]*i[6],s[1]=t[0]*i[1]+t[1]*i[4]+t[2]*i[7],s[2]=t[0]*i[2]+t[1]*i[5]+t[2]*i[8],s[3]=t[3]*i[0]+t[4]*i[3]+t[5]*i[6],s[4]=t[3]*i[1]+t[4]*i[4]+t[5]*i[7],s[5]=t[3]*i[2]+t[4]*i[5]+t[5]*i[8],s[6]=t[6]*i[0]+t[7]*i[3]+t[8]*i[6],s[7]=t[6]*i[1]+t[7]*i[4]+t[8]*i[7],s[8]=t[6]*i[2]+t[7]*i[5]+t[8]*i[8],s):((s=new Float64Array(3))[0]=t[0]*i[0]+t[1]*i[1]+t[2]*i[2],s[1]=t[3]*i[0]+t[4]*i[1]+t[5]*i[2],s[2]=t[6]*i[0]+t[7]*i[1]+t[8]*i[2],s)},LUTColourSpace.prototype.illuminant=function(t){switch(t.toLowerCase()){case"a":return new Float64Array([.44757,.40745,.14498]);case"b":return new Float64Array([.34842,.35161,.29997]);case"c":return new Float64Array([.31006,.31616,.37378]);case"d40":return new Float64Array([.3823,.3838,.2339]);case"d45":return new Float64Array([.3621,.3709,.267]);case"d50":return new Float64Array([.34567,.3585,.29583]);case"d55":return new Float64Array([.33242,.34743,.32015]);case"d60":return new Float64Array([.32168,.33767,.34065]);case"d65":return new Float64Array([.3127,.329,.3583]);case"d70":return new Float64Array([.3054,.3216,.373]);case"d75":return new Float64Array([.29902,.31485,.38613]);case"e":return new Float64Array([1/3,1/3,1/3]);case"p3":return new Float64Array([.314,.351,.335]);case"f1":return new Float64Array([.3131,.33727,.34963]);case"f2":return new Float64Array([.37208,.37529,.25263]);case"f3":return new Float64Array([.4091,.3943,.1966]);case"f4":return new Float64Array([.44018,.40329,.15653]);case"f5":return new Float64Array([.31379,.34531,.3409]);case"f6":return new Float64Array([.3779,.38835,.23375]);case"f7":return new Float64Array([.31292,.32933,.35775]);case"f8":return new Float64Array([.34588,.35875,.29537]);case"f9":return new Float64Array([.37417,.37281,.25302]);case"f10":return new Float64Array([.34609,.35986,.29405]);case"f11":return new Float64Array([.38052,.37713,.24235]);case"f12":return new Float64Array([.43695,.40441,.15864]);case"iso7589studiotungsten":return new Float64Array([.43088,.40784,.16128]);case"iso7589photoflood":return new Float64Array([.41154,.39851,.18995]);case"iso7589daylight":return new Float64Array([.33357,.35368,.31275])}},LUTColourSpace.prototype.xyzMatrices=function(){this.sysIdx=this.g.length;var t={name:"Sony S-Gamut3.cine"};t.cat=this.CATs.modelIdx("CIECAT02"),t.xy=new Float64Array([.766,.275,.225,.8,.089,-.087]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Sony S-Gamut3.cine (Venice)"};t.cat=this.CATs.modelIdx("CIECAT02"),t.xy=new Float64Array([.775901872,.274502393,.188682903,.828684937,.101337383,-.089187517]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Sony S-Gamut3"};t.cat=this.CATs.modelIdx("CIECAT02"),t.xy=new Float64Array([.73,.28,.14,.855,.1,-.05]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Sony S-Gamut3 (Venice)"};t.cat=this.CATs.modelIdx("CIECAT02"),t.xy=new Float64Array([.740464264,.279364375,.089241145,.893809529,.110488237,-.052579333]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Sony S-Gamut"};t.cat=this.CATs.modelIdx("CIECAT02"),t.xy=new Float64Array([.73,.28,.14,.855,.1,-.05]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"ARRI Wide Gamut 4"};t.cat=this.CATs.modelIdx("CIECAT02"),t.xy=new Float64Array([.7347,.2653,.1424,.8576,.0991,-.0308]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Alexa Wide Gamut"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.684,.313,.221,.848,.0861,-.102]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Canon Cinema Gamut"};t.cat=this.CATs.modelIdx("CIECAT02"),t.xy=new Float64Array([.74,.27,.17,1.14,.08,-.1]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Blackmagic Wide Gamut"};t.cat=this.CATs.modelIdx("Bradford Chromatic Adaptation"),t.xy=new Float64Array([.7177215,.3171181,.228041,.861569,.1005841,-.0820452]),t.white=new Float64Array([.312717,.3290312,.3582518]),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"DaVinci Wide Gamut"};t.cat=this.CATs.modelIdx("Bradford Chromatic Adaptation"),t.xy=new Float64Array([.8,.313,.1682,.9877,.079,-.1155]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Panasonic V-Gamut"};t.cat=this.CATs.modelIdx("Bradford Chromatic Adaptation"),t.xy=new Float64Array([.73,.28,.165,.84,.1,-.03]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Blackmagic 4k Film"};t.cat=this.CATs.modelIdx("CIECAT02"),t.xy=new Float64Array([1.065485164,.395870911,.369219642,.778131628,.095906214,.033373394]),t.white=new Float64Array([.313122422,.32974025,.357137329]),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Blackmagic 4.6k Film"};t.cat=this.CATs.modelIdx("CIECAT02"),t.xy=new Float64Array([.860834693,.368871184,.328213148,.615592065,.07825175,-.023256123]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Blackmagic Pocket 6k Film"};t.cat=this.CATs.modelIdx("CIECAT02"),t.xy=new Float64Array([.720597149,.329307006,.298281489,.629701953,.132079051,.031392256]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Fujifilm F-Log Gamut"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.708,.292,.17,.797,.131,.046]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"REDWideGamutRGB"};t.cat=this.CATs.modelIdx("Bradford Chromatic Adaptation"),t.xy=new Float64Array([.780308,.304253,.121595,1.493994,.095612,-.084589]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"DRAGONColor"};t.cat=this.CATs.modelIdx("Bradford Chromatic Adaptation"),t.xy=new Float64Array([.75002604,.32671294,.32008411,.68143644,.07431725,-.05592259]),t.white=this.illuminant("e"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"DRAGONColor2"};t.cat=this.CATs.modelIdx("Bradford Chromatic Adaptation"),t.xy=new Float64Array([.7500263,.32671336,.32008437,.68143652,.145629,.05124619]),t.white=this.illuminant("e"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"REDColor"};t.cat=this.CATs.modelIdx("Bradford Chromatic Adaptation"),t.xy=new Float64Array([.70017112,.32750563,.32289102,.6077074,.13468038,.03479195]),t.white=this.illuminant("e"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"REDColor2"};t.cat=this.CATs.modelIdx("Bradford Chromatic Adaptation"),t.xy=new Float64Array([.86581522,.32487259,.32087226,.66073571,.09160032,-.02994923]),t.white=this.illuminant("e"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"REDColor3"};t.cat=this.CATs.modelIdx("Bradford Chromatic Adaptation"),t.xy=new Float64Array([.70151835,.32748417,.32069982,.66526394,.10554785,-.00898842]),t.white=this.illuminant("e"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"REDColor4"};t.cat=this.CATs.modelIdx("Bradford Chromatic Adaptation"),t.xy=new Float64Array([.70151793,.32748374,.32069991,.66526392,.14597596,.05176764]),t.white=this.illuminant("e"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Bolex Wide Gamut"};t.cat=this.CATs.modelIdx("Bradford Chromatic Adaptation"),t.xy=new Float64Array([.73,.294,.223,.82,.103,-.055]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"DJI D-Gamut"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.71,.31,.21,.88,.09,-.08]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"DJI D-GamutM"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.721565,.305591,.229956,.802053,.074012,-.056283]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Protune Native"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.70419975,.19595152,.33147178,.98320117,.1037611,-.04367584]),t.white=this.illuminant("d60"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Rec709"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.64,.33,.3,.6,.15,.06]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.rec709Idx=this.g.length,this.g.push(t);t={name:"Rec2020"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.708,.292,.17,.797,.131,.046]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Rec2100"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.708,.292,.17,.797,.131,.046]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"sRGB"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.64,.33,.3,.6,.15,.06]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"ACES AP0"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.7347,.2653,0,1,1e-4,-.077]),t.white=this.illuminant("d60"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"ACEScg AP1"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.713,.293,.165,.83,.128,.044]),t.white=this.illuminant("d60"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"XYZ"};t.cat=this.sysCATIdx,t.xy=!1,t.white=this.illuminant("d65"),t.toXYZ=new Float64Array([1,0,0,0,1,0,0,0,1]),this.xyzIdx=this.g.length,this.g.push(t);t={name:"P3 - DCI"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.68,.32,.265,.69,.15,.06]),t.white=this.illuminant("p3"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"P3 - D60"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.68,.32,.265,.69,.15,.06]),t.white=this.illuminant("d60"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"P3 - D65"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.68,.32,.265,.69,.15,.06]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Canon DCI-P3+"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.74,.27,.22,.78,.09,-.09]),t.white=this.illuminant("p3"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Adobe RGB"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.64,.33,.21,.71,.15,.06]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Adobe Wide Gamut RGB"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.7347,.2653,.1152,.8264,.1566,.0177]),t.white=this.illuminant("d50"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"ProPhoto RGB"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.7347,.2653,.1596,.8404,.0366,1e-4]),t.white=this.illuminant("d50"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Custom In"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.64,.33,.3,.6,.15,.06]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t);t={name:"Custom Out"};t.cat=this.sysCATIdx,t.xy=new Float64Array([.64,.33,.3,.6,.15,.06]),t.white=this.illuminant("d65"),t.toXYZ=this.RGBtoXYZ(t.xy,t.white),this.g.push(t)},LUTColourSpace.prototype.systemMatrices=function(){for(var t=this.g.length,i=0;i<t;i++)"Custom In"!==this.g[i].name&&"Custom Out"!==this.g[i].name&&"Passthrough"!==this.g[i].name&&this.matList.push({name:this.g[i].name,idx:i}),i===this.sysIdx?this.g[i].toSys=new Float64Array([1,0,0,0,1,0,0,0,1]):"XYZ"===this.g[i].name?this.g[i].toSys=this.system.fromXYZ:this.g[i].white[0]!==this.system.white[0]&&this.g[i].white[1]!==this.system.white[1]&&this.g[i].white[2]!==this.system.white[2]?this.g[i].toSys=this.mMult(this.system.fromXYZ,this.calcCAT(this.g[i].toXYZ,this.g[i].white,this.system.white,this.g[i].cat)):this.g[i].toSys=this.mMult(this.system.fromXYZ,this.g[i].toXYZ)},LUTColourSpace.prototype.initPSSTCDL=function(){this.psstMC=!0,this.psstYC=!1,this.psstC=new Ring,this.psstC.setDetails({title:"Colour",L:new Float64Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]).buffer,p:!1,mod:1}),this.psstSat=new Ring,this.psstSat.setDetails({title:"Saturation",L:new Float64Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]).buffer,p:!1}),this.psstS=new Ring,this.psstS.setDetails({title:"Slope",L:new Float64Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]).buffer,p:!1}),this.psstO=new Ring,this.psstO.setDetails({title:"Offset",L:new Float64Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]).buffer,p:!1}),this.psstP=new Ring,this.psstP.setDetails({title:"Power",L:new Float64Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]).buffer,p:!1}),this.psstF=new Ring,this.psstF.setDetails({title:"Forward",L:new Float64Array([-.0038695657404562,.00658587623561,.02014060994049,.0352828041364269,.052059485134666,.0701816671759477,.0888871169278112,.1071434832095446,.1241300598546256,.1394968704492374,.1532401783604684,.1657675172633559,.1775709068913177,.1889505001250262,.2001195960344167,.2112553615444404,.222529628411903,.2341370761420996,.2463352166687472,.259524751612133,.2744679542490435,.293322629874717,.3287624039244701,.4006899403301722,.4276051836096898,.4447257669774564,.4589794729871186,.4717842618396581,.4837468755866364,.4952093965712169,.5064034638133755,.5175127750345129,.5287073445057027,.5401709526670702,.5521354485080856,.5649433872473982,.5790664946157549,.594363056252131,.6106992294013223,.6278535155401859,.6454346342920819,.6629428672584311,.6798980496803277,.6959546592769115,.7109387359446133,.7250595197384678,.7388861383721239,.7524290718192624,.7656794919842305,.778632173184629,.7912850081995813,.8036385234867822,.8156954169692322,.8274601335361318,.838938486588926,.8501373280139014,.8610751527873562,.871871712005234,.8825403689956453,.8930611389578428,.9034170399839038,.9135941187798583,.9235814085450882,.9333707275123123,.9429564536395982,.9523352418731073,.9615057270095099,.9704682268100525,.9792244585320422,.987777273605664,.9961304342481022]).buffer,p:!0}),this.psstB=new Ring,this.psstB.setDetails({title:"Back",L:new Float64Array([.042311434,.828850698,1.852489293,2.158688535,3.183904084,3.970443351,4.994081951,6.325496742]).buffer,p:!0}),this.psstY=new Ring,this.psstY.setDetails({title:"Luma",L:new Float64Array([.0722,.2848,.2126,.6,.9278,.7152,.7874,.0722]).buffer,p:!1}),this.psstM=new Ring,this.psstM.setDetails({title:"CbCr Magnitude",L:new Float64Array([.346430745,.342962699,.33969838,.337347957,.336560982,.337917133,.341937773,.349106433,.359887984,.374737194,.394086142,.361208741,.334229968,.31322564,.297800651,.287381612,.281345482,.279049081,.279803042,.282820273,.287167419,.2780547,.272555398,.269216643,.267119872,.265609644,.264162578,.262344581,.259835788,.256508476,.252538822,.248681245,.245993008,.245298419,.247291756,.252580435,.261730792,.275291255,.293766309,.317502734,.346430744,.340484523,.337392505,.336559654,.337660332,.340582153,.345407661,.352427205,.362187055,.375589699,.394086141,.362588341,.337932638,.318643857,.303748703,.292615326,.284863469,.280318319,.278996163,.281119417,.287167418,.269072329,.25607167,.248148933,.24525667,.247440263,.254900418,.268012927,.287301219,.313327834,.346430745]).buffer,p:!1})},LUTColourSpace.prototype.calcYCoeffs=function(t){var i=this.curOut;if(void 0!==t)for(var s=this.csOut.length,h=0;h<s;h++)this.csOut[h].name===t&&(i=h);var r,e,o,a,n=new Float64Array([1,0,0,0,1,0,0,0,1]),u=new Float64Array(9);this.csM[i].rc(n.buffer),this.csOut[this.XYZOut].lc(n.buffer),e=this.csOut[i].getWP(),o=this.system.white;for(h=0;h<3;h++)k=3*h,r=(a=this.calcCAT(new Float64Array([n[k],n[k+1],n[k+2]]),o,e,this.outCATs[i]))[0]+a[1]+a[2],u[k]=a[0]/r,u[k+1]=a[1]/r,u[k+2]=a[2]/r;var f=new Float64Array([u[0],u[3],u[6],u[1],u[4],u[7],u[2],u[5],u[8]]),l=this.mInverse(f),p=new Float64Array([e[0]/e[1],1,(1-e[0]-e[1])/e[1]]),p=this.mMult(l,p);return new Float64Array([p[0]*f[3],p[1]*f[4],p[2]*f[5]])},LUTColourSpace.prototype.setYCoeffs=function(){this.y=this.getYCoeffs(this.system.name)},LUTColourSpace.prototype.getYCoeffs=function(t){var i,s;if("number"==typeof t)i=this.g[t].xy,s=this.g[t].white;else for(var h=this.g.length,r=0;r<h;r++)this.g[r].name===t&&(i=this.g[r].xy,s=this.g[r].white);var e=new Float64Array([i[0],i[2],i[4],i[1],i[3],i[5],1-i[0]-i[1],1-i[2]-i[3],1-i[4]-i[5]]),o=this.mInverse(e),a=new Float64Array([s[0]/s[1],1,(1-s[0]-s[1])/s[1]]),a=this.mMult(o,a);return new Float64Array([a[0]*e[3],a[1]*e[4],a[2]*e[5]])},LUTColourSpace.prototype.setSaturated=function(){this.g.length;var t=this.rec709Idx,i=this.mMult(this.g[t].toSys,new Float64Array([1,1,0])),s=this.mMult(this.g[t].toSys,new Float64Array([0,1,1])),h=this.mMult(this.g[t].toSys,new Float64Array([0,1,0])),r=this.mMult(this.g[t].toSys,new Float64Array([1,0,1])),e=this.mMult(this.g[t].toSys,new Float64Array([1,0,0])),t=this.mMult(this.g[t].toSys,new Float64Array([0,0,1]));this.clrs=new Float64Array([i[0],i[1],i[2],s[0],s[1],s[2],h[0],h[1],h[2],r[0],r[1],r[2],e[0],e[1],e[2],t[0],t[1],t[2]]).buffer},LUTColourSpace.prototype.buildColourSquare=function(){var t=new Float64Array(196608);this.colSqr=t.buffer;for(var i,s,h,r,e,o=0,a=0;a<256;a++)for(var n=0;n<256;n++)h=6*n/255,r=1-a/255,r=(e=(1-Math.abs(0))*r)*(1-Math.abs(h%2-1)),r=h<1?(i=e,s=r,0):h<2?(i=r,s=e,0):h<3?(i=0,s=e,r):h<4?(i=0,s=r,e):h<5?(i=r,s=0,e):(i=e,s=0,r),e=.5-.5*e,t[o]=i+e,t[o+1]=s+e,t[o+2]=r+e,o+=3;this.csIn[this.rec709In].lc(this.colSqr)},LUTColourSpace.prototype.buildMultiColours=function(){var t,i=new Float64Array(153);this.mclrs=i.buffer;for(var s=0;s<17;s++)t=.2*Math.pow(2,s-8),i[3*s]=t/.2126,i[3*(s+17)+1]=t/.7152,i[3*(s+34)+2]=t/.0722;this.csIn[this.rec709In].lc(this.mclrs),this.multiSat=new Float64Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1])},LUTColourSpace.prototype.setCS=function(t){var i,s,h,r,e,o,a,n={};return void 0!==t.twkCS?(i=t.twkCS,n.editIdx=i.editIdx,e=0,"number"==typeof i.edit.cat&&(e=i.edit.cat),a=0,"number"==typeof i.input.cat&&(a=i.input.cat),s=0,"number"==typeof i.output.cat&&(s=i.output.cat),o={},h={},r={},!i.edit.isMatrix&&i.lock?(o.xy=new Float64Array([i.edit.rx,i.edit.ry,i.edit.gx,i.edit.gy,i.edit.bx,i.edit.by]),o.white=new Float64Array([i.edit.wx,i.edit.wy,1-i.edit.wx-i.edit.wy]),o.toXYZ=this.RGBtoXYZ(o.xy,o.white),i.edit.wcs===this.xyzIdx?this.edMatrix=this.RGBtoXYZ(o.xy,o.white):this.edMatrix=this.mMult(this.mInverse(this.g[i.edit.wcs].toXYZ),this.calcCAT(o.toXYZ,o.white,this.g[i.edit.wcs].white,e)),n.editMatrix=new Float64Array(this.edMatrix.buffer.slice(0)),n.wcs=i.edit.wcs,n.xyVals=o.xy):i.edit.isMatrix&&(o.white=new Float64Array([i.edit.wx,i.edit.wy,1-i.edit.wx-i.edit.wy]),t=this.calcCAT(this.mMult(this.g[i.edit.wcs].toXYZ,i.edit.matrix),this.g[i.edit.wcs].white,o.white,a),e=new Float64Array([t[0]+t[3]+t[6],t[1]+t[4]+t[7],t[2]+t[5]+t[8]]),o.xy=new Float64Array([Math.round(t[0]/e[0]*1e7)/1e7,Math.round(t[3]/e[0]*1e7)/1e7,Math.round(t[1]/e[1]*1e7)/1e7,Math.round(t[4]/e[1]*1e7)/1e7,Math.round(t[2]/e[2]*1e7)/1e7,Math.round(t[5]/e[2]*1e7)/1e7]),n.xyVals=o.xy),i.input.isMatrix?(h.white=new Float64Array([i.input.wx,i.input.wy,1-i.input.wx-i.input.wy]),o=i.input.wcs===this.xyzIdx?this.system.fromXYZ:this.mMult(this.system.fromXYZ,this.calcCAT(this.g[i.input.wcs].toXYZ,this.g[i.input.wcs].white,this.system.white,a)),h.toSys=this.mMult(o,i.input.matrix)):(h.white=new Float64Array([i.input.wx,i.input.wy,1-i.input.wx-i.input.wy]),h.xy=new Float64Array([i.input.rx,i.input.ry,i.input.gx,i.input.gy,i.input.bx,i.input.by]),h.toXYZ=this.RGBtoXYZ(h.xy,h.white),h.toSys=this.mMult(this.system.fromXYZ,this.calcCAT(h.toXYZ,h.white,this.system.white,a))),i.output.isMatrix?(r.white=new Float64Array([i.output.wx,i.output.wy,1-i.output.wx-i.output.wy]),a=i.output.wcs===this.xyzIdx?this.system.toXYZ:this.mInverse(this.mMult(this.system.fromXYZ,this.calcCAT(this.g[i.output.wcs].toXYZ,this.g[i.output.wcs].white,this.system.white,s))),r.fromSys=this.mMult(i.output.matrix,a)):(r.white=new Float64Array([i.output.wx,i.output.wy,1-i.output.wx-i.output.wy]),r.xy=new Float64Array([i.output.rx,i.output.ry,i.output.gx,i.output.gy,i.output.bx,i.output.by]),r.toXYZ=this.RGBtoXYZ(r.xy,r.white),r.fromSys=this.mInverse(this.mMult(this.system.fromXYZ,this.calcCAT(r.toXYZ,r.white,this.system.white,s)))),this.csIn[this.custIn]=new CSMatrix("Custom",h.toSys,h.white.buffer),this.csOut[this.custOut]=new CSMatrix("Custom",r.fromSys,r.white.buffer),this.csM[this.custOut]=this.csOut[this.custOut],n.doCS=!0):n.doCS=!1,n},LUTColourSpace.prototype.setWB=function(t){var i,s={};return this.doWB=!1,!this.tweaks||void 0===t.twkWB||"boolean"==typeof(i=t.twkWB).doWB&&i.doWB&&(this.doWB=!0,"number"==typeof i.CAT&&(this.wb.setModel(i.CAT),s.CAT=t.CAT),s.ref=i.ref,s.ctShift=i.ctShift,s.lampShift=i.lampShift,s.duv=i.duv,s.dpl=i.dpl,this.wb.setVals(i.ref,i.ctShift,i.lampShift,i.duv,i.dpl)),s.doWB=this.doWB,s},LUTColourSpace.prototype.setASCCDL=function(t){var i={};if(this.doASCCDL=!1,this.changedASCCDL=!1,this.tweaks&&void 0!==t.twkASCCDL){var s=t.twkASCCDL;if("boolean"==typeof s.doASCCDL&&(t=this.doASCCDL,this.doASCCDL=s.doASCCDL,t&&!this.doASCCDL&&(this.changedASCCDL=!0)),void 0!==s.cdl)for(var h=new Float64Array(s.cdl),r=0;r<10;r++)if(h[r]!==this.asc[r]){this.asc=h,r<9&&(this.changedASCCDL=!0);break}}return i.doASCCDL=this.doASCCDL,i},LUTColourSpace.prototype.setPSSTCDL=function(t){var i={};return this.doPSSTCDL=!1,!this.tweaks||void 0===t.twkPSSTCDL||"boolean"==typeof(t=t.twkPSSTCDL).doPSSTCDL&&t.doPSSTCDL&&(this.doPSSTCDL=!0,void 0!==t.c&&this.psstC.setL(t.c),void 0!==t.sat&&this.psstSat.setL(t.sat),void 0!==t.s&&this.psstS.setL(t.s),void 0!==t.o&&this.psstO.setL(t.o),void 0!==t.p&&this.psstP.setL(t.p),"boolean"==typeof t.chromaScale&&(this.psstMC=t.chromaScale),"boolean"==typeof t.lumaScale&&(this.psstYC=t.lumaScale)),i.doPSSTCDL=this.doPSSTCDL,i},LUTColourSpace.prototype.setHG=function(t){var i={};return this.doHG=!1,this.curHG=this.curOut,this.tweaks&&void 0!==t.twkHG&&("boolean"==typeof(t=t.twkHG).doHG&&t.doHG&&(this.doHG=!0),"number"==typeof t.gamut&&(this.curHG=t.gamut),"boolean"==typeof t.lin?(this.hgLin=t.lin,i.lin=this.hgLin):this.doHG=!1,"number"==typeof t.low?(this.hgLowStop=t.low,this.hgLow=Math.pow(2,this.hgLowStop)/5,i.low=this.hgLowStop):this.doHG=!1,"number"==typeof t.high?(this.hgHighStop=t.high,this.hgHigh=Math.pow(2,this.hgHighStop)/5,i.high=this.hgHighStop):this.doHG=!1),i.gamut=this.curHG,i.doHG=this.doHG,i},LUTColourSpace.prototype.setMulti=function(t){var i={};if(this.doMulti=!1,this.tweaks&&void 0!==t.twkMulti){t=t.twkMulti;if("boolean"==typeof t.doMulti&&t.doMulti&&(this.doMulti=!0),void 0!==t.sat&&(this.multiSat=new Float64Array(t.sat)),void 0!==t.sat&&(this.multiSat=new Float64Array(t.sat)),void 0!==t.pHue&&void 0!==t.pSat&&void 0!==t.pStop){this.multiStop=new Float64Array(t.pStop);var s=new Uint8Array(t.pHue),h=new Uint8Array(t.pSat),r=this.multiStop.length;this.multiRGB=new Float64Array(3*r);for(var e,o=new Float64Array(this.colSqr),a=0;a<r;a++)e=3*(s[a]+256*(255-h[a])),this.multiRGB[3*a]=o[e],this.multiRGB[3*a+1]=o[1+e],this.multiRGB[3*a+2]=o[2+e];this.csOut[this.curOut].lc(this.multiRGB.buffer)}else this.multiStop=new Float64Array([0]),this.multiRGB=new Float64Array([1,1,1])}return i.doMulti=this.doMulti,i},LUTColourSpace.prototype.setSDRSat=function(t){var i={};return this.doSDRSat=!1,!this.tweaks||void 0===t.twkSDRSat||"boolean"==typeof(t=t.twkSDRSat).doSDRSat&&t.doSDRSat&&(this.doSDRSat=!0,"number"==typeof t.gamma&&(this.sdrSatGamma=t.gamma)),i.doSDRSat=this.doSDRSat,i},LUTColourSpace.prototype.setGamutLim=function(t){if(this.doGamutLim=!1,this.tweaks&&void 0!==t.twkGamutLim){var i=t.twkGamutLim;if("boolean"==typeof i.doGamutLim&&i.doGamutLim){if(this.doGamutLim=!0,this.gLimY=this.calcYCoeffs(),"string"==typeof i.gamut){this.gLimC=!1,this.gLimB=!0;for(var s=this.csOut.length,h=0;h<s;h++)if(this.csOut[h].name===i.gamut){if(h===this.curOut){this.gLimGIn=0,this.gLimGOut=this.curOut;break}this.gLimGOut=h;for(var r=this.csIn.length,e=0;e<r;e++)if(this.csIn[e].name===this.csOut[this.curOut].name){this.gLimGIn=e,this.gLimC=!0,this.gLimB=i.both;break}break}}else this.gLimC=!1;"boolean"==typeof i.lin?this.gLimLin=i.lin:this.gLimLin=!1,"number"==typeof i.level&&(this.gLimL=parseFloat(i.level))}}return{}},LUTColourSpace.prototype.setFC=function(t){var i,s,h={};return this.doFC=!1,this.fcVals[0]=-10,this.fcVals[1]=-10,this.fcVals[2]=-10,this.fcVals[3]=-10,this.fcVals[4]=-10,this.fcVals[5]=-10,this.fcVals[6]=-10,this.fcVals[7]=-10,this.fcVals[8]=-10,this.fcVals[9]=-10,this.doFCPurple=!1,this.doFCYellow=!1,this.doFCRed=!1,!this.tweaks||void 0===t.twkFC||"boolean"==typeof(i=t.twkFC).doFC&&i.doFC&&(s=this.doFC=!0,void 0!==i.fcs?((t=i.fcs)[0]&&(this.fcVals[0]=.2*Math.pow(2,-8),s=!(this.doFCPurple=!0)),t[1]&&("number"==typeof i.blue?this.fcVals[1]=.2*Math.pow(2,-i.blue):this.fcVals[1]=.2*Math.pow(2,-6.1),this.fcVals[0]=.2*Math.pow(2,-10),s=!1),t[2]&&(this.fcVals[2]=.174110113,s=!(this.fcVals[3]=.229739671)),t[3]&&(this.fcVals[4]=.354307008,s=!(this.fcVals[5]=.451585762)),t[4]&&(this.fcVals[6]=.885767519,s=!(this.fcVals[7]=1.128964405)),t[5]&&("number"==typeof i.yellow?"number"==typeof i.red?this.fcVals[8]=.2*Math.pow(2,i.red-i.yellow):this.fcVals[8]=.2*Math.pow(2,5.95-i.yellow):"number"==typeof i.red?this.fcVals[8]=.2*Math.pow(2,i.red-.26):this.fcVals[8]=.2*Math.pow(2,5.69),this.fcVals[9]=.2*Math.pow(2,5.95),s=!(this.doFCYellow=!0)),t[6]&&("number"==typeof i.red?this.fcVals[9]=.2*Math.pow(2,i.red):this.fcVals[9]=.2*Math.pow(2,5.95),s=!(this.doFCRed=!0)),s&&(this.doFC=!1)):this.doFC=!1),h.blue=Math.log(this.fcVals[1]/.2)/Math.log(2),h.yellow=Math.log(this.fcVals[8]/.2)/Math.log(2),h.red=Math.log(this.fcVals[9]/.2)/Math.log(2),h.doFC=this.doFC,h},LUTColourSpace.prototype.FCOut=function(t,i){var s,h,r=new Float64Array(t),e=r.length,o=this.y,a=new Uint8Array(e/3);i.fc=a.buffer,i.to.push("fc");for(var n=0;n<e;n+=3){h=parseInt(n/3),s=o[0]*r[n]+o[1]*r[n+1]+o[2]*r[n+2];for(var u=0;u<10;u++)if(-10!==this.fcVals[u]&&s<=this.fcVals[u]){a[h]=u;break}0===a[h]&&this.doFCRed&&s>this.fcVals[9]?a[h]=10:(0===a[h]&&s>this.fcVals[0]||0===a[h]&&!this.doFCPurple&&s<.1||9===a[h]&&!this.doFCYellow)&&(a[h]=8)}},LUTColourSpace.prototype.PSSTCDLOut=function(t){for(var i,s,h,r,e,o,a=new Float64Array(t),n=a.length,u=this.y,f=2*(1-u[2]),l=2*(1-u[0]),p=0;p<n;p+=3){var c,m,y=u[0]*a[p]+u[1]*a[p+1]+u[2]*a[p+2],F=(a[p+2]-y)/f,L=(a[p]-y)/l,C=Math.pow(F*F+L*L,.5);(m=Math.atan2(L,F)/(2*Math.PI))<0&&(m+=1),o=this.psstF.fCub(m),i=this.psstY.fLin(o),e=this.psstM.fLin(o),s=this.psstC.fCub(o),h=Math.max(0,this.psstSat.fCub(o)),r=Math.max(0,this.psstS.fCub(o)),c=this.psstO.fCub(o),m=Math.max(0,this.psstP.fCub(o)),o=(o+s)%1,s=this.psstYC?this.psstY.fLin(o):i,e=C*h*(this.psstMC?this.psstM.fLin(o):e)/e,o=this.psstB.fCub(o),L=.005<C?(y=(y=y*r/i+c)<0?y:Math.pow(y,m),y=isNaN(y)?0:y,y*=s,F=e*Math.cos(o),e*Math.sin(o)):(c=(c=y*r/i+c)<0?c:Math.pow(c,m),c=isNaN(c)?0:c,y=((.005-C)*y+C*(c*=s))/.005,F=((.005-C)*F+C*e*Math.cos(o))/.005,((.005-C)*L+C*e*Math.sin(o))/.005),a[p]=L*l+y,a[p+2]=F*f+y,a[p+1]=(y-u[0]*a[p]-u[2]*a[p+2])/u[1]}},LUTColourSpace.prototype.ASCCDLOut=function(t){for(var i,s=new Float64Array(t),h=s.length,r=this.y,e=0;e<h;e+=3)s[e]=s[e]*this.asc[0]+this.asc[3],s[e]=s[e]<0?s[e]:Math.pow(s[e],this.asc[6]),s[e]=isNaN(s[e])?0:s[e],s[e+1]=s[e+1]*this.asc[1]+this.asc[4],s[e+1]=s[e+1]<0?s[e+1]:Math.pow(s[e+1],this.asc[7]),s[e+1]=isNaN(s[e+1])?0:s[e+1],s[e+2]=s[e+2]*this.asc[2]+this.asc[5],s[e+2]=s[e+2]<0?s[e+2]:Math.pow(s[e+2],this.asc[8]),s[e+2]=isNaN(s[e+2])?0:s[e+2],i=r[0]*s[e]+r[1]*s[e+1]+r[2]*s[e+2],s[e]=i+this.asc[9]*(s[e]-i),s[e+1]=i+this.asc[9]*(s[e+1]-i),s[e+2]=i+this.asc[9]*(s[e+2]-i)},LUTColourSpace.prototype.multiOut=function(t){for(var i,s,h,r,e,o,a,n=new Float64Array(t),u=n.length,f=this.multiStop.length,l=new Float64Array(3),p=0;p<u;p+=3){if((i=this.y[0]*n[p]+this.y[1]*n[p+1]+this.y[2]*n[p+2])<=0)h=this.multiSat[0],l[0]=i,l[1]=i,l[2]=i;else if(1<=(h=(s=Math.log(i/.2)/Math.LN2+8)<=0?this.multiSat[0]:16<=s?this.multiSat[16]:(1-(r=s-(e=Math.floor(s))))*this.multiSat[e]+r*this.multiSat[e+1]))l[0]=i,l[1]=i,l[2]=i;else{if(1===f)l[0]=this.multiRGB[0],l[1]=this.multiRGB[1],l[2]=this.multiRGB[2];else if(1<f){s-=8,o=f-1,a=f;for(var c=0;c<f;c++)if(this.multiStop[c]>s){o=c-1,a=c;break}o<0?(l[0]=this.multiRGB[0],l[1]=this.multiRGB[1],l[2]=this.multiRGB[2]):f<=a?(l[0]=this.multiRGB[3*(f-1)],l[1]=this.multiRGB[3*(f-1)+1],l[2]=this.multiRGB[3*(f-1)+2]):(r=(s-this.multiStop[o])/(this.multiStop[a]-this.multiStop[o]),l[0]=(1-r)*this.multiRGB[3*o]+r*this.multiRGB[3*a],l[1]=(1-r)*this.multiRGB[3*o+1]+r*this.multiRGB[3*a+1],l[2]=(1-r)*this.multiRGB[3*o+2]+r*this.multiRGB[3*a+2])}else l[0]=i,l[1]=i,l[2]=i;0<f&&(0<(e=this.y[0]*l[0]+this.y[1]*l[1]+this.y[2]*l[2])?(e=i/e,l[0]*=e,l[1]*=e,l[2]*=e):(l[0]=i,l[1]=i,l[2]=i))}n[p]=l[0]+h*(n[p]-l[0]),n[p+1]=l[1]+h*(n[p+1]-l[1]),n[p+2]=l[2]+h*(n[p+2]-l[2])}},LUTColourSpace.prototype.HGOut=function(t,i){var s,h=new Float64Array(t),r=h.length,e=this.y,o=new Float64Array(h.buffer.slice(0));"boolean"==typeof i&&i?(this.csOut[this.curOut].lc(t),this.csOut[this.curHG].lc(o.buffer)):(this.csOut[this.curOut].lf(t),this.csOut[this.curHG].lf(o.buffer));for(var a=0;a<r;a+=3)(s=e[0]*h[a]+e[1]*h[a+1]+e[2]*h[a+2])>=this.hgHigh?(h[a]=o[a],h[a+1]=o[a+1],h[a+2]=o[a+2]):s>this.hgLow&&(s=this.hgLin?(this.hgHigh-s)/(this.hgHigh-this.hgLow):(this.hgHighStop-Math.log(5*s)/Math.LN2)/(this.hgHighStop-this.hgLowStop),h[a]=h[a]*s+o[a]*(1-s),h[a+1]=h[a+1]*s+o[a+1]*(1-s),h[a+2]=h[a+2]*s+o[a+2]*(1-s))},LUTColourSpace.prototype.SDRSatOut=function(t){if(void 0!==this.Ys[this.csOut[this.curOut].name])for(var i,s,h,r=new Float64Array(t),e=r.length,o=this.Ys[this.csOut[this.curOut].name],a=2*(1-o[2]),n=2*(1-o[0]),u=this.sdrSatGamma,f=1/u,l=0;l<e;l+=3)i=r[l]<0?r[l]/12:Math.pow(r[l]/12,f),i=isNaN(i)?0:i,s=r[l+1]<0?r[l+1]/12:Math.pow(r[l+1]/12,f),s=isNaN(s)?0:s,h=r[l+2]<0?r[l+2]/12:Math.pow(r[l+2]/12,f),h=isNaN(h)?0:h,0<(s=o[0]*i+o[1]*s+o[2]*h)&&(h=(h-s)/a,i=(i-s)/n,s=Math.pow(s,u),r[l]=i*n+s,r[l+2]=h*a+s,r[l+1]=(s-o[0]*r[l]-o[2]*r[l+2])/o[1],r[l]*=12,r[l+1]*=12,r[l+2]*=12)},LUTColourSpace.prototype.gamutLimOut=function(t,i){var s,h=new Float64Array(t),r=h.length;this.y;if(this.gLimLin)if(i.doGamutLim=!1,this.gLimC){for(var e=0;e<r;e++)h[e]=Math.max(0,h[e]);var o=new Float64Array(h.buffer.slice(0));this.csIn[this.gLimGIn].lc(o.buffer),this.csOut[this.gLimGOut].lc(o.buffer);var a=this.gLimY,n=this.gLimL;if(this.gLimB)for(var u,f,e=0;e<r;e+=3)parseInt(e/3),l=Math.max(h[e],h[e+1],h[e+2]),p=Math.min(h[e],h[e+1],h[e+2]),u=Math.max(o[e],o[e+1],o[e+2]),f=Math.min(o[e],o[e+1],o[e+2]),1<(c=Math.max(l-p,u-f)/n)&&(s=a[0]*h[e]+a[1]*h[e+1]+a[2]*h[e+2],h[e]=s+(h[e]-s)/c,h[e+1]=s+(h[e+1]-s)/c,h[e+2]=s+(h[e+2]-s)/c);else for(e=0;e<r;e+=3)parseInt(e/3),1<(c=((l=Math.max(o[e],o[e+1],o[e+2]))-(p=Math.min(o[e],o[e+1],o[e+2])))/n)&&(s=a[0]*h[e]+a[1]*h[e+1]+a[2]*h[e+2],h[e]=s+(h[e]-s)/c,h[e+1]=s+(h[e+1]-s)/c,h[e+2]=s+(h[e+2]-s)/c)}else for(var l,p,c,a=this.gLimY,n=this.gLimL,e=0;e<r;e+=3)parseInt(e/3),h[e]=Math.max(0,h[e]),h[e+1]=Math.max(0,h[e+1]),h[e+2]=Math.max(0,h[e+2]),n<(l=Math.max(h[e],h[e+1],h[e+2]))&&1<(c=(l-(p=Math.min(h[e],h[e+1],h[e+2])))/n)&&(s=a[0]*h[e]+a[1]*h[e+1]+a[2]*h[e+2],h[e]=s+(h[e]-s)/c,h[e+1]=s+(h[e+1]-s)/c,h[e+2]=s+(h[e+2]-s)/c);else i.doGamutLim=!0,i.gLimY=this.gLimY,i.gLimL=this.gLimL,this.gLimC&&(o=new Float64Array(h.buffer.slice(0)),this.csIn[this.gLimGIn].lc(o.buffer),this.csOut[this.gLimGOut].lc(o.buffer),i.og=o.buffer,i.to.push("og"),i.gLimB=this.gLimB)},CCTxy.prototype.setxy=function(t,i){this.u=4*t/(-2*t+12*i+3),this.v=6*i/(-2*t+12*i+3)},CCTxy.prototype.setuv=function(t,i){this.u=t,this.v=i},CCTxy.prototype.f=function(t){var i=t-.05,t=t+.05,i=this.lut.fRGBCub(i),i=new Float64Array([4*i[0]/(-2*i[0]+12*i[1]+3),6*i[1]/(-2*i[0]+12*i[1]+3)]),t=this.lut.fRGBCub(t),t=new Float64Array([4*t[0]/(-2*t[0]+12*t[1]+3),6*t[1]/(-2*t[0]+12*t[1]+3)]);return 10*(Math.pow(Math.pow(this.u-i[0],2)+Math.pow(this.v-i[1],2),.5)-Math.pow(Math.pow(this.u-t[0],2)+Math.pow(this.v-t[1],2),.5))},Planck.prototype.setLoci=function(t){this.loci=t.newLUT({title:"loci",format:"cube",dims:1,s:501,min:[100,100,100],max:[50100,50100,50100],C:[new Float64Array([.7346901,.7346893,.7343438,.7304724,.7213855,.7092079,.6955663,.6813343,.6669815,.6527507,.6387563,.6250448,.6116315,.5985211,.585718,.5732296,.5610674,.5492451,.5377773,.5266775,.5159573,.5056253,.4956867,.4861436,.4769946,.4682353,.459859,.4518569,.4442182,.4369311,.4299827,.4233596,.417048,.4110339,.4053035,.3998431,.3946393,.389679,.3849498,.3804395,.3761367,.3720303,.3681099,.3643654,.3607875,.3573673,.3540963,.3509665,.3479705,.3451012,.3423519,.3397163,.3371885,.3347629,.3324344,.3301979,.3280487,.3259827,.3239954,.3220832,.3202423,.3184693,.3167609,.3151141,.3135259,.3119936,.3105146,.3090864,.3077068,.3063736,.3050847,.3038382,.3026321,.3014648,.3003345,.2992398,.298179,.2971509,.296154,.295187,.2942488,.2933382,.2924541,.2915955,.2907613,.2899506,.2891625,.2883962,.2876509,.2869256,.2862198,.2855327,.2848636,.2842119,.2835769,.2829581,.2823549,.2817668,.2811931,.2806336,.2800876,.2795547,.2790345,.2785265,.2780304,.2775458,.2770723,.2766095,.2761572,.2757149,.2752824,.2748594,.2744456,.2740407,.2736444,.2732565,.2728767,.2725048,.2721406,.2717838,.2714343,.2710918,.2707561,.270427,.2701044,.2697881,.2694778,.2691735,.268875,.2685821,.2682946,.2680125,.2677356,.2674637,.2671968,.2669346,.2666771,.2664242,.2661757,.2659315,.2656916,.2654558,.265224,.2649961,.264772,.2645517,.2643351,.264122,.2639123,.2637061,.2635032,.2633035,.263107,.2629136,.2627232,.2625358,.2623513,.2621696,.2619907,.2618144,.2616409,.2614699,.2613014,.2611355,.2609719,.2608108,.260652,.2604954,.2603411,.260189,.260039,.2598911,.2597453,.2596015,.2594597,.2593198,.2591818,.2590457,.2589114,.2587788,.2586481,.2585191,.2583917,.258266,.258142,.2580195,.2578986,.2577792,.2576614,.257545,.2574301,.2573166,.2572046,.2570939,.2569845,.2568765,.2567698,.2566643,.2565602,.2564572,.2563555,.256255,.2561557,.2560575,.2559605,.2558645,.2557697,.2556759,.2555833,.2554916,.255401,.2553114,.2552228,.2551352,.2550485,.2549628,.254878,.2547942,.2547112,.2546291,.2545479,.2544676,.2543881,.2543095,.2542317,.2541546,.2540784,.254003,.2539283,.2538544,.2537813,.2537089,.2536372,.2535663,.253496,.2534265,.2533576,.2532894,.2532219,.2531551,.2530888,.2530233,.2529583,.252894,.2528303,.2527672,.2527047,.2526428,.2525815,.2525207,.2524605,.2524009,.2523418,.2522832,.2522252,.2521677,.2521107,.2520543,.2519983,.2519429,.2518879,.2518334,.2517795,.2517259,.2516729,.2516203,.2515682,.2515165,.2514653,.2514145,.2513641,.2513142,.2512647,.2512156,.2511669,.2511186,.2510708,.2510233,.2509762,.2509295,.2508832,.2508373,.2507917,.2507465,.2507017,.2506572,.2506131,.2505694,.250526,.2504829,.2504402,.2503978,.2503558,.2503141,.2502727,.2502316,.2501908,.2501504,.2501102,.2500704,.2500309,.2499917,.2499527,.2499141,.2498757,.2498377,.2497999,.2497624,.2497252,.2496882,.2496516,.2496152,.249579,.2495432,.2495075,.2494722,.2494371,.2494022,.2493676,.2493333,.2492991,.2492653,.2492316,.2491982,.2491651,.2491321,.2490994,.249067,.2490347,.2490027,.2489709,.2489393,.2489079,.2488767,.2488458,.248815,.2487845,.2487542,.248724,.2486941,.2486644,.2486348,.2486055,.2485764,.2485474,.2485186,.2484901,.2484617,.2484335,.2484054,.2483776,.2483499,.2483224,.2482951,.248268,.248241,.2482142,.2481876,.2481611,.2481348,.2481087,.2480827,.2480569,.2480313,.2480058,.2479804,.2479553,.2479302,.2479054,.2478806,.2478561,.2478317,.2478074,.2477833,.2477593,.2477354,.2477117,.2476882,.2476648,.2476415,.2476183,.2475953,.2475724,.2475497,.2475271,.2475046,.2474823,.2474601,.247438,.247416,.2473942,.2473725,.2473509,.2473294,.2473081,.2472868,.2472657,.2472448,.2472239,.2472031,.2471825,.247162,.2471416,.2471213,.2471011,.247081,.2470611,.2470412,.2470215,.2470018,.2469823,.2469629,.2469436,.2469243,.2469052,.2468862,.2468673,.2468485,.2468298,.2468112,.2467927,.2467743,.2467559,.2467377,.2467196,.2467016,.2466836,.2466658,.246648,.2466304,.2466128,.2465953,.2465779,.2465606,.2465434,.2465263,.2465093,.2464923,.2464754,.2464587,.246442,.2464254,.2464088,.2463924,.246376,.2463597,.2463435,.2463274,.2463114,.2462954,.2462795,.2462637,.246248,.2462323,.2462167,.2462012,.2461858,.2461704,.2461552,.24614,.2461248,.2461098,.2460948,.2460799,.246065,.2460502,.2460355,.2460209,.2460063,.2459918,.2459774,.245963,.2459487,.2459345,.2459203,.2459062,.2458922,.2458782,.2458643,.2458505,.2458367,.245823,.2458093,.2457957,.2457822,.2457687,.2457553,.245742,.2457287,.2457155,.2457023,.2456892,.2456761,.2456631,.2456502,.2456373,.2456245,.2456117,.245599,.2455864,.2455738]).buffer,new Float64Array([.2653099,.2653107,.2656557,.2695173,.2785681,.2906601,.3041078,.3179314,.3315172,.3444616,.3564976,.3674542,.3772323,.3857882,.3931213,.3992642,.4042739,.4082249,.4112022,.413297,.4146018,.4152076,.4152017,.4146658,.4136754,.4122992,.410599,.40863,.4064408,.404074,.4015669,.3989516,.3962561,.393504,.3907157,.3879084,.3850966,.3822926,.3795065,.3767468,.3740204,.3713329,.3686888,.3660918,.3635445,.361049,.3586068,.3562189,.3538859,.351608,.3493852,.3472171,.3451032,.3430428,.3410352,.3390794,.3371744,.3353191,.3335125,.3317534,.3300405,.3283728,.326749,.3251679,.3236283,.3221291,.320669,.319247,.3178619,.3165126,.315198,.3139171,.3126689,.3114523,.3102664,.3091102,.3079829,.3068835,.3058113,.3047652,.3037446,.3027487,.3017766,.3008278,.2999014,.2989968,.2981134,.2972504,.2964073,.2955834,.2947783,.2939913,.2932219,.2924696,.2917339,.2910143,.2903104,.2896216,.2889476,.2882878,.2876421,.2870098,.2863907,.2857843,.2851904,.2846086,.2840385,.2834798,.2829322,.2823955,.2818693,.2813533,.2808473,.280351,.2798641,.2793865,.2789178,.2784578,.2780064,.2775632,.2771282,.276701,.2762815,.2758695,.2754648,.2750672,.2746766,.2742928,.2739156,.2735448,.2731804,.2728221,.2724698,.2721234,.2717828,.2714477,.2711181,.2707939,.2704749,.270161,.2698521,.2695481,.2692488,.2689543,.2686643,.2683787,.2680975,.2678206,.2675479,.2672793,.2670147,.266754,.2664972,.2662441,.2659947,.2657489,.2655066,.2652678,.2650324,.2648004,.2645715,.2643459,.2641234,.2639039,.2636875,.263474,.2632634,.2630557,.2628507,.2626484,.2624488,.2622519,.2620575,.2618657,.2616763,.2614893,.2613048,.2611226,.2609427,.2607651,.2605897,.2604164,.2602453,.2600764,.2599094,.2597445,.2595817,.2594207,.2592617,.2591046,.2589494,.2587959,.2586443,.2584945,.2583464,.2582,.2580552,.2579122,.2577707,.2576309,.2574926,.2573559,.2572207,.257087,.2569548,.256824,.2566946,.2565667,.2564401,.2563149,.2561911,.2560685,.2559473,.2558273,.2557086,.2555912,.255475,.2553599,.2552461,.2551334,.2550219,.2549115,.2548022,.254694,.2545869,.2544809,.2543759,.254272,.2541691,.2540672,.2539663,.2538663,.2537674,.2536694,.2535723,.2534761,.2533809,.2532866,.2531931,.2531006,.2530089,.252918,.252828,.2527388,.2526505,.2525629,.2524761,.2523902,.252305,.2522205,.2521369,.2520539,.2519717,.2518903,.2518095,.2517295,.2516501,.2515715,.2514935,.2514162,.2513396,.2512636,.2511883,.2511136,.2510395,.2509661,.2508932,.250821,.2507494,.2506784,.2506079,.2505381,.2504688,.2504001,.2503319,.2502643,.2501973,.2501307,.2500648,.2499993,.2499344,.2498699,.249806,.2497426,.2496797,.2496172,.2495553,.2494938,.2494328,.2493723,.2493123,.2492527,.2491935,.2491348,.2490766,.2490188,.2489614,.2489044,.2488479,.2487918,.2487361,.2486808,.2486259,.2485715,.2485174,.2484637,.2484104,.2483575,.248305,.2482528,.248201,.2481496,.2480986,.2480479,.2479976,.2479476,.247898,.2478487,.2477997,.2477511,.2477029,.2476549,.2476073,.2475601,.2475131,.2474665,.2474202,.2473742,.2473285,.2472831,.247238,.2471932,.2471487,.2471045,.2470606,.247017,.2469737,.2469306,.2468879,.2468454,.2468032,.2467613,.2467196,.2466782,.2466371,.2465962,.2465556,.2465152,.2464751,.2464353,.2463957,.2463564,.2463173,.2462784,.2462398,.2462014,.2461633,.2461254,.2460877,.2460503,.2460131,.2459761,.2459393,.2459028,.2458665,.2458304,.2457945,.2457588,.2457234,.2456881,.2456531,.2456182,.2455836,.2455492,.245515,.245481,.2454471,.2454135,.2453801,.2453469,.2453138,.245281,.2452483,.2452158,.2451835,.2451514,.2451195,.2450877,.2450562,.2450248,.2449936,.2449625,.2449317,.244901,.2448704,.2448401,.2448099,.2447799,.24475,.2447203,.2446908,.2446614,.2446322,.2446032,.2445743,.2445455,.2445169,.2444885,.2444602,.2444321,.2444041,.2443763,.2443486,.2443211,.2442937,.2442664,.2442393,.2442123,.2441855,.2441588,.2441323,.2441059,.2440796,.2440535,.2440275,.2440016,.2439759,.2439503,.2439248,.2438994,.2438742,.2438491,.2438241,.2437993,.2437746,.24375,.2437255,.2437012,.243677,.2436528,.2436289,.243605,.2435812,.2435576,.2435341,.2435107,.2434874,.2434642,.2434411,.2434182,.2433953,.2433726,.24335,.2433275,.243305,.2432827,.2432605,.2432384,.2432165,.2431946,.2431728,.2431511,.2431295,.2431081,.2430867,.2430654,.2430442,.2430232,.2430022,.2429813,.2429605,.2429398,.2429192,.2428987,.2428783,.242858,.2428378,.2428176,.2427976,.2427776,.2427578,.242738,.2427183,.2426987,.2426792,.2426598,.2426405,.2426212,.2426021,.242583,.242564,.2425451,.2425262,.2425075,.2424888,.2424702,.2424517,.2424333,.242415,.2423967,.2423785]).buffer,new Float64Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]).buffer]})},Planck.prototype.getCCT=function(t){if(t[0]<0||t[1]<0||1<t[0]+t[1])return!1;var i=4*t[0]/(-2*t[0]+12*t[1]+3),s=6*t[1]/(-2*t[0]+12*t[1]+3);if(left=.23914479*(s-.2740731)-(.2012049-.2740731)*(i-.18293282),left<=0)return 25e3;this.slope.setuv(i,s);for(var h,r,e=0,o=999,a=new Float64Array(2),n=0;n<26;n++)100<(h=this.brent.findRoot(1e3*n+100,0))&&(r=this.loci.fRGBCub(h),a=this.xy2uv(r),(r=Math.pow(Math.pow(i-a[0],2)+Math.pow(s-a[1],2),.5))<o&&(e=h,o=r));return e<500?e=500:25e3<e&&(e=25e3),Math.round(e)},Planck.prototype.getDuvMag=function(t,i){var s=this.loci.fRGBCub(i),h=this.loci.fRGBCub(i+.1),r=this.loci.fRGBCub(i-.1),e=this.xy2uv(s),o=this.xy2uv(h),a=this.xy2uv(r),i=this.xy2uv(t),s=a[0]-o[0],h=a[1]-o[1],r=-(s*e[0])-h*e[1],t=(h*(h*i[0]-s*i[1])-s*r)/(s*s+h*h),r=(s*(-h*i[0]+s*i[1])-h*r)/(s*s+h*h),s=t-e[0],h=r-e[1],o=(o[0]-a[0])*(r-a[1])-(o[1]-a[1])*(t-a[0]),a=Math.pow(s*s+h*h,.5),s=t-i[0],h=r-i[1],t=(e[0]-t)*(i[1]-r)-(e[1]-r)*(i[0]-t),s=Math.pow(s*s+h*h,.5),h=new Float64Array(2);return h[0]=0<o&&1e-7<a?-a:1e-7<a?a:0,h[1]=0<t&&1e-7<s?s:1e-7<s?-s:0,h},Planck.prototype.getDxy=function(t,i){var s=this.loci.fRGBCub(i),h=this.loci.fRGBCub(i+.1),r=this.loci.fRGBCub(i-.1),e=new Float64Array([4*s[0]/(-2*s[0]+12*s[1]+3),6*s[1]/(-2*s[0]+12*s[1]+3)]),o=new Float64Array([4*h[0]/(-2*h[0]+12*h[1]+3),6*h[1]/(-2*h[0]+12*h[1]+3)]),a=new Float64Array([4*r[0]/(-2*r[0]+12*r[1]+3),6*r[1]/(-2*r[0]+12*r[1]+3)]),n=a[0]-o[0],i=a[1]-o[1],a=-(n*e[0])-i*e[1],o=4*t[0]/(-2*t[0]+12*t[1]+3),e=6*t[1]/(-2*t[0]+12*t[1]+3),t=(i*(i*o-n*e)-n*a)/(n*n+i*i),n=(n*(-i*o+n*e)-i*a)/(n*n+i*i),i=3*t/(2*t-8*n+4),t=2*n/(2*t-8*n+4),n=i-s[0],s=t-s[1],r=(h[0]-r[0])*(t-r[1])-(h[1]-r[1])*(i-r[0]),s=Math.pow(n*n+s*s,.5);return 0<r?-s:s},Planck.prototype.xyY=function(t){t=this.loci.fRGBCub(t);return t[2]=1,t},Planck.prototype.xyz=function(t){t=this.loci.fRGBCub(t);return new Float64Array([t[0],t[1],1-t[0]-t[1]])},Planck.prototype.XYZ=function(t){t=this.loci.fRGBCub(t);return new Float64Array([t[0]/t[1],1,(1-t[0]-t[1])/t[1]])},Planck.prototype.uv=function(t){var i=this.loci.fRGBCub(t),t=-2*i[0]+12*i[1]+3;return new Float64Array([4*i[0]/t,6*i[1]/t])},Planck.prototype.xy2uv=function(t){var i=-2*t[0]+12*t[1]+3;return new Float64Array([4*t[0]/i,6*t[1]/i])},Planck.prototype.uv2xy=function(t){var i=2*t[0]-8*t[1]+4;return new Float64Array([3*t[0]/i,2*t[1]/i,1-(3*t[0]+2*t[1])/i])},Planck.prototype.uv2XYZ=function(t){t=this.uv2xy(t);return new Float64Array([t[0]/t[1],1,t[2]/t[1]])},Planck.prototype.Dxy=function(t){var i=this.loci.fRGBCub(t),s=this.loci.fRGBCub(t+.1),h=this.loci.fRGBCub(t-.1),t=new Float64Array([4*i[0]/(-2*i[0]+12*i[1]+3),6*i[1]/(-2*i[0]+12*i[1]+3)]),s=new Float64Array([4*s[0]/(-2*s[0]+12*s[1]+3),6*s[1]/(-2*s[0]+12*s[1]+3)]),h=new Float64Array([4*h[0]/(-2*h[0]+12*h[1]+3),6*h[1]/(-2*h[0]+12*h[1]+3)]),h=Math.atan2(h[1]-s[1],h[0]-s[0])+Math.PI/2,s=t[0]+Math.sin(h),t=t[1]+Math.cos(h),h=2*t/(2*s-8*t+4),t=3*s/(2*s-8*t+4)-i[0],h=h-i[1],i=Math.pow(t*t+h*h,.5);return new Float64Array([i,Math.atan2(h,t)])},Planck.prototype.Duv=function(t){var i=this.uv(t+1),s=this.uv(t-1),t=s[0]-i[0],s=s[1]-i[1],i=Math.atan2(t,-s),t=Math.atan2(s,t);return new Float64Array([i,t])},CSCAT.prototype.models=function(){this.addModel("CIECAT02",new Float64Array([.7328,.4296,-.1624,-.7036,1.6975,.0061,.003,.0136,.9834])),this.addModel("CIECAT97s",new Float64Array([.8562,.3372,-.1934,-.836,1.8327,.0033,.0357,-.0469,1.0112])),this.addModel("Bradford Chromatic Adaptation",new Float64Array([.8951,.2664,-.1614,-.7502,1.7135,.0367,.0389,-.0685,1.0296])),this.addModel("Von Kries",new Float64Array([.40024,.7076,-.08081,-.2263,1.16532,.0457,0,0,.91822])),this.addModel("Sharp",new Float64Array([1.2694,-.0988,-.1706,-.8364,1.8006,.0357,.0297,-.0315,1.0018])),this.addModel("CMCCAT2000",new Float64Array([.7982,.3389,-.1371,-.5918,1.5512,.0406,8e-4,.0239,.9753])),this.addModel("Bianco BS",new Float64Array([.8752,.2787,-.1539,-.8904,1.8709,.0195,-.0061,.0162,.9899])),this.addModel("Bianco BS-PC",new Float64Array([.6489,.3915,-.0404,-.3775,1.3055,.072,-.0271,.0888,.9383])),this.addModel("XYZ Scaling",new Float64Array([1,0,0,0,1,0,0,0,1]))},CSCAT.prototype.addModel=function(t,i){this.names.push(t),this.lower.push(t.toLowerCase()),this.M.push(i)},CSCAT.prototype.getModel=function(t){return"string"==typeof t&&isNaN(t)?t=this.modelIdx(t):"number"==typeof t&&!isNaN(t)||(t=this.def),new Float64Array(this.M[t])},CSCAT.prototype.getModels=function(){return this.names.slice(0)},CSCAT.prototype.modelIdx=function(t){if("number"==typeof t&&!isNaN(t))return t;if(void 0===t||""===t)return this.def;for(var i=this.lower.length,s=0;s<i;s++)if(t.toLowerCase()===this.lower[s])return s;return this.def},CSCAT.prototype.setDefault=function(t){if("string"!=typeof t||""===t)return this.def=0;for(var i=this.lower.length,s=0;s<i;s++)if(t.toLowerCase()===this.lower[s])return this.def=s;return this.def=0},CSWB.prototype.getSys=function(){return this.CCT0},CSWB.prototype.setModel=function(t){this.cur=t,this.M=this.CATs.getModel(t),this.Minv=this.mInverse(this.M),this.setToLocus(),this.setCAT()},CSWB.prototype.setToLocus=function(){var t=this.mMult(this.M,this.sysWhiteXYZ),i=this.mMult(this.M,this.planck.XYZ(this.CCT0)),t=new Float64Array([i[0]/t[0],0,0,0,i[1]/t[1],0,0,0,i[2]/t[2]]);this.Ntolocus=this.mMult(this.Minv,this.mMult(t,this.M))},CSWB.prototype.setCAT=function(){this.mMult(this.M,this.planck.XYZ(this.CCT0));var t=this.mMult(this.M,this.planck.XYZ(this.base)),i=this.mMult(this.M,this.planck.XYZ(this.ct)),s=this.mMult(this.M,this.planck.XYZ(this.lamp)),h=this.planck.uv(this.lamp),r=this.planck.Duv(this.lamp);this.uvAdd(h,this.duv*Math.cos(r[0])+this.dpl*Math.cos(r[1]),this.duv*Math.sin(r[0])+this.dpl*Math.sin(r[1]));h=this.mMult(this.M,this.planck.uv2XYZ(h)),i=new Float64Array([t[0]/i[0],0,0,0,t[1]/i[1],0,0,0,t[2]/i[2]]),h=new Float64Array([s[0]/h[0],0,0,0,s[1]/h[1],0,0,0,s[2]/h[2]]),i=this.mMult(this.mMult(this.mMult(h,i),this.M),this.fromSys);this.N=this.mMult(this.toSys,this.mMult(this.Minv,i)),this.NInv=this.mInverse(this.N)},CSWB.prototype.uvAdd=function(t,i,s){t[0]+=i,t[1]+=s;i=this.planck.uv2xy(t);i[0]<0&&(i[0]=0),i[1]<0&&(i[1]=0);s=i[0]+i[1];1<s&&(i[0]/=s,i[1]/=s),i[2]=1-i[0]-i[1];i=this.planck.xy2uv(i);t[0]=i[0],t[1]=i[1]},CSWB.prototype.setVals=function(t,i,s,h,r){this.base=this.CCT0;var e=1e6/this.base;(.9*e<-i||.9*e<-s)&&(e=i<s?-i/.9:-s/.9,this.base=1e6/e),this.ct=1e6/(e+i),this.lamp=1e6/(e+s),this.duv=.0175*-h,this.dpl=.0175*r,this.setCAT()},CSWB.prototype.toLocus=function(t){return new Float64Array([this.Ntolocus[0]*t[0]+this.Ntolocus[1]*t[1]+this.Ntolocus[2]*t[2],this.Ntolocus[3]*t[0]+this.Ntolocus[4]*t[1]+this.Ntolocus[5]*t[2],this.Ntolocus[6]*t[0]+this.Ntolocus[7]*t[1]+this.Ntolocus[8]*t[2]])},CSWB.prototype.mInverse=function(t){var i=t[0]*(t[4]*t[8]-t[5]*t[7])-t[1]*(t[3]*t[8]-t[5]*t[6])+t[2]*(t[3]*t[7]-t[4]*t[6]);return 0!=i&&new Float64Array([(t[4]*t[8]-t[5]*t[7])/i,(t[2]*t[7]-t[1]*t[8])/i,(t[1]*t[5]-t[2]*t[4])/i,(t[5]*t[6]-t[3]*t[8])/i,(t[0]*t[8]-t[2]*t[6])/i,(t[2]*t[3]-t[0]*t[5])/i,(t[3]*t[7]-t[4]*t[6])/i,(t[1]*t[6]-t[0]*t[7])/i,(t[0]*t[4]-t[1]*t[3])/i])},CSWB.prototype.mMult=function(t,i){if(9!==t.length)return!1;var s,h=i.length;return 3!==h?9===h&&((s=new Float64Array(9))[0]=t[0]*i[0]+t[1]*i[3]+t[2]*i[6],s[1]=t[0]*i[1]+t[1]*i[4]+t[2]*i[7],s[2]=t[0]*i[2]+t[1]*i[5]+t[2]*i[8],s[3]=t[3]*i[0]+t[4]*i[3]+t[5]*i[6],s[4]=t[3]*i[1]+t[4]*i[4]+t[5]*i[7],s[5]=t[3]*i[2]+t[4]*i[5]+t[5]*i[8],s[6]=t[6]*i[0]+t[7]*i[3]+t[8]*i[6],s[7]=t[6]*i[1]+t[7]*i[4]+t[8]*i[7],s[8]=t[6]*i[2]+t[7]*i[5]+t[8]*i[8],s):((s=new Float64Array(3))[0]=t[0]*i[0]+t[1]*i[1]+t[2]*i[2],s[1]=t[3]*i[0]+t[4]*i[1]+t[5]*i[2],s[2]=t[6]*i[0]+t[7]*i[1]+t[8]*i[2],s)},CSWB.prototype.lc=function(t){for(var i,s,h,r=new Float64Array(t),e=r.length,o=this.N,a=0;a<e;a+=3)i=r[a],s=r[a+1],h=r[a+2],r[a]=o[0]*i+o[1]*s+o[2]*h,r[a+1]=o[3]*i+o[4]*s+o[5]*h,r[a+2]=o[6]*i+o[7]*s+o[8]*h},CSWB.prototype.rc=function(t){for(var i,s,h,r=new Float64Array(t),e=r.length,o=this.NInv,a=0;a<e;a+=3)i=r[a],s=r[a+1],h=r[a+2],r[a]=o[0]*i+o[1]*s+o[2]*h,r[a+1]=o[3]*i+o[4]*s+o[5]*h,r[a+2]=o[6]*i+o[7]*s+o[8]*h},CSSL3.prototype.f=function(t){return.01125<=(t*=.9)?(420+261.5*Math.log((t+.01)/.19)/Math.log(10))/1023:(76.2102946929*t/.01125+95)/1023},CSSL3.prototype.r=function(t){return.16736099187966763<=t?(.19*Math.pow(10,(1023*t-420)/261.5)-.01)/.9:.01125*(1023*t-95)/76.21029469289999/.9},CSLogC.prototype.f=function(t){return(t*=.9)>this.cut?this.c*Math.log(this.a*t+this.b)/Math.LN10+this.d:this.e*t+this.ff},CSLogC.prototype.r=function(t){return t>this.ecf?(Math.pow(10,(t-this.d)/this.c)-this.b)/(.9*this.a):(t-this.ff)/(.9*this.e)},CSVLog.prototype.f=function(t){return(t*=.9)<.01?5.6*t+.125:.241514*Math.log(t+.00873)/Math.log(10)+.598206},CSVLog.prototype.r=function(t){return t<.181?(t-.125)/5.6/.9:(Math.pow(10,(t-.598206)/.241514)-.00873)/.9},CSMatrix.prototype.getWP=function(){return new Float64Array(this.wp.slice(0))},CSMatrix.prototype.isMatrix=function(){return!0},CSMatrix.prototype.getMatrix=function(){return this.m},CSMatrix.prototype.cb=function(){return!1},CSMatrix.prototype.lc=function(t){for(var i,s,h,r=new Float64Array(t),e=r.length,o=this.m,a=0;a<e;a+=3)i=r[a],s=r[a+1],h=r[a+2],r[a]=o[0]*i+o[1]*s+o[2]*h,r[a+1]=o[3]*i+o[4]*s+o[5]*h,r[a+2]=o[6]*i+o[7]*s+o[8]*h},CSMatrix.prototype.lf=function(t){for(var i,s,h,r=new Float64Array(t),e=r.length,o=this.m,a=0;a<e;a+=3)i=r[a],s=r[a+1],h=r[a+2],r[a]=o[0]*i+o[1]*s+o[2]*h,r[a+1]=o[3]*i+o[4]*s+o[5]*h,r[a+2]=o[6]*i+o[7]*s+o[8]*h},CSMatrix.prototype.rc=function(t){for(var i,s,h,r=new Float64Array(t),e=r.length,o=this.mInv,a=0;a<e;a+=3)i=r[a],s=r[a+1],h=r[a+2],r[a]=o[0]*i+o[1]*s+o[2]*h,r[a+1]=o[3]*i+o[4]*s+o[5]*h,r[a+2]=o[6]*i+o[7]*s+o[8]*h},CSMatrix.prototype.mInverse=function(t){var i=t[0]*(t[4]*t[8]-t[5]*t[7])-t[1]*(t[3]*t[8]-t[5]*t[6])+t[2]*(t[3]*t[7]-t[4]*t[6]);return 0!=i&&new Float64Array([(t[4]*t[8]-t[5]*t[7])/i,(t[2]*t[7]-t[1]*t[8])/i,(t[1]*t[5]-t[2]*t[4])/i,(t[5]*t[6]-t[3]*t[8])/i,(t[0]*t[8]-t[2]*t[6])/i,(t[2]*t[3]-t[0]*t[5])/i,(t[3]*t[7]-t[4]*t[6])/i,(t[1]*t[6]-t[0]*t[7])/i,(t[0]*t[4]-t[1]*t[3])/i])},CSToneCurve.prototype.mInverse=function(t){var i=t[0]*(t[4]*t[8]-t[5]*t[7])-t[1]*(t[3]*t[8]-t[5]*t[6])+t[2]*(t[3]*t[7]-t[4]*t[6]);return 0!=i&&new Float64Array([(t[4]*t[8]-t[5]*t[7])/i,(t[2]*t[7]-t[1]*t[8])/i,(t[1]*t[5]-t[2]*t[4])/i,(t[5]*t[6]-t[3]*t[8])/i,(t[0]*t[8]-t[2]*t[6])/i,(t[2]*t[3]-t[0]*t[5])/i,(t[3]*t[7]-t[4]*t[6])/i,(t[1]*t[6]-t[0]*t[7])/i,(t[0]*t[4]-t[1]*t[3])/i])},CSToneCurve.prototype.getWP=function(){return new Float64Array(this.wp.slice(0))},CSToneCurve.prototype.isMatrix=function(){return!1},CSToneCurve.prototype.cb=function(){return this.cB},CSToneCurve.prototype.lc=function(t){var i,s,h,r=new Float64Array(t),e=r.length,o=this.sb;if(this.o)for(var a=0;a<e;a+=3)i=r[a],s=r[a+1],h=r[a+2],r[a]=this.m1[0]*i+this.m1[1]*s+this.m1[2]*h,r[a+1]=this.m1[3]*i+this.m1[4]*s+this.m1[5]*h,r[a+2]=this.m1[6]*i+this.m1[7]*s+this.m1[8]*h,r[a]=this.tc.f(this.l.f(r[a])),r[a+1]=this.tc.f(this.l.f(r[a+1])),r[a+2]=this.tc.f(this.l.f(r[a+2])),i=r[a],s=r[a+1],h=r[a+2],r[a]=this.m2[0]*i+this.m2[1]*s+this.m2[2]*h,r[a+1]=this.m2[3]*i+this.m2[4]*s+this.m2[5]*h,r[a+2]=this.m2[6]*i+this.m2[7]*s+this.m2[8]*h,r[a]=this.l.r(this.tc.r(r[a])),r[a+1]=this.l.r(this.tc.r(r[a+1])),r[a+2]=this.l.r(this.tc.r(r[a+2])),o||(r[a]=Math.max(0,r[a]),r[a+1]=Math.max(0,r[a+1]),r[a+2]=Math.max(0,r[a+2]));else for(a=0;a<e;a+=3)i=this.tc.f(this.l.f(r[a])),s=this.tc.f(this.l.f(r[a+1])),h=this.tc.f(this.l.f(r[a+2])),r[a]=this.m2[0]*i+this.m2[1]*s+this.m2[2]*h,r[a+1]=this.m2[3]*i+this.m2[4]*s+this.m2[5]*h,r[a+2]=this.m2[6]*i+this.m2[7]*s+this.m2[8]*h,i=this.l.r(this.tc.r(r[a])),s=this.l.r(this.tc.r(r[a+1])),h=this.l.r(this.tc.r(r[a+2])),r[a]=this.m1[0]*i+this.m1[1]*s+this.m1[2]*h,r[a+1]=this.m1[3]*i+this.m1[4]*s+this.m1[5]*h,r[a+2]=this.m1[6]*i+this.m1[7]*s+this.m1[8]*h},CSToneCurve.prototype.lf=function(t){var i,s,h,r=new Float64Array(t),e=r.length,o=this.sb;if(this.o)for(var a=0;a<e;a+=3)i=r[a],s=r[a+1],h=r[a+2],r[a]=this.m1[0]*i+this.m1[1]*s+this.m1[2]*h,r[a+1]=this.m1[3]*i+this.m1[4]*s+this.m1[5]*h,r[a+2]=this.m1[6]*i+this.m1[7]*s+this.m1[8]*h,r[a]=this.tc.f(this.l.f(r[a])),r[a+1]=this.tc.f(this.l.f(r[a+1])),r[a+2]=this.tc.f(this.l.f(r[a+2])),i=r[a],s=r[a+1],h=r[a+2],r[a]=this.m2[0]*i+this.m2[1]*s+this.m2[2]*h,r[a+1]=this.m2[3]*i+this.m2[4]*s+this.m2[5]*h,r[a+2]=this.m2[6]*i+this.m2[7]*s+this.m2[8]*h,r[a]=this.l.r(this.tc.r(r[a])),r[a+1]=this.l.r(this.tc.r(r[a+1])),r[a+2]=this.l.r(this.tc.r(r[a+2])),o||(r[a]=Math.max(0,r[a]),r[a+1]=Math.max(0,r[a+1]),r[a+2]=Math.max(0,r[a+2]));else for(a=0;a<e;a+=3)i=this.tc.f(this.l.f(r[a])),s=this.tc.f(this.l.f(r[a+1])),h=this.tc.f(this.l.f(r[a+2])),r[a]=this.m2[0]*i+this.m2[1]*s+this.m2[2]*h,r[a+1]=this.m2[3]*i+this.m2[4]*s+this.m2[5]*h,r[a+2]=this.m2[6]*i+this.m2[7]*s+this.m2[8]*h,i=this.l.r(this.tc.r(r[a])),s=this.l.r(this.tc.r(r[a+1])),h=this.l.r(this.tc.r(r[a+2])),r[a]=this.m1[0]*i+this.m1[1]*s+this.m1[2]*h,r[a+1]=this.m1[3]*i+this.m1[4]*s+this.m1[5]*h,r[a+2]=this.m1[6]*i+this.m1[7]*s+this.m1[8]*h},CSToneCurvePlus.prototype.mInverse=function(t){var i=t[0]*(t[4]*t[8]-t[5]*t[7])-t[1]*(t[3]*t[8]-t[5]*t[6])+t[2]*(t[3]*t[7]-t[4]*t[6]);return 0!=i&&new Float64Array([(t[4]*t[8]-t[5]*t[7])/i,(t[2]*t[7]-t[1]*t[8])/i,(t[1]*t[5]-t[2]*t[4])/i,(t[5]*t[6]-t[3]*t[8])/i,(t[0]*t[8]-t[2]*t[6])/i,(t[2]*t[3]-t[0]*t[5])/i,(t[3]*t[7]-t[4]*t[6])/i,(t[1]*t[6]-t[0]*t[7])/i,(t[0]*t[4]-t[1]*t[3])/i])},CSToneCurvePlus.prototype.getWP=function(){return new Float64Array(this.wp.slice(0))},CSToneCurvePlus.prototype.isMatrix=function(){return!1},CSToneCurvePlus.prototype.cb=function(){return this.cB},CSToneCurvePlus.prototype.lc=function(t){var i,s,h,r,e,o,a=new Float64Array(t),n=a.length,u=this.lC,f=this.lY,l=2*(1-f[2]),p=2*(1-f[0]),c=this.tcC,m=this.tcY,y=2*(1-f[2]),F=2*(1-f[0]);if(this.o)for(var L=0;L<n;L+=3)i=a[L],s=a[L+1],h=a[L+2],a[L]=this.m1[0]*i+this.m1[1]*s+this.m1[2]*h,a[L+1]=this.m1[3]*i+this.m1[4]*s+this.m1[5]*h,a[L+2]=this.m1[6]*i+this.m1[7]*s+this.m1[8]*h,u&&(r=f[0]*a[L]+f[1]*a[L+1]+f[2]*a[L+2],.5<(e=(a[L+2]-r)/l)?e=.5:e<-.5&&(e=-.5),.5<(o=(a[L]-r)/p)?o=.5:o<-.5&&(o=-.5),a[L]=o*p+r,a[L+2]=e*l+r,a[L+1]=(r-f[0]*a[L]-f[2]*a[L+2])/f[1]),a[L]=this.tc.f(this.l.f(a[L])),a[L+1]=this.tc.f(this.l.f(a[L+1])),a[L+2]=this.tc.f(this.l.f(a[L+2])),i=a[L],s=a[L+1],h=a[L+2],a[L]=this.m2[0]*i+this.m2[1]*s+this.m2[2]*h,a[L+1]=this.m2[3]*i+this.m2[4]*s+this.m2[5]*h,a[L+2]=this.m2[6]*i+this.m2[7]*s+this.m2[8]*h,c&&(r=m[0]*a[L]+m[1]*a[L+1]+m[2]*a[L+2],.5<(e=(a[L+2]-r)/y)?e=.5:e<-.5&&(e=-.5),.5<(o=(a[L]-r)/F)?o=.5:o<-.5&&(o=-.5),a[L]=o*F+r,a[L+2]=e*y+r,a[L+1]=(r-m[0]*a[L]-m[2]*a[L+2])/m[1]),a[L]=this.l.r(this.tc.r(a[L])),a[L+1]=this.l.r(this.tc.r(a[L+1])),a[L+2]=this.l.r(this.tc.r(a[L+2])),sb||(a[L]=Math.max(0,a[L]),a[L+1]=Math.max(0,a[L+1]),a[L+2]=Math.max(0,a[L+2]));else for(L=0;L<n;L+=3)i=this.tc.f(this.l.f(a[L])),s=this.tc.f(this.l.f(a[L+1])),h=this.tc.f(this.l.f(a[L+2])),a[L]=this.m2[0]*i+this.m2[1]*s+this.m2[2]*h,a[L+1]=this.m2[3]*i+this.m2[4]*s+this.m2[5]*h,a[L+2]=this.m2[6]*i+this.m2[7]*s+this.m2[8]*h,i=this.l.r(this.tc.r(a[L])),s=this.l.r(this.tc.r(a[L+1])),h=this.l.r(this.tc.r(a[L+2])),a[L]=this.m1[0]*i+this.m1[1]*s+this.m1[2]*h,a[L+1]=this.m1[3]*i+this.m1[4]*s+this.m1[5]*h,a[L+2]=this.m1[6]*i+this.m1[7]*s+this.m1[8]*h},CSToneCurvePlus.prototype.lf=function(t){var i,s,h,r,e,o,a=new Float64Array(t),n=a.length,u=(this.lC,this.lY),f=2*(1-u[2]),l=2*(1-u[0]),p=this.tcC,c=this.tcY,m=2*(1-u[2]),y=2*(1-u[0]);if(this.o)for(var F=0;F<n;F+=3)i=a[F],s=a[F+1],h=a[F+2],a[F]=this.m1[0]*i+this.m1[1]*s+this.m1[2]*h,a[F+1]=this.m1[3]*i+this.m1[4]*s+this.m1[5]*h,a[F+2]=this.m1[6]*i+this.m1[7]*s+this.m1[8]*h,this.lC&&(r=u[0]*a[F]+u[1]*a[F+1]+u[2]*a[F+2],.5<(e=(a[F+2]-r)/f)?e=.5:e<-.5&&(e=-.5),.5<(o=(a[F]-r)/l)?o=.5:o<-.5&&(o=-.5),a[F]=o*l+r,a[F+2]=e*f+r,a[F+1]=(r-u[0]*a[F]-u[2]*a[F+2])/u[1]),a[F]=this.tc.f(this.l.f(a[F])),a[F+1]=this.tc.f(this.l.f(a[F+1])),a[F+2]=this.tc.f(this.l.f(a[F+2])),i=a[F],s=a[F+1],h=a[F+2],a[F]=this.m2[0]*i+this.m2[1]*s+this.m2[2]*h,a[F+1]=this.m2[3]*i+this.m2[4]*s+this.m2[5]*h,a[F+2]=this.m2[6]*i+this.m2[7]*s+this.m2[8]*h,p&&(r=c[0]*a[F]+c[1]*a[F+1]+c[2]*a[F+2],.5<(e=(a[F+2]-r)/m)?e=.5:e<-.5&&(e=-.5),.5<(o=(a[F]-r)/y)?o=.5:o<-.5&&(o=-.5),a[F]=o*y+r,a[F+2]=e*m+r,a[F+1]=(r-c[0]*a[F]-c[2]*a[F+2])/c[1]),a[F]=this.l.r(this.tc.r(a[F])),a[F+1]=this.l.r(this.tc.r(a[F+1])),a[F+2]=this.l.r(this.tc.r(a[F+2])),sb||(a[F]=Math.max(0,a[F]),a[F+1]=Math.max(0,a[F+1]),a[F+2]=Math.max(0,a[F+2]));else for(F=0;F<n;F+=3)i=this.tc.f(this.l.f(a[F])),s=this.tc.f(this.l.f(a[F+1])),h=this.tc.f(this.l.f(a[F+2])),a[F]=this.m2[0]*i+this.m2[1]*s+this.m2[2]*h,a[F+1]=this.m2[3]*i+this.m2[4]*s+this.m2[5]*h,a[F+2]=this.m2[6]*i+this.m2[7]*s+this.m2[8]*h,i=this.l.r(this.tc.r(a[F])),s=this.l.r(this.tc.r(a[F+1])),h=this.l.r(this.tc.r(a[F+2])),a[F]=this.m1[0]*i+this.m1[1]*s+this.m1[2]*h,a[F+1]=this.m1[3]*i+this.m1[4]*s+this.m1[5]*h,a[F+2]=this.m1[6]*i+this.m1[7]*s+this.m1[8]*h},CSLUT.prototype.setLUT=function(t){var i=t.meta;if(void 0!==i.inputMatrix&&i.inputMatrix?(this.inM=i.inputMatrix,this.im=!0):this.im=!1,"string"==typeof i.inputTF&&""!==i.inputTF)switch(i.inputTF){case"S-Log3":this.natTF=0;break;case"S-Log2":this.natTF=1;break;case"S-Log":this.natTF=2;break;case"C-Log":this.natTF=3;break;case"Canon C-Log2":this.natTF=4;break;case"Panasonic V-Log":this.natTF=5;break;case"REDLogFilm":this.natTF=6;break;case"Cineon":this.natTF=7;break;case"LogC (Sup 3.x & 4.x)":this.natTF=8,"number"==typeof i.baseISO?this.setISO(i.baseISO):this.setISO(800);break;case"LogC (Sup 2.x)":this.natTF=9,"number"==typeof i.baseISO?this.setISO(i.baseISO):this.setISO(800);break;default:this.natTF=0}else"number"==typeof i.nativeTF?(this.natTF=i.nativeTF,8!==this.natTF&&9!==this.natTF||("number"==typeof i.baseISO?this.setISO(i.baseISO):this.setISO(800))):this.natTF=0;"boolean"==typeof i.inputEX?this.inL=!i.inputEX:this.inL=!1,void 0!==t.format?this.format=t.format:this.format="cube",void 0!==t.min?this.min=t.min:this.min=[0,0,0],void 0!==t.max?this.max=t.max:this.max=[1,1,1],this.lut=this.lutMaker.newLUT({title:this.name,format:this.format,dims:3,s:t.s,min:this.min,max:this.max,C:t.C}),this.setRC()},CSLUT.prototype.setISO=function(t){if(8===this.natTF){var i,s,h,r;this.arri={},this.arri.cut=1/9,h=1/(this.arri.cut*Math.LN10),r=Math.log(this.arri.cut)/Math.LN10-h*this.arri.cut,a=.01/(t/400),o=.256598*(Math.log(t/400)/Math.log(2)*(.89-1)/3+1),i=.391007;for(var e=0;e<3;e++)s=((95/1023-i)/o-r)/h,i=.391007-Math.log(1+s)/Math.LN10*o;this.arri.a=1/a,this.arri.b=s-.003907/a,this.arri.e=h*this.arri.a*o,this.arri.ff=o*(h*this.arri.b+r)+i,n=4/(.18*t),this.arri.b=this.arri.b+.003907*this.arri.a,this.arri.a=this.arri.a*n,this.arri.ff=this.arri.ff+.003907*this.arri.e,this.arri.e=this.arri.e*n,this.arri.c=o,this.arri.d=i,this.arri.cut=(this.arri.cut-this.arri.b)/this.arri.a}else{var o,a,n;9===this.natTF&&(this.arri={},o=.256598*(Math.log(t/400)/Math.log(2)*-.11/3+1),a=Math.log(977e-6/.010977)*o/Math.LN10+.391007,n=Math.log((t/400*.0002442002442002442+977e-6)/.010977)/Math.LN10*o+.391007,this.arri.cut=.003907,this.arri.d=.391007,this.arri.c=o,this.arri.b=977e-6/.010977,this.arri.a=t/(400*.010977)/(.045*t),this.arri.ff=a,this.arri.e=4095*(n-a)/(.045*t))}},CSLUT.prototype.getWP=function(){return new Float64Array(this.wp.slice(0))},CSLUT.prototype.setRC=function(){var t=this.colours,i=new Float64Array(t.buffer.slice(0));this.lc(i.buffer);for(var s=t.length,h=new Float64Array(9),r=new Float64Array(9),e=0;e<s;e+=3)h[0]+=t[e]*t[e],h[1]+=t[e]*t[e+1],h[2]+=t[e]*t[e+2],h[4]+=t[e+1]*t[e+1],h[5]+=t[e+1]*t[e+2],h[8]+=t[e+2]*t[e+2],r[0]+=i[e]*t[e],r[1]+=i[e]*t[e+1],r[2]+=i[e]*t[e+2],r[3]+=i[e+1]*t[e],r[4]+=i[e+1]*t[e+1],r[5]+=i[e+1]*t[e+2],r[6]+=i[e+2]*t[e],r[7]+=i[e+2]*t[e+1],r[8]+=i[e+2]*t[e+2];h[3]=h[1],h[6]=h[2],h[7]=h[5],i=r;var o=(t=h)[0]*(t[4]*t[8]-t[5]*t[7])-t[1]*(t[3]*t[8]-t[5]*t[6])+t[2]*(t[3]*t[7]-t[4]*t[6]),a=new Float64Array([(t[4]*t[8]-t[5]*t[7])/o,(t[2]*t[7]-t[1]*t[8])/o,(t[1]*t[5]-t[2]*t[4])/o,(t[5]*t[6]-t[3]*t[8])/o,(t[0]*t[8]-t[2]*t[6])/o,(t[2]*t[3]-t[0]*t[5])/o,(t[3]*t[7]-t[4]*t[6])/o,(t[1]*t[6]-t[0]*t[7])/o,(t[0]*t[4]-t[1]*t[3])/o]),a=new Float64Array([i[0]*a[0]+i[1]*a[3]+i[2]*a[6],i[0]*a[1]+i[1]*a[4]+i[2]*a[7],i[0]*a[2]+i[1]*a[5]+i[2]*a[8],i[3]*a[0]+i[4]*a[3]+i[5]*a[6],i[3]*a[1]+i[4]*a[4]+i[5]*a[7],i[3]*a[2]+i[4]*a[5]+i[5]*a[8],i[6]*a[0]+i[7]*a[3]+i[8]*a[6],i[6]*a[1]+i[7]*a[4]+i[8]*a[7],i[6]*a[2]+i[7]*a[5]+i[8]*a[8]]),o=a[0]*(a[4]*a[8]-a[5]*a[7])-a[1]*(a[3]*a[8]-a[5]*a[6])+a[2]*(a[3]*a[7]-a[4]*a[6]);this.mInv=new Float64Array([(a[4]*a[8]-a[5]*a[7])/o,(a[2]*a[7]-a[1]*a[8])/o,(a[1]*a[5]-a[2]*a[4])/o,(a[5]*a[6]-a[3]*a[8])/o,(a[0]*a[8]-a[2]*a[6])/o,(a[2]*a[3]-a[0]*a[5])/o,(a[3]*a[7]-a[4]*a[6])/o,(a[1]*a[6]-a[0]*a[7])/o,(a[0]*a[4]-a[1]*a[3])/o])},CSLUT.prototype.isMatrix=function(){return!1},CSLUT.prototype.setInterpolation=function(t,i){this.genInt=t,this.preInt=i},CSLUT.prototype.setTitle=function(t){this.name=t},CSLUT.prototype.rc=function(t){for(var i,s,h,r=new Float64Array(t),e=r.length,o=this.mInv,a=0;a<e;a+=3)i=r[a],s=r[a+1],h=r[a+2],r[a]=o[0]*i+o[1]*s+o[2]*h,r[a+1]=o[3]*i+o[4]*s+o[5]*h,r[a+2]=o[6]*i+o[7]*s+o[8]*h},CSLUT.prototype.cb=function(){return!1},CSLUT.prototype.lc=function(t){var i,s=new Float64Array(t),h=s.length;if(this.im)for(var r,e,o,a=this.inM,n=0;n<h;n+=3)r=s[n],e=s[n+1],o=s[n+2],s[n]=a[0]*r+a[1]*e+a[2]*o,s[n+1]=a[3]*r+a[4]*e+a[5]*o,s[n+2]=a[6]*r+a[7]*e+a[8]*o;switch(this.natTF){case 0:for(n=0;n<h;n++).0125<=s[n]?s[n]=.255620723*Math.log(4.736842106*s[n]+.052631579)/Math.LN10+.410557185:s[n]=(s[n]+.015581884)/.167792292;break;case 1:for(n=0;n<h;n++)0<=s[n]?s[n]=.370522310728792*Math.log(.707762557077626*s[n]+.0375840001141552)/Math.LN10+.616244473086815:s[n]=(s[n]+.0291229262672453)/.330000000129966;break;case 2:for(n=0;n<h;n++)1e-15<=s[n]?s[n]=.370522311*Math.log(s[n]+.037584)/Math.LN10+.616244474:s[n]=(s[n]+.0286107171)/.3241960136;break;case 3:for(n=0;n<h;n++)-.0452664<=s[n]?s[n]=.45310179472141*Math.log(10.1596*s[n]+1)/Math.LN10+.1251224801564:s[n]=(s[n]+.0467265867)/.3734467748;break;case 4:for(n=0;n<h;n++)-.006747091156<=s[n]?s[n]=.241360772*Math.log(87.09937546*s[n]+1)/Math.LN10+.092864125:s[n]=(s[n]+.006747091156)/.045164984;break;case 5:for(n=0;n<h;n++).009<=s[n]?s[n]=.241514*Math.log(.9*s[n]+.00873)/Math.LN10+.598206:s[n]=(s[n]+.024801587)/.198412698;break;case 6:case 7:for(n=0;n<h;n++)s[n]<-.006278688?s[n]=(s[n]+.006278688)/.045949378:s[n]=(Math.log(.890282024*s[n]+.010797752)/(.003333333*Math.LN10)+685)/1023;break;case 8:case 9:i=this.arri;for(n=0;n<h;n++)s[n]=.9*s[n],s[n]>i.cut?s[n]=i.c*Math.log(i.a*s[n]+i.b)/Math.LN10+i.d:s[n]=i.e*s[n]+i.ff;break;default:for(n=0;n<h;n++).0125<=s[n]?s[n]=.255620723*Math.log(4.736842106*s[n]+.052631579)/Math.LN10+.410557185:s[n]=(s[n]+.015581884)/.167792292}if(this.inL)for(n=0;n<h;n++)s[n]=(1023*s[n]-64)/876;if(0===this.genInt?this.lut.RGBCub(t):1===this.genInt?this.lut.RGBTet(t):this.lut.RGBLin(t),this.inL)for(n=0;n<h;n++)s[n]=(876*s[n]+64)/1023;switch(this.natTF){case 0:for(n=0;n<h;n++).167360992<=s[n]?s[n]=(Math.pow(10,(s[n]-.410557185)/.255620723)-.052631579)/4.736842106:s[n]=.167792292*s[n]-.015581884;break;case 1:for(n=0;n<h;n++).0375840001141552<=s[n]?s[n]=(Math.pow(10,(s[n]-.616244473086815)/.370522310728792)-.0375840001141552)/.707762557077626:s[n]=.330000000129966*s[n]-.0291229262672453;break;case 2:for(n=0;n<h;n++).088290045<=s[n]?s[n]=Math.pow(10,(s[n]-.616244474)/.370522311)-.037584:s[n]=.3241960136*s[n]-.0286107171;break;case 3:for(n=0;n<h;n++).00391002619746<=s[n]?s[n]=(Math.pow(10,(s[n]-.1251224801564)/.45310179472141)-1)/10.1596:s[n]=.3734467748*s[n]-.0467265867;break;case 4:for(n=0;n<h;n++)0<=s[n]?s[n]=(Math.pow(10,(s[n]-.092864125)/.241360772)-1)/87.09937546:s[n]=.045164984*s[n]-.006747091156;break;case 5:for(n=0;n<h;n++).181<=s[n]?s[n]=(Math.pow(10,(s[n]-.598206)/.241514)-.00873)/.9:s[n]=.198412698*s[n]-.024801587;break;case 6:case 7:for(n=0;n<h;n++)s[n]<0?s[n]=.045949378*s[n]-.006278688:s[n]=(Math.pow(10,.003333333*(1023*s[n]-685))-.010797752)/.890282024;break;case 8:case 9:i=this.arri;for(n=0;n<h;n++)s[n]>i.e*i.cut+i.ff?s[n]=(Math.pow(10,(s[n]-i.d)/i.c)-i.b)/(.9*i.a):s[n]=(s[n]-i.ff)/(.9*i.e);break;default:for(n=0;n<h;n++).167360992<=s[n]?s[n]=(Math.pow(10,(s[n]-.410557185)/.255620723)-.052631579)/4.736842106:s[n]=.167792292*s[n]-.015581884}},CSLUT.prototype.lf=function(t){var i,s=new Float64Array(t),h=s.length;if(this.im)for(var r,e,o,a=this.inM,n=0;n<h;n+=3)r=s[n],e=s[n+1],o=s[n+2],s[n]=a[0]*r+a[1]*e+a[2]*o,s[n+1]=a[3]*r+a[4]*e+a[5]*o,s[n+2]=a[6]*r+a[7]*e+a[8]*o;switch(this.natTF){case 0:for(n=0;n<h;n++).0125<=s[n]?s[n]=.255620723*Math.log(4.736842106*s[n]+.052631579)/Math.LN10+.410557185:s[n]=(s[n]+.015581884)/.167792292;break;case 1:for(n=0;n<h;n++)0<=s[n]?s[n]=.370522310728792*Math.log(.707762557077626*s[n]+.0375840001141552)/Math.LN10+.616244473086815:s[n]=(s[n]+.0291229262672453)/.330000000129966;break;case 2:for(n=0;n<h;n++)1e-15<=s[n]?s[n]=.370522311*Math.log(s[n]+.037584)/Math.LN10+.616244474:s[n]=(s[n]+.0286107171)/.3241960136;break;case 3:for(n=0;n<h;n++)-.0452664<=s[n]?s[n]=.45310179472141*Math.log(10.1596*s[n]+1)/Math.LN10+.1251224801564:s[n]=(s[n]+.0467265867)/.3734467748;break;case 4:for(n=0;n<h;n++)-.006747091156<=s[n]?s[n]=.241360772*Math.log(87.09937546*s[n]+1)/Math.LN10+.092864125:s[n]=(s[n]+.006747091156)/.045164984;break;case 5:for(n=0;n<h;n++).009<=s[n]?s[n]=.241514*Math.log(.9*s[n]+.00873)/Math.LN10+.598206:s[n]=(s[n]+.024801587)/.198412698;break;case 6:case 7:for(n=0;n<h;n++)s[n]<-.006278688?s[n]=(s[n]+.006278688)/.045949378:s[n]=(Math.log(.890282024*s[n]+.010797752)/(.003333333*Math.LN10)+685)/1023;break;case 8:case 9:i=this.arri;for(n=0;n<h;n++)s[n]=.9*s[n],s[n]>i.cut?s[n]=i.c*Math.log(i.a*s[n]+i.b)/Math.LN10+i.d:s[n]=i.e*s[n]+i.ff;break;default:for(n=0;n<h;n++).0125<=s[n]?s[n]=.255620723*Math.log(4.736842106*s[n]+.052631579)/Math.LN10+.410557185:s[n]=(s[n]+.015581884)/.167792292}if(this.inL)for(n=0;n<h;n++)s[n]=(1023*s[n]-64)/876;if(0===this.preInt?this.lut.RGBCub(t):1===this.preInt?this.lut.RGBTet(t):this.lut.RGBLin(t),this.inL)for(n=0;n<h;n++)s[n]=(876*s[n]+64)/1023;switch(this.natTF){case 0:for(n=0;n<h;n++).167360992<=s[n]?s[n]=(Math.pow(10,(s[n]-.410557185)/.255620723)-.052631579)/4.736842106:s[n]=.167792292*s[n]-.015581884;break;case 1:for(n=0;n<h;n++).0375840001141552<=s[n]?s[n]=(Math.pow(10,(s[n]-.616244473086815)/.370522310728792)-.0375840001141552)/.707762557077626:s[n]=.330000000129966*s[n]-.0291229262672453;break;case 2:for(n=0;n<h;n++).088290045<=s[n]?s[n]=Math.pow(10,(s[n]-.616244474)/.370522311)-.037584:s[n]=.3241960136*s[n]-.0286107171;break;case 3:for(n=0;n<h;n++).00391002619746<=s[n]?s[n]=(Math.pow(10,(s[n]-.1251224801564)/.45310179472141)-1)/10.1596:s[n]=.3734467748*s[n]-.0467265867;break;case 4:for(n=0;n<h;n++)0<=s[n]?s[n]=(Math.pow(10,(s[n]-.092864125)/.241360772)-1)/87.09937546:s[n]=.045164984*s[n]-.006747091156;break;case 5:for(n=0;n<h;n++).181<=s[n]?s[n]=(Math.pow(10,(s[n]-.598206)/.241514)-.00873)/.9:s[n]=.198412698*s[n]-.024801587;break;case 6:case 7:for(n=0;n<h;n++)s[n]<0?s[n]=.045949378*s[n]-.006278688:s[n]=(Math.pow(10,.003333333*(1023*s[n]-685))-.010797752)/.890282024;break;case 8:case 9:i=this.arri;for(n=0;n<h;n++)s[n]>i.e*i.cut+i.ff?s[n]=(Math.pow(10,(s[n]-i.d)/i.c)-i.b)/(.9*i.a):s[n]=(s[n]-i.ff)/(.9*i.e);break;default:for(n=0;n<h;n++).167360992<=s[n]?s[n]=(Math.pow(10,(s[n]-.410557185)/.255620723)-.052631579)/4.736842106:s[n]=.167792292*s[n]-.015581884}},CSCanonIDT.prototype.getWP=function(){return new Float64Array(this.wp.slice(0))},CSCanonIDT.prototype.setParams=function(){this.day?(this.cR=new Float64Array([1.08190037262167,-.180298701368782,.0983983287471069,1.9458545364518,-.509539936937375,-.47489567735516,-.778086752197068,-.7412266070049,.557894437042701,-3.27787395719078,.254878417638717,3.45581530576474,.335471713974739,-.43352125478476,-1.65050137344141,1.46581418175682,.944646566605676,-.723653099155881,-.371076501167857]),this.cG=new Float64Array([-.00858997792576314,1.00673740119621,.00185257672955608,.0848736138296452,.347626906448902,.0020230274463939,-.0790508414091524,-.179497582958716,-.175975123357072,2.30205579706951,-.627257613385219,-2.90795250918851,1.37002437502321,-.108668158565563,-2.21150552827555,1.53315057595445,-.543188706699505,1.63793038490376,-.444588616836587]),this.cB=new Float64Array([.12696639806511,-.011891441127869,.884925043062759,1.34780279822258,1.03647352257365,.459113289955922,-.878157422295268,-1.3066278750436,-.658604313413283,-1.4444077996703,.556676588785173,2.18798497054968,-1.43030768398665,-.0388323570817641,2.63698573112453,-1.66598882056039,.33450249360103,-1.65856930730901,.521956184547685]),this.sys=this.mMult(this.toSys,new Float64Array([.561538969,.402060105,.036400926,.092739623,.924121198,-.016860821,.084812961,.006373835,.908813204]))):(this.cR=new Float64Array([.963803004454899,-.160722202570655,.196919198115756,2.03444685639819,-.442676931451021,-.407983781537509,-.640703323129254,-.860242798247848,.317159977967446,-4.80567080102966,.27118370397567,5.1069005049557,.340895816920585,-.486941738507862,-2.23737935753692,1.96647555251297,1.30204051766243,-1.06503117628554,-.392473022667378]),this.cG=new Float64Array([-.0421935892309314,1.04845959175183,-.00626600252090315,-.106438896887216,.362908621470781,.118070700472261,.0193542539838734,-.156083029543267,-.237811649496433,1.67916420582198,-.632835327167897,-1.95984471387461,.953221464562814,.0599085176294623,-1.66452046236246,1.14041188349761,-.387552623550308,1.14820099685512,-.336153941411709]),this.cB=new Float64Array([.170295033135028,-.0682984448537245,.898003411718697,1.22106821992399,1.60194865922925,.377599191137124,-.825781428487531,-1.44590868076749,-.928925961035344,-.838548997455852,.75809397217116,1.32966795243196,-1.20021905668355,-.254838995845129,2.33232411639308,-1.86381505762773,.111576038956423,-1.12593315849766,.751693186157287]),this.sys=this.mMult(this.toSys,new Float64Array([.566996399,.365079418,.067924183,.070901044,.880331008,.048767948,.073013542,-.066540862,.99352732])))},CSCanonIDT.prototype.mMult=function(t,i){var s=new Float64Array(9);return s[0]=t[0]*i[0]+t[1]*i[3]+t[2]*i[6],s[1]=t[0]*i[1]+t[1]*i[4]+t[2]*i[7],s[2]=t[0]*i[2]+t[1]*i[5]+t[2]*i[8],s[3]=t[3]*i[0]+t[4]*i[3]+t[5]*i[6],s[4]=t[3]*i[1]+t[4]*i[4]+t[5]*i[7],s[5]=t[3]*i[2]+t[4]*i[5]+t[5]*i[8],s[6]=t[6]*i[0]+t[7]*i[3]+t[8]*i[6],s[7]=t[6]*i[1]+t[7]*i[4]+t[8]*i[7],s[8]=t[6]*i[2]+t[7]*i[5]+t[8]*i[8],s},CSCanonIDT.prototype.isMatrix=function(){return!1},CSCanonIDT.prototype.cb=function(){return!1},CSCanonIDT.prototype.lc=function(t){for(var i,s,h,r=new Float64Array(t),e=r.length,o=new Float64Array(3),a=0;a<e;a++)(h=10.1596*r[a]+1)<=0&&(h=1e-11),r[a]=.529136*Math.log(h)/Math.LN10+.0730597;for(a=0;a<e;a+=3){i=r[a]*r[a],s=r[a+1]*r[a+1],n=r[a+2]*r[a+2];var n=new Float64Array([r[a],r[a+1],r[a+2],r[a]*r[a+1],r[a+1]*r[a+2],r[a+2]*r[a],i,s,n,i*r[a+1],i*r[a+2],r[a]*s,r[a]*r[a+1]*r[a+2],r[a]*n,s*r[a+2],r[a+1]*n,r[a]*i,r[a+1]*s,r[a+2]*n]);r[a]=this.cR[0]*n[0]+this.cR[1]*n[1]+this.cR[2]*n[2]+this.cR[3]*n[3]+this.cR[4]*n[4]+this.cR[5]*n[5]+this.cR[6]*n[6]+this.cR[7]*n[7]+this.cR[8]*n[8]+this.cR[9]*n[9]+this.cR[10]*n[10]+this.cR[11]*n[11]+this.cR[12]*n[12]+this.cR[13]*n[13]+this.cR[14]*n[14]+this.cR[15]*n[15]+this.cR[16]*n[16]+this.cR[17]*n[17]+this.cR[18]*n[18],r[a+1]=this.cG[0]*n[0]+this.cG[1]*n[1]+this.cG[2]*n[2]+this.cG[3]*n[3]+this.cG[4]*n[4]+this.cG[5]*n[5]+this.cG[6]*n[6]+this.cG[7]*n[7]+this.cG[8]*n[8]+this.cG[9]*n[9]+this.cG[10]*n[10]+this.cG[11]*n[11]+this.cG[12]*n[12]+this.cG[13]*n[13]+this.cG[14]*n[14]+this.cG[15]*n[15]+this.cG[16]*n[16]+this.cG[17]*n[17]+this.cG[18]*n[18],r[a+2]=this.cB[0]*n[0]+this.cB[1]*n[1]+this.cB[2]*n[2]+this.cB[3]*n[3]+this.cB[4]*n[4]+this.cB[5]*n[5]+this.cB[6]*n[6]+this.cB[7]*n[7]+this.cB[8]*n[8]+this.cB[9]*n[9]+this.cB[10]*n[10]+this.cB[11]*n[11]+this.cB[12]*n[12]+this.cB[13]*n[13]+this.cB[14]*n[14]+this.cB[15]*n[15]+this.cB[16]*n[16]+this.cB[17]*n[17]+this.cB[18]*n[18],o[0]=(Math.pow(10,(r[a]-.0730597)/.529136)-1)/10.1596,o[1]=(Math.pow(10,(r[a+1]-.0730597)/.529136)-1)/10.1596,o[2]=(Math.pow(10,(r[a+2]-.0730597)/.529136)-1)/10.1596,r[a]=Math.min(65504,this.sys[0]*o[0]+this.sys[1]*o[1]+this.sys[2]*o[2]),r[a+1]=Math.min(65504,this.sys[3]*o[0]+this.sys[4]*o[1]+this.sys[5]*o[2]),r[a+2]=Math.min(65504,this.sys[6]*o[0]+this.sys[7]*o[1]+this.sys[8]*o[2])}},CSCanonIDT.prototype.lf=function(t){this.lc(t)},CSLabSpace.prototype.f=function(t,i){var s=new Float64Array(t),h=s.length;if(i)for(var r=0;r<h;r++)s[r]>=this.p3?s[r]=1.16*Math.cbrt(s[r])-.16:s[r]=this.p1*s[r];else for(r=0;r<h;r++)s[r]>=this.p3?s[r]=Math.cbrt(s[r]):s[r]=(this.p1*s[r]+.16)/1.16},CSLabSpace.prototype.fInv=function(t,i){var s=new Float64Array(t),h=s.length;if(i)for(var r=0;r<h;r++)s[r]>=this.p4?s[r]=Math.pow((s[r]+.16)/1.16,3):s[r]=s[r]/this.p1;else for(r=0;r<h;r++)s[r]>=this.p4?s[r]=Math.pow(s[r],3):s[r]=(1.16*s[r]-.16)/this.p1},CSLabSpace.prototype.getWP=function(){return new Float64Array([this.Xn,this.Yn,this.Zn])},CSLabSpace.prototype.isMatrix=function(){return!1},CSLabSpace.prototype.cb=function(){return!1},CSLabSpace.prototype.lc=function(t){var i=new Float64Array(t),s=i.length;if(this.toSys){this.f(i.buffer,!0);for(var s=i.length,h=0;h<s;h+=3)r=(i[h]+.16)/1.16,i[h]=(i[h+1]+r)/5,i[h+2]=(i[h+2]+r)/2,i[h+1]=r;this.fInv(i.buffer,!1);for(h=0;h<s;h+=3)i[h]*=this.Xn,i[h+1]*=this.Yn,i[h+2]*=this.Zn;this.XYZ.lc(i.buffer)}else{this.XYZ.lc(i.buffer);for(var r,h=0;h<s;h+=3)i[h]/=this.Xn,i[h+1]/=this.Yn,i[h+2]/=this.Zn;this.f(i.buffer,!1);for(h=0;h<s;h+=3)r=i[h+1],i[h+1]=5*(i[h]-r),i[h+2]=2*(i[h+2]-r),i[h]=1.16*r-.16;this.fInv(i.buffer,!0)}},CSLabSpace.prototype.lf=function(t){this.lc(t)},LUTColourSpace.prototype.setParams=function(t){var i,s,h={t:20,v:this.ver};return"number"!=typeof t.v?(h.err=!0,h.details="Missing version no."):(h.to=[],"number"==typeof t.inGamut&&(this.curIn=t.inGamut,h.inGamut=this.curIn),"number"==typeof t.outGamut&&(this.curOut=t.outGamut,h.outGamut=this.curOut),"boolean"==typeof t.tweaks?this.tweaks=t.tweaks:this.tweaks=!1,void 0!==t.twkLA&&(i="number"==typeof t.twkLA.genInt?t.twkLA.genInt:0,s="number"==typeof t.twkLA.preInt?t.twkLA.preInt:1,this.csOut[this.LA].setInterpolation(i,s)),h.twkCS=this.setCS(t),h.twkWB=this.setWB(t),h.twkASCCDL=this.setASCCDL(t),h.twkPSSTCDL=this.setPSSTCDL(t),h.twkHG=this.setHG(t),h.twkMulti=this.setMulti(t),h.twkSDRSat=this.setSDRSat(t),h.twkGamutLim=this.setGamutLim(t),h.twkFC=this.setFC(t),"boolean"==typeof t.isTrans&&(this.isTrans=t.isTrans),this.ver=t.v,h.v=this.ver),h},LUTColourSpace.prototype.calc=function(t,i,s,h){var r=s.o,e=new Float64Array(r),i={p:t,t:i+20,v:this.ver,outGamut:this.curOut,o:r,cb:this.csOut[this.curOut].cb(),to:["o"]};if(h?(i.R=s.R,i.G=s.G,i.B=s.B,i.vals=s.vals,i.dim=s.dim):(i.leg=s.leg,i.line=s.line,i.upd=s.upd,i.threeD=!0),!this.nul){h&&this.csIn[this.curIn].lc(r);this.y;for(var o=e.length,a=s.eiMult,n=0;n<o;n++)isNaN(e[n])?e[n]=0:e[n]*=a;this.doFC&&this.FCOut(r,i),i.doFC=this.doFC,this.doWB&&this.wb.lc(r),this.doPSSTCDL&&this.PSSTCDLOut(r),this.doASCCDL&&this.ASCCDLOut(r),this.doMulti&&this.multiOut(r),this.doHG?this.HGOut(r,h):h?this.csOut[this.curOut].lc(r):this.csOut[this.curOut].lf(r),this.doSDRSat&&this.SDRSatOut(r),this.doGamutLim?this.gamutLimOut(r,i):i.doGamutLim=!1}return i},LUTColourSpace.prototype.laCalc=function(t,i,s){i={p:t,t:i+20,v:this.ver,dim:s.dim,gamma:s.gamma,gamut:s.gamut};return s.gamut===this.custOut?i.inputMatrix=this.mInverse(this.csIn[this.custIn].getMatrix()).buffer:i.inputMatrix=this.csOut[s.gamut].getMatrix().buffer.slice(0),i.to=["inputMatrix"],i},LUTColourSpace.prototype.recalcMatrix=function(t,i,s){var h={p:t,t:i+20,v:this.ver,idx:s.idx,wcs:s.newWCS},r=new Float64Array(s.matrix);return r=s.newWCS===this.xyzIdx?this.mMult(this.g[s.oldWCS].toXYZ,r):s.oldWCS===this.xyzIdx?this.mMult(this.mInverse(this.g[s.newWCS].toXYZ),r):(t=this.g[s.oldWCS].toXYZ,i=this.mInverse(this.g[s.newWCS].toXYZ),s=this.mMult(i,this.calcCAT(t,this.g[s.oldWCS].white,this.g[s.newWCS].white,s.cat)),this.mMult(s,r)),h.matrix=r.buffer,h.to=["matrix"],h},LUTColourSpace.prototype.loadDefaultLUTs=function(t,i,s){var t={p:t,t:i+20,v:this.ver},h=void 0!==s.meta?s.meta:{};void 0!==s.title&&(t.title=s.title);var i=this.csOut[this.defLUTs[s.fileName]],r=-1;if(void 0!==h.inputCS&&""!==h.inputCS){var e=this.laList,o=e.length,r=-1;if("Custom In"!==h.inputCS)for(var a=0;a<o;a++)if(e.name===h.inputCS){r=e.idx;break}}r<0||(r!==this.sysIdx?h.inputMatrix=this.csOut[r].getMatrix():h.inputMatrix=new Float64Array([1,0,0,0,1,0,0,0,1]));s={name:i.name,format:"cube",dims:s.dims,s:s.s,min:s.min,max:s.max,C:s.C,meta:h};return i.setLUT(s),t},LUTColourSpace.prototype.getLists=function(t,i){return{p:t,t:i+20,v:this.ver,inList:this.inList,outList:this.outList,laList:this.laList,matList:this.matList,subNames:this.subNames,inSub:this.csInSub,outSub:this.csOutSub,laSub:this.csLASub,CATList:this.CATs.getModels(),pass:this.pass,LA:this.LA}},LUTColourSpace.prototype.setLA=function(t,i,s){var t={p:t,t:i+20,v:this.ver},h=void 0!==s.meta?s.meta:{};void 0!==s.title&&(t.title=s.title);var i=this.csOut[this.LA],r=-1;if(void 0!==h.inputCS&&""!==h.inputCS){var e=this.laList,o=e.length,r=-1;if("Custom In"!==h.inputCS)for(var a=0;a<o;a++)if(e.name===h.inputCS){r=e.idx;break}}r<0||(r!==this.sysIdx?h.inputMatrix=this.csOut[r].getMatrix():h.inputMatrix=new Float64Array([1,0,0,0,1,0,0,0,1]));s={name:i.name,format:"cube",dims:s.dims,s:s.s,min:s.min,max:s.max,C:s.C,meta:h};return i.setLUT(s),t},LUTColourSpace.prototype.setLATitle=function(t,i,s){return this.csOut[this.LA].setTitle(s),{p:t,t:i+20,v:this.ver,i:s}},LUTColourSpace.prototype.getColSqr=function(t,i,s){var h=this.colSqr.slice(0),r=new Float64Array(h);this.csOut[this.curOut].lc(h);for(var e,o=new Uint8Array(Math.round(262144)),a=0;a<65536;a++)255<(e=255/Math.max.apply(Math,[r[3*a],r[3*a+1],r[3*a+2]]))&&(e=255),o[4*a]=Math.min(255,Math.max(0,r[3*a]*e)),o[4*a+1]=Math.min(255,Math.max(0,r[3*a+1]*e)),o[4*a+2]=Math.min(255,Math.max(0,r[3*a+2]*e)),o[4*a+3]=255;return{p:t,t:i+20,v:this.ver,tIdx:s.tIdx,o:o.buffer,cb:this.csOut[this.curOut].cb(),to:["o"]}},LUTColourSpace.prototype.multiColours=function(t,i,s){var h=this.mclrs.slice(0);out={p:t,t:i+20,v:this.ver,o:h,cb:this.csOut[this.curOut].cb(),to:["o","hs"]},this.doWB&&this.wb.lc(h),this.doPSSTCDL&&this.PSSTCDLOut(h),this.doASCCDL&&this.ASCCDLOut(h),this.multiOut(h),this.doHG?this.HGOut(h,!1):this.csOut[this.curOut].lf(h),this.doGamutLim?this.gamutLimOut(h,out):out.doGamutLim=!1;for(var r,e=s.hues.length,o=new Float64Array(3*e),a=new Float64Array(this.colSqr),n=0;n<e;n++)r=3*(s.hues[n]+256*(255-s.sats[n])),o[3*n]=a[r],o[3*n+1]=a[1+r],o[3*n+2]=a[2+r];this.csOut[this.curOut].lc(o.buffer);for(var u,f=new Uint8Array(3*e),n=0;n<e;n++)255<(u=255/Math.max.apply(Math,[o[3*n],o[3*n+1],o[3*n+2]]))&&(u=255),f[3*n]=Math.min(255,Math.max(0,o[3*n]*u)),f[3*n+1]=Math.min(255,Math.max(0,o[3*n+1]*u)),f[3*n+2]=Math.min(255,Math.max(0,o[3*n+2]*u));return out.hs=f.buffer,out},LUTColourSpace.prototype.ioNames=function(t,i){var s={};return s.inName=this.csIn[this.curIn].name,s.outName=this.csOut[this.curOut].name,s.hgName=this.csOut[this.curHG].name,{p:t,t:i+20,v:this.ver,o:s}},LUTColourSpace.prototype.chartVals=function(t,i,s){t={p:t,t:i+20,v:this.ver,cb:this.csOut[this.curOut].cb()};if(void 0!==s.colIn){for(var h=this.y,r=new Float64Array(s.colIn),e=3*r.length,o=new Float64Array(e),a=new Float64Array(e),n=new Float64Array(e),u=0,i=Math.round(e/3-1),f=12.8/(.2126*r[i-2]),l=12.8/(.7152*r[i-1]),p=12.8/(.0722*r[i]),c=0;c<e;c+=3)o[c]=Math.pow(r[u]*f,1.5),a[c+1]=Math.pow(r[u]*l,1.5),n[c+2]=Math.pow(r[u]*p,1.5),u++;this.csIn[this.rec709In].lc(o.buffer),this.csIn[this.rec709In].lc(a.buffer),this.csIn[this.rec709In].lc(n.buffer);for(var m=new Float64Array(o.buffer.slice(0)),y=new Float64Array(a.buffer.slice(0)),F=new Float64Array(n.buffer.slice(0)),L=s.eiMult,C=this.csOut.length,S=!1,c=0;c<C;c++)if(this.csOut[c].name===this.csIn[this.curIn].name){this.csOut[c].lc(o.buffer),this.csOut[c].lc(a.buffer),this.csOut[c].lc(n.buffer),S=!0;break}if(!S)return self.postMessage({msg:!0,details:this.csIn[this.curIn].name}),t;for(c=0;c<e;c++)isNaN(m[c])?m[c]=0:m[c]*=L,isNaN(y[c])?y[c]=0:y[c]*=L,isNaN(F[c])?F[c]=0:F[c]*=L;if(this.doWB&&(this.wb.lc(m.buffer),this.wb.lc(y.buffer),this.wb.lc(F.buffer)),this.doASCCDL)for(c=0;c<e;c+=3)m[c]=m[c]*this.asc[0]+this.asc[3],m[c]=m[c]<0?m[c]:Math.pow(m[c],this.asc[6]),m[c]=isNaN(m[c])?0:m[c],m[c+1]=m[c+1]*this.asc[1]+this.asc[4],m[c+1]=m[c+1]<0?m[c+1]:Math.pow(m[c+1],this.asc[7]),m[c+1]=isNaN(m[c+1])?0:m[c+1],m[c+2]=m[c+2]*this.asc[2]+this.asc[5],m[c+2]=m[c+2]<0?m[c+2]:Math.pow(m[c+2],this.asc[8]),m[c+2]=isNaN(m[c+2])?0:m[c+2],d=h[0]*m[c]+h[1]*m[c+1]+h[2]*m[c+2],m[c]=d+this.asc[9]*(m[c]-d),m[c+1]=d+this.asc[9]*(m[c+1]-d),m[c+2]=d+this.asc[9]*(m[c+2]-d),y[c]=y[c]*this.asc[0]+this.asc[3],y[c]=y[c]<0?y[c]:Math.pow(y[c],this.asc[6]),y[c]=isNaN(y[c])?0:y[c],y[c+1]=y[c+1]*this.asc[1]+this.asc[4],y[c+1]=y[c+1]<0?y[c+1]:Math.pow(y[c+1],this.asc[7]),y[c+1]=isNaN(y[c+1])?0:y[c+1],y[c+2]=y[c+2]*this.asc[2]+this.asc[5],y[c+2]=y[c+2]<0?y[c+2]:Math.pow(y[c+2],this.asc[8]),y[c+2]=isNaN(y[c+2])?0:y[c+2],d=h[0]*y[c]+h[1]*y[c+1]+h[2]*y[c+2],y[c]=d+this.asc[9]*(y[c]-d),y[c+1]=d+this.asc[9]*(y[c+1]-d),y[c+2]=d+this.asc[9]*(y[c+2]-d),F[c]=F[c]*this.asc[0]+this.asc[3],F[c]=F[c]<0?F[c]:Math.pow(F[c],this.asc[6]),F[c]=isNaN(F[c])?0:F[c],F[c+1]=F[c+1]*this.asc[1]+this.asc[4],F[c+1]=F[c+1]<0?F[c+1]:Math.pow(F[c+1],this.asc[7]),F[c+1]=isNaN(F[c+1])?0:F[c+1],F[c+2]=F[c+2]*this.asc[2]+this.asc[5],F[c+2]=F[c+2]<0?F[c+2]:Math.pow(F[c+2],this.asc[8]),F[c+2]=isNaN(F[c+2])?0:F[c+2],d=h[0]*F[c]+h[1]*F[c+1]+h[2]*F[c+2],F[c]=d+this.asc[9]*(F[c]-d),F[c+1]=d+this.asc[9]*(F[c+1]-d),F[c+2]=d+this.asc[9]*(F[c+2]-d);if(this.doHG){var d,b,w=new Float64Array(m.buffer.slice(0)),g=new Float64Array(y.buffer.slice(0)),M=new Float64Array(F.buffer.slice(0));this.csOut[this.curOut].lf(m.buffer),this.csOut[this.curHG].lf(w.buffer),this.csOut[this.curOut].lf(y.buffer),this.csOut[this.curHG].lf(g.buffer),this.csOut[this.curOut].lf(F.buffer),this.csOut[this.curHG].lf(M.buffer);for(c=0;c<e;c+=3)(d=h[0]*m[c]+h[1]*m[c+1]+h[2]*m[c+2])>=this.hgHigh?(m[c]=w[c],m[c+1]=w[c+1],m[c+2]=w[c+2]):d>this.hgLow&&(b=this.hgLin?(this.hgHigh-d)/(this.hgHigh-this.hgLow):(this.hgHighStop-Math.log(5*d)/Math.LN2)/(this.hgHighStop-this.hgLowStop),m[c]=m[c]*b+w[c]*(1-b),m[c+1]=m[c+1]*b+w[c+1]*(1-b),m[c+2]=m[c+2]*b+w[c+2]*(1-b)),(d=h[0]*y[c]+h[1]*y[c+1]+h[2]*y[c+2])>=this.hgHigh?(y[c]=g[c],y[c+1]=g[c+1],y[c+2]=g[c+2]):d>this.hgLow&&(b=this.hgLin?(this.hgHigh-d)/(this.hgHigh-this.hgLow):(this.hgHighStop-Math.log(5*d)/Math.LN2)/(this.hgHighStop-this.hgLowStop),y[c]=y[c]*b+g[c]*(1-b),y[c+1]=y[c+1]*b+g[c+1]*(1-b),y[c+2]=y[c+2]*b+g[c+2]*(1-b)),(d=h[0]*F[c]+h[1]*F[c+1]+h[2]*F[c+2])>=this.hgHigh?(F[c]=M[c],F[c+1]=M[c+1],F[c+2]=M[c+2]):d>this.hgLow&&(b=this.hgLin?(this.hgHigh-d)/(this.hgHigh-this.hgLow):(this.hgHighStop-Math.log(5*d)/Math.LN2)/(this.hgHighStop-this.hgLowStop),F[c]=F[c]*b+M[c]*(1-b),F[c+1]=F[c+1]*b+M[c+1]*(1-b),F[c+2]=F[c+2]*b+M[c+2]*(1-b))}else this.csOut[this.curOut].lf(m.buffer),this.csOut[this.curOut].lf(y.buffer),this.csOut[this.curOut].lf(F.buffer);for(var A=new Float64Array(r.length),x=new Float64Array(r.length),T=new Float64Array(r.length),v=new Float64Array(r.length),I=new Float64Array(r.length),R=new Float64Array(r.length),u=0,c=0;c<e;c+=3)A[u]=.2126*o[c]+.7152*o[c+1]+.0722*o[c+2],x[u]=.2126*a[c]+.7152*a[c+1]+.0722*a[c+2],T[u]=.2126*n[c]+.7152*n[c+1]+.0722*n[c+2],v[u]=.2126*m[c]+.7152*m[c+1]+.0722*m[c+2],I[u]=.2126*y[c]+.7152*y[c+1]+.0722*y[c+2],R[u]=.2126*F[c]+.7152*F[c+1]+.0722*F[c+2],u++;t.rIn=A.buffer,t.gIn=x.buffer,t.bIn=T.buffer,t.rOut=v.buffer,t.gOut=I.buffer,t.bOut=R.buffer,t.to=["rIn","gIn","bIn","rOut","gOut","bOut"]}return t},LUTColourSpace.prototype.getCATs=function(t,i){return{p:t,t:i+20,v:this.ver,o:this.CATs.getModels()}},LUTColourSpace.prototype.previewLin=function(t,i,s){i={p:t,t:i+20,v:this.ver,gamma:s.gamma,gamut:s.gamut,legal:s.legal,i:s.i,o:s.o};return this.csIn[s.gamut].lc(s.o),i.to=["i","o"],i},LUTColourSpace.prototype.getPrimaries=function(t,i){var s=this.clrs.slice(0);return this.csOut[this.curOut].lc(s),{p:t,t:i+20,v:this.ver,o:s,cb:this.csOut[this.curOut].cb(),to:["o"]}},LUTColourSpace.prototype.psstColours=function(t,i){for(var s,h,r,e,o,a,n,u,f,i={p:t,t:i+20,v:this.ver,cb:this.csOut[this.curOut].cb()},l=new Float64Array(84),p=new Float64Array(84),c=this.y,m=2*(1-c[2]),y=2*(1-c[0]),F=0,L=0;L<84;L+=3)s=F,F+=1/28,h=this.psstB.fCub(s),r=this.psstM.fLin(s),a=this.psstC.fCub(s),(n=this.psstSat.fCub(s))<0&&(n=0),S=this.psstS.fCub(s),S<0&&(S=0),O=this.psstO.fCub(s),P=this.psstP.fCub(s),P<0&&(P=0),e=.5*r,y1=this.psstY.fLin(s),o=.7*y1,u=e*Math.cos(h),f=e*Math.sin(h),l[L]=f*y+o,l[L+2]=u*m+o,l[L+1]=(o-c[0]*l[L]-c[2]*l[L+2])/c[1],s+=a%1,y2=this.psstYC?this.psstY.fLin(s):y1,e=e*(this.psstMC?this.psstM.fLin(s):r)*n/r,h=this.psstB.fCub(s),o=(o=o*S/y1+O)<0?o:Math.pow(o,P),o=isNaN(o)?0:o,o*=y2,u=e*Math.cos(h),f=e*Math.sin(h),p[L]=f*y+o,p[L+2]=u*m+o,p[L+1]=(o-c[0]*p[L]-c[2]*p[L+2])/c[1];return this.csOut[this.curOut].lc(l.buffer),this.csOut[this.curOut].lc(p.buffer),i.b=l.buffer,i.a=p.buffer,i.to=["b","a"],i},LUTColourSpace.prototype.getCCTDuv=function(t,i,s){t={p:t,t:i+20,v:this.ver},i=new Float64Array(s.rgb),s=this.wb.toLocus(this.mMult(this.system.toXYZ,i)),i=s[0]+s[1]+s[2],s=new Float64Array([s[0]/i,s[1]/i,s[2]/i]),i=this.planck.getCCT(s),s=this.planck.getDuvMag(s,i);return t.sys=this.wb.getSys(),t.ct=i,t.lamp=t.ct,t.duv=(-s[0]/.0175).toFixed(2),t.dpl=0,this.wb.setVals(t.sys,t.ct,t.lamp,t.duv,t.dpl),t},LUTColourSpace.prototype.calcPrimaries=function(t,i){var s,h,r,e,o,a,n=new Float64Array([1,1,1,1,0,0,0,1,0,0,0,1]),u=new Float64Array([1,1,1,1,0,0,0,1,0,0,0,1]),f=new Float64Array(16);this.csIn[this.curIn].lc(n.buffer),this.csOut[this.XYZOut].lc(n.buffer),e=this.csIn[this.curIn].getWP(),o=this.system.white;for(var l=0;l<4;l++)s=3*l,h=2*l,r=(a=this.calcCAT(new Float64Array([n[s],n[s+1],n[s+2]]),o,e,this.inCATs[this.curIn]))[0]+a[1]+a[2],f[h]=a[0]/r,f[h+1]=a[1]/r;this.rx(u.buffer),this.csOut[this.XYZOut].lc(u.buffer),e=this.csOut[this.curOut].getWP(),o=this.system.white;for(l=0;l<4;l++)s=3*l,h=2*l,r=(a=this.calcCAT(new Float64Array([u[s],u[s+1],u[s+2]]),o,e,this.outCATs[this.curOut]))[0]+a[1]+a[2],f[h+8]=a[0]/r,f[h+9]=a[1]/r;return{p:t,t:i+20,v:this.ver,xy:f}},LUTCSWorker.prototype.sendCSMessage=function(t){if(this.cs.isTrans&&void 0!==t.to){for(var i=t.to.length,s=[],h=0;h<i;h++)s.push(t[t.to[h]]);postMessage(t,s)}else postMessage(t)};var workerCSString=getCSString();function LUTs(){}function LUTSpline(t){"string"==typeof t.title?this.title=t.title:this.title="","string"==typeof t.format?this.format=t.format:this.format="",void 0!==t.meta?this.meta=t.meta:this.meta={},this.FD=new Float64Array(t.buff);var i=this.FD.length,s=this.FD[i-1]-this.FD[0];0<=s?s=1:s<0&&(s=-1),this.FA=new Float64Array(i),this.FB=new Float64Array(i),this.FC=new Float64Array(i);for(var h=new Float64Array(i),r=new Float64Array(i),e=0;e<i;e++)0===e?(h[0]=this.FD[1],this.FC[0]=-.5*this.FD[2]+2*this.FD[1]-1.5*this.FD[0],this.FC[0]*s<=0&&(this.FC[0]=.0075*s/(i-1)),r[0]=(this.FD[2]-this.FD[0])/2):e<i-1?(h[e]=this.FD[e+1],this.FC[e]=(this.FD[e+1]-this.FD[e-1])/2,e===i-2?(r[e]=.5*this.FD[e-1]-2*this.FD[e]+1.5*this.FD[e+1],r[e]*s<=0&&(r[e]=.0075*s/(i-1))):r[e]=(this.FD[e+2]-this.FD[e])/2):(h[e]=this.FD[e],this.FC[e]=r[e-1],r[e]=r[e-1]),this.FA[e]=2*this.FD[e]+this.FC[e]-2*h[e]+r[e],this.FB[e]=-3*this.FD[e]-2*this.FC[e]+3*h[e]-r[e];this.FM=i-1,this.fS=!1,void 0===t.fL&&void 0!==t.min&&0!==t.min[0]&&(t.fL=t.min[0]),void 0===t.fH&&void 0!==t.max&&1!==t.max[0]&&(t.fH=t.max[0]),"number"==typeof t.fH?(this.fH=t.fH,"number"==typeof t.fL?this.fL=t.fL:this.fL=0):(this.fH=1,this.fL=0),this.fLH=this.fH-this.fL,0===this.fL&&1===this.fH||(this.fS=!0),void 0!==t.inSpline?(this.sin=!0,this.ins=new LUTQSpline(t.inSpline)):this.sin=!1}function LUTRSpline(t){this.method=0,"string"==typeof t.title?this.title=t.title:this.title="","string"==typeof t.format?this.format=t.format:this.format="",void 0!==t.meta?this.meta=t.meta:this.meta={},this.FD=new Float64Array(t.buff);var i=this.FD.length,s=this.FD[i-1]-this.FD[0];0<=s?s=1:s<0&&(s=-1),this.FA=new Float64Array(i),this.FB=new Float64Array(i),this.FC=new Float64Array(i);for(var h=new Float64Array(i),r=new Float64Array(i),e=0;e<i;e++)0===e?(h[0]=this.FD[1],this.FC[0]=-.5*this.FD[2]+2*this.FD[1]-1.5*this.FD[0],this.FC[0]*s<=0&&(this.FC[0]=.0075*s/(i-1)),r[0]=(this.FD[2]-this.FD[0])/2):e<i-1?(h[e]=this.FD[e+1],this.FC[e]=(this.FD[e+1]-this.FD[e-1])/2,e===i-2?(r[e]=.5*this.FD[e-1]-2*this.FD[e]+1.5*this.FD[e+1],r[e]*s<=0&&(r[e]=.0075*s/(i-1))):r[e]=(this.FD[e+2]-this.FD[e])/2):(h[e]=this.FD[e],this.FC[e]=r[e-1],r[e]=r[e-1]),this.FA[e]=2*this.FD[e]+this.FC[e]-2*h[e]+r[e],this.FB[e]=-3*this.FD[e]-2*this.FC[e]+3*h[e]-r[e];this.FM=i-1,void 0!==t.inSpline?(this.sin=!0,this.ins=new LUTQSpline(t.inSpline)):this.sin=!1,this.fS=!1,void 0===t.fL&&void 0!==t.min&&0!==t.min[0]&&(t.fL=t.min[0]),void 0===t.fH&&void 0!==t.max&&1!==t.max[0]&&(t.fH=t.max[0]),"number"==typeof t.fH?(this.fH=t.fH,"number"==typeof t.fL?this.fL=t.fL:this.fL=0):(this.fH=1,this.fL=0),this.fLH=this.fH-this.fL,0===this.fL&&1===this.fH||(this.fS=!0),void 0===t.rL&&void 0!==t.rmin&&0!==t.rmin[0]&&(t.rL=t.rmin[0]),void 0===t.rH&&void 0!==t.rmax&&1!==t.rmax[0]&&(t.rH=t.rmax[0]),"number"==typeof t.rH?(this.rH=rH,"number"==typeof t.rL?this.rL=rL:this.rL=this.fL):(this.rH=this.FD[i-1],this.rL=this.FD[0]),this.rLH=this.rH-this.rL,t="number"==typeof t.minRM?Math.max(i,minRM):Math.max(i,1024),this.RM=t-1,this.brent=new Brent(this),this.buildReverse()}function LUTQSpline(t){this.meta={},this.FD=new Float64Array(t);var i=this.FD.length,s=this.FD[i-1]-this.FD[0];0<=s?s=1:s<0&&(s=-1),this.FA=new Float64Array(i),this.FB=new Float64Array(i),this.FC=new Float64Array(i);for(var h=new Float64Array(i),r=new Float64Array(i),e=0;e<i;e++)0===e?(h[0]=this.FD[1],this.FC[0]=-.5*this.FD[2]+2*this.FD[1]-1.5*this.FD[0],this.FC[0]*s<=0&&(this.FC[0]=.0075*s/(i-1)),r[0]=(this.FD[2]-this.FD[0])/2):e<i-1?(h[e]=this.FD[e+1],this.FC[e]=(this.FD[e+1]-this.FD[e-1])/2,e===i-2?(r[e]=.5*this.FD[e-1]-2*this.FD[e]+1.5*this.FD[e+1],r[e]*s<=0&&(r[e]=.0075*s/(i-1))):r[e]=(this.FD[e+2]-this.FD[e])/2):(h[e]=this.FD[e],this.FC[e]=r[e-1],r[e]=r[e-1]),this.FA[e]=2*this.FD[e]+this.FC[e]-2*h[e]+r[e],this.FB[e]=-3*this.FD[e]-2*this.FC[e]+3*h[e]-r[e];this.FM=i-1}function LUTRGBSpline(t){var i;"string"==typeof t.title?this.title=t.title:this.title="","string"==typeof t.format?this.format=t.format:this.format="",void 0!==t.meta?this.meta=t.meta:this.meta={},this.Y=new Float64Array([.2126,.7152,.0722]),this.fL=new Float64Array(4),this.fH=new Float64Array(4),this.fS=!1,void 0===t.min||0===t.min[0]&&0===t.min[1]&&0===t.min[2]||(t.fL=t.min[0],t.fLR=t.min[0],t.fLG=t.min[1],t.fLB=t.min[2]),void 0===t.max||1===t.max[0]&&1===t.max[1]&&1===t.max[2]||(t.fH=t.max[0],t.fHR=t.max[0],t.fHG=t.max[1],t.fHB=t.max[2]),"number"==typeof t.fH?(this.fH[0]=t.fH,this.fH[1]=t.fH,this.fH[2]=t.fH):(this.fH[0]=1,this.fH[1]=1,this.fH[2]=1),"number"==typeof t.fL?(this.fL[0]=t.fL,this.fL[1]=t.fL,this.fL[2]=t.fL):(this.fL[0]=0,this.fL[1]=0,this.fL[2]=0),"number"==typeof t.fLR&&"number"==typeof t.fHR&&"number"==typeof t.fLG&&"number"==typeof t.fHG&&"number"==typeof t.fLB&&"number"==typeof t.fHB&&(this.fL[0]=t.fLR,this.fH[0]=t.fHR,this.fL[1]=t.fLG,this.fH[1]=t.fHG,this.fL[2]=t.fLB,this.fH[2]=t.fHB),this.fLH=new Float64Array([this.fH[0]-this.fL[0],this.fH[1]-this.fL[1],this.fH[2]-this.fL[2],0]),0===this.fL[0]&&0===this.fL[1]&&0===this.fL[2]&&1===this.fH[0]&&1===this.fH[1]&&1===this.fH[2]||(this.fS=!0),void 0!==t.inSpline?(this.sin=!0,this.ins=new LUTQSpline(t.inSpline)):this.sin=!1,this.FA=[],this.FB=[],this.FC=[],this.FD=[],this.FM=[],this.FD[0]=new Float64Array(t.buffR),this.FD[1]=new Float64Array(t.buffG),this.FD[2]=new Float64Array(t.buffB);for(var s=0;s<3;s++)i=this.FD[s].length,this.FA[s]=new Float64Array(i),this.FB[s]=new Float64Array(i),this.FC[s]=new Float64Array(i),this.FM[s]=i-1;this.buildMesh(),this.buildL()}function LUTVolume(t){"string"==typeof t.title?this.title=t.title:this.title="","string"==typeof t.format?this.format=t.format:this.format="",void 0!==t.meta?this.meta=t.meta:this.meta={},this.Y=new Float64Array([.2126,.7152,.0722]),this.fL=new Float64Array(4),this.fH=new Float64Array(4),this.fS=!1,void 0===t.min||0===t.min[0]&&0===t.min[1]&&0===t.min[2]||(t.fL=t.min[0],t.fLR=t.min[0],t.fLG=t.min[1],t.fLB=t.min[2]),void 0===t.max||1===t.max[0]&&1===t.max[1]&&1===t.max[2]||(t.fH=t.max[0],t.fHR=t.max[0],t.fHG=t.max[1],t.fHB=t.max[2]),"number"==typeof t.fH?(this.fH[0]=t.fH,this.fH[1]=t.fH,this.fH[2]=t.fH):(this.fH[0]=1,this.fH[1]=1,this.fH[2]=1),"number"==typeof t.fL?(this.fL[0]=t.fL,this.fL[1]=t.fL,this.fL[2]=t.fL):(this.fL[0]=0,this.fL[1]=0,this.fL[2]=0),"number"==typeof t.fLR&&"number"==typeof t.fHR&&"number"==typeof t.fLG&&"number"==typeof t.fHG&&"number"==typeof t.fLB&&"number"==typeof t.fHB&&(this.fL[0]=t.fLR,this.fH[0]=t.fHR,this.fL[1]=t.fLG,this.fH[1]=t.fHG,this.fL[2]=t.fLB,this.fH[2]=t.fHB),this.fL[3]=Math.min(this.fL[0],this.fL[1],this.fL[2]),this.fH[3]=Math.max(this.fH[0],this.fH[1],this.fH[2]),this.fLH=new Float64Array([this.fH[0]-this.fL[0],this.fH[1]-this.fL[1],this.fH[2]-this.fL[2],0]),0===this.fL[0]&&0===this.fL[1]&&0===this.fL[2]&&1===this.fH[0]&&1===this.fH[1]&&1===this.fH[2]||(this.fS=!0),void 0!==t.inSpline?(this.sin=!0,this.ins=new LUTQSpline(t.inSpline)):this.sin=!1,this.pR=new Float64Array(4),this.pG=new Float64Array(4),this.pB=new Float64Array(4),this.buildMesh(t.buffR,t.buffG,t.buffB),this.buildL(),this.extVars={dc:new Float64Array(this.d),r:new Float64Array(this.d),J:new Float64Array(3*this.d),JtJ:new Float64Array(9),JtJI:new Float64Array(9),Jtr:new Float64Array(3),del:new Float64Array(3)},this.ABab=new Float64Array([1,0,1,0])}function getLUTString(){var t,i="";for(t in i+=LUTs.toString()+"\n",LUTs.prototype)i+="LUTs.prototype."+t+"="+LUTs.prototype[t].toString()+"\n";for(t in i+=LUTSpline.toString()+"\n",LUTSpline.prototype)i+="LUTSpline.prototype."+t+"="+LUTSpline.prototype[t].toString()+"\n";for(t in i+=LUTRGBSpline.toString()+"\n",LUTRGBSpline.prototype)i+="LUTRGBSpline.prototype."+t+"="+LUTRGBSpline.prototype[t].toString()+"\n";for(t in i+=LUTRSpline.toString()+"\n",LUTRSpline.prototype)i+="LUTRSpline.prototype."+t+"="+LUTRSpline.prototype[t].toString()+"\n";for(t in i+=LUTQSpline.toString()+"\n",LUTQSpline.prototype)i+="LUTQSpline.prototype."+t+"="+LUTQSpline.prototype[t].toString()+"\n";for(t in i+=LUTVolume.toString()+"\n",LUTVolume.prototype)i+="LUTVolume.prototype."+t+"="+LUTVolume.prototype[t].toString()+"\n";return i}LUTs.prototype.newLUT=function(t){var i={};return"string"==typeof t.title&&(i.title=t.title),"string"==typeof t.format&&(i.format=t.format),"number"==typeof t.dims?this.dims=t.dims:dims=1,void 0===t.min||0===t.min[0]&&0===t.min[1]&&0===t.min[2]||(i.fL=t.min[0],i.fLR=t.min[0],i.fLG=t.min[1],i.fLB=t.min[2]),void 0===t.max||1===t.max[0]&&1===t.max[1]&&1===t.max[2]||(i.fH=t.max[0],i.fHR=t.max[0],i.fHG=t.max[1],i.fHB=t.max[2]),"number"==typeof t.fL&&(i.fL=t.fL),"number"==typeof t.fH&&(i.fH=t.fH),"number"==typeof t.fLR&&(i.fLR=t.fLR),"number"==typeof t.fLG&&(i.fLG=t.fLG),"number"==typeof t.fLB&&(i.fLB=t.fLB),"number"==typeof t.fHR&&(i.fHR=t.fHR),"number"==typeof t.fHG&&(i.fHG=t.fHG),"number"==typeof t.fHB&&(i.fHB=t.fHB),void 0!==t.spline&&(i.inSpline=t.spline),void 0!==t.meta&&(i.meta=t.meta),3===t.C.length?(i.buffR=t.C[0].slice(0),i.buffG=t.C[1].slice(0),i.buffB=t.C[2].slice(0),new(3===this.dims?LUTVolume:LUTRGBSpline)(i)):(i.buff=t.C[0].slice(0),new LUTSpline(i))},LUTSpline.prototype.buildL=function(){var t=this.FD.length,i=this.FD[t-1]-this.FD[0];0<=i?i=1:i<0&&(i=-1);for(var s=new Float64Array(t),h=new Float64Array(t),r=0;r<t;r++)0===r?(s[0]=this.FD[1],this.FC[0]=-.5*this.FD[2]+2*this.FD[1]-1.5*this.FD[0],this.FC[0]*i<=0&&(this.FC[0]=.0075*i/(t-1)),h[0]=(this.FD[2]-this.FD[0])/2):r<t-1?(s[r]=this.FD[r+1],this.FC[r]=(this.FD[r+1]-this.FD[r-1])/2,r===t-2?(h[r]=.5*this.FD[r-1]-2*this.FD[r]+1.5*this.FD[r+1],h[r]*i<=0&&(h[r]=.0075*i/(t-1))):h[r]=(this.FD[r+2]-this.FD[r])/2):(s[r]=this.FD[r],this.FC[r]=h[r-1],h[r]=h[r-1]),this.FA[r]=2*this.FD[r]+this.FC[r]-2*s[r]+h[r],this.FB[r]=-3*this.FD[r]-2*this.FC[r]+3*s[r]-h[r];this.FM=t-1},LUTSpline.prototype.f=function(t){var i=this.FM;return this.fS&&(t=(t-this.fL)/this.fLH),this.sin&&(t=this.ins.f(t)),(t*=i)<=0?t*this.FC[0]+this.FD[0]:i<=t?(t-i)*this.FC[i]+this.FD[i]:(t=t-(i=Math.floor(t)),((this.FA[i]*t+this.FB[i])*t+this.FC[i])*t+this.FD[i])},LUTSpline.prototype.df=function(t){var i,s,h=this.FM;return this.fS&&(t=(t-this.fL)/this.fLH),this.sin&&(t=this.ins.f(t)),s=(t*=h)<=0?h*this.FC[0]:h<=t?h*this.FC[h]:(i=t-(s=Math.floor(t)),h*((3*this.FA[s]*i+2*this.FB[s])*i+this.FC[s])),this.sin&&(s*=this.ins.df(t)),this.fS&&(s/=this.fLH),s},LUTSpline.prototype.fCub=function(t){var i=this.FM;return this.fS&&(t=(t-this.fL)/this.fLH),this.sin&&(t=this.ins.f(t)),(t*=i)<=0?t*this.FC[0]+this.FD[0]:i<=t?(t-i)*this.FC[i]+this.FD[i]:(t=t-(i=Math.floor(t)),((this.FA[i]*t+this.FB[i])*t+this.FC[i])*t+this.FD[i])},LUTSpline.prototype.fTet=function(t){var i=this.FM;return this.fS&&(t=(t-this.fL)/this.fLH),this.sin&&(t=this.ins.f(t)),(t*=i)<=0?t*this.FC[0]+this.FD[0]:i<=t?(t-i)*this.FC[i]+this.FD[i]:(1-(t=t-(i=Math.floor(t))))*this.FD[i]+t*this.FD[i+1]},LUTSpline.prototype.fLin=function(t){var i=this.FM;return this.fS&&(t=(t-this.fL)/this.fLH),this.sin&&(t=this.ins.f(t)),(t*=i)<=0?t*this.FC[0]+this.FD[0]:i<=t?(t-i)*this.FC[i]+this.FD[i]:(1-(t=t-(i=Math.floor(t))))*this.FD[i]+t*this.FD[i+1]},LUTSpline.prototype.FCub=function(t){var i,s,h=new Float64Array(t),r=h.length,e=this.FM;if(this.fS)for(var o=0;o<r;o++)h[o]=(h[o]-this.fL)/this.fLH;this.sin&&this.ins.FCub(t);for(o=0;o<r;o++)h[o]*=e,h[o]<=0?h[o]=h[o]*this.FC[0]+this.FD[0]:h[o]>=e?h[o]=(h[o]-e)*this.FC[e]+this.FD[e]:(s=Math.floor(h[o]),i=h[o]-s,h[o]=((this.FA[s]*i+this.FB[s])*i+this.FC[s])*i+this.FD[s])},LUTSpline.prototype.FTet=function(t){var i,s,h=new Float64Array(t),r=h.length,e=this.FM;if(this.fS)for(var o=0;o<r;o++)h[o]=(h[o]-this.fL)/this.fLH;this.sin&&this.ins.FCub(t);for(o=0;o<r;o++)h[o]*=e,h[o]<=0?h[o]=h[o]*this.FC[0]+this.FD[0]:h[o]>=e?h[o]=(h[o]-e)*this.FC[e]+this.FD[e]:(s=Math.floor(h[o]),i=h[o]-s,h[o]=(1-i)*this.FD[s]+i*this.FD[s+1])},LUTSpline.prototype.FLin=function(t){var i,s,h=new Float64Array(t),r=h.length,e=this.FM;if(this.fS)for(var o=0;o<r;o++)h[o]=(h[o]-this.fL)/this.fLH;this.sin&&this.ins.FCub(t);for(o=0;o<r;o++)h[o]*=e,h[o]<=0?h[o]=h[o]*this.FC[0]+this.FD[0]:h[o]>=e?h[o]=(h[o]-e)*this.FC[e]+this.FD[e]:(s=Math.floor(h[o]),i=h[o]-s,h[o]=(1-i)*this.FD[s]+i*this.FD[s+1])},LUTSpline.prototype.fRGBCub=function(t){var i,s=this.FM;return this.fS&&(t=(t-this.fL)/this.fLH),this.sin&&(t=this.ins.f(t)),t=(t*=s)<=0?t*this.FC[0]+this.FD[0]:s<=t?(t-s)*this.FC[s]+this.FD[s]:(s=t-(i=Math.floor(t)),((this.FA[i]*s+this.FB[i])*s+this.FC[i])*s+this.FD[i]),new Float64Array([t,t,t])},LUTSpline.prototype.fRGBTet=function(t){var i,s=this.FM;return this.fS&&(t=(t-this.fL)/this.fLH),this.sin&&(t=this.ins.f(t)),t=(t*=s)<=0?t*this.FC[0]+this.FD[0]:s<=t?(t-s)*this.FC[s]+this.FD[s]:(1-(s=t-(i=Math.floor(t))))*this.FD[i]+s*this.FD[i+1],new Float64Array([t,t,t])},LUTSpline.prototype.fRGBLin=function(t){var i,s=this.FM;return this.fS&&(t=(t-this.fL)/this.fLH),this.sin&&(t=this.ins.f(t)),t=(t*=s)<=0?t*this.FC[0]+this.FD[0]:s<=t?(t-s)*this.FC[s]+this.FD[s]:(1-(s=t-(i=Math.floor(t))))*this.FD[i]+s*this.FD[i+1],new Float64Array([t,t,t])},LUTSpline.prototype.rgbCub=function(t){t=new Float64Array(t.buffer.slice(0));return this.FCub(t.buffer),t},LUTSpline.prototype.rgbTet=function(t){t=new Float64Array(t.buffer.slice(0));return this.FTet(t.buffer),t},LUTSpline.prototype.rgbLin=function(t){t=new Float64Array(t.buffer.slice(0));return this.FLin(t.buffer),t},LUTSpline.prototype.RGBCub=function(t){this.FCub(out)},LUTSpline.prototype.RGBLin=function(t){this.FTet(out)},LUTSpline.prototype.RGBLin=function(t){this.FLin(out)},LUTSpline.prototype.J=function(t){if(3!==t.length)return!1;var i,s,h=new Float64Array(t.buffer.slice(0)),r=new Float64Array(9),t=this.FM;return this.fS&&(h[0]=(h[0]-this.fL)/this.fLH,h[1]=(h[1]-this.fL)/this.fLH,h[2]=(h[2]-this.fL)/this.fLH),this.sin&&(h[0]=this.ins.f(h[0]),h[1]=this.ins.f(h[1]),h[2]=this.ins.f(h[2])),h[0]*=t,h[1]*=t,h[2]*=t,h[0]<=0?r[0]=this.FC[0]:h[0]>=t?r[0]=this.FC[t]:(s=Math.floor(h[0]),i=h[0]-s,r[0]=(3*this.FA[s]*i+2*this.FB[s])*i+this.FC[s]),h[1]<=0?r[4]=this.FC[0]:h[1]>=t?r[4]=this.FC[t]:(s=Math.floor(h[1]),i=h[1]-s,r[4]=(3*this.FA[s]*i+2*this.FB[s])*i+this.FC[s]),h[2]<=0?r[8]=this.FC[0]:h[2]>=t?r[8]=this.FC[t]:(s=Math.floor(h[2]),i=h[2]-s,r[8]=(3*this.FA[s]*i+2*this.FB[s])*i+this.FC[s]),r},LUTSpline.prototype.JInv=function(t){t=this.J(t);return 0!==t[0]&&0!==t[4]&&0!==t[8]&&new Float64Array([1/t[0],0,0,0,1/t[4],0,0,0,1/t[8]])},LUTSpline.prototype.getDetails=function(){return{title:this.title,format:this.format,dims:1,s:this.FM+1,min:new Float64Array([this.fL,this.fL,this.fL]),max:new Float64Array([this.fH,this.fH,this.fH]),C:[this.FD.buffer],meta:this.meta}},LUTSpline.prototype.getL=function(){return this.FD.buffer},LUTSpline.prototype.getRGB=function(){return[this.FD.buffer]},LUTSpline.prototype.getSize=function(){return this.FM+1},LUTSpline.prototype.is1D=function(){return!0},LUTSpline.prototype.is3D=function(){return!1},LUTSpline.prototype.getTitle=function(){return this.title},LUTSpline.prototype.getMetadata=function(){return this.meta},LUTSpline.prototype.isClamped=function(){var t;return void 0===this.clamped&&(0===(t=this.minMax())[0]&&t[1]<=1||0<=t[0]&&1===t[1]?this.clamped=!0:this.clamped=!1),this.clamped},LUTSpline.prototype.deClamp=function(){if(this.isClamped()){for(var t=this.FD,i=t.length,s=!1,h=0,r=i-1,e=0;e<i;e++)0<e&&0===t[e]&&(s=!0,h=e+1);for(e=i-2;0<=e;e--)1===t[e]&&(s=!0,r=e-1);if(s){r<h&&(n=r,r=Math.min(h-2,i-1),h=Math.max(n+2,0));for(var o=r-h,a=new LUTQSpline(new Float64Array((void 0).subarray(h,1+o)).buffer),n=this.fL,e=(this.fH,0);e<i;e++)e===h&&(e=r),t[e]=a.fCub((e-h)/o)}this.buildL(),this.clamped=!1}},LUTSpline.prototype.minMax=function(){for(var t=new Float64Array([9999,-9999]),i=this.FD,s=i.length,h=0;h<s;h++)i[h]<t[0]&&(t[0]=i[h]),i[h]>t[1]&&(t[1]=i[h]);return t},LUTRSpline.prototype.f=function(t){var i=this.FM;return this.fS&&(t=(t-this.fL)/this.fLH),this.sin&&(t=this.ins.f(t)),(t*=i)<=0?t*this.FC[0]+this.FD[0]:i<=t?(t-i)*this.FC[i]+this.FD[i]:(t=t-(i=Math.floor(t)),0===this.method?((this.FA[i]*t+this.FB[i])*t+this.FC[i])*t+this.FD[i]:(1-t)*this.FD[i]+t*this.FD[i+1])},LUTRSpline.prototype.df=function(t){var i,s,h,r=this.FM;if(this.fS&&(t=(t-this.fL)/this.fLH),this.sin&&(t=this.ins.f(t)),(t*=r)<=0)i=r*this.FC[0];else if(r<=t)i=r*this.FC[r];else{if(s=t-(h=Math.floor(t)),0!==this.method)return r*(this.FD[h+1]-this.FD[h]);i=r*((3*this.FA[h]*s+2*this.FB[h])*s+this.FC[h])}return this.sin&&(i*=this.ins.df(t)),this.fS&&(i/=this.fLH),i},LUTRSpline.prototype.fCub=function(t){var i=this.FM;return this.fS&&(t=(t-this.fL)/this.fLH),this.sin&&(t=this.ins.f(t)),(t*=i)<=0?t*this.FC[0]+this.FD[0]:i<=t?(t-i)*this.FC[i]+this.FD[i]:(t=t-(i=Math.floor(t)),((this.FA[i]*t+this.FB[i])*t+this.FC[i])*t+this.FD[i])},LUTRSpline.prototype.fTet=function(t){var i=this.FM;return this.fS&&(t=(t-this.fL)/this.fLH),this.sin&&(t=this.ins.f(t)),(t*=i)<=0?t*this.FC[0]+this.FD[0]:i<=t?(t-i)*this.FC[i]+this.FD[i]:(1-(t=t-(i=Math.floor(t))))*this.FD[i]+t*this.FD[i+1]},LUTRSpline.prototype.fLin=function(t){var i=this.FM;return this.fS&&(t=(t-this.fL)/this.fLH),this.sin&&(t=this.ins.f(t)),(t*=i)<=0?t*this.FC[0]+this.FD[0]:i<=t?(t-i)*this.FC[i]+this.FD[i]:(1-(t=t-(i=Math.floor(t))))*this.FD[i]+t*this.FD[i+1]},LUTRSpline.prototype.FCub=function(t){var i,s,h=new Float64Array(t),r=h.length,e=this.FM;if(this.fS)for(var o=0;o<r;o++)h[o]=(h[o]-this.fL)/this.fLH;this.sin&&this.ins.FCub(t);for(o=0;o<r;o++)h[o]*=e,h[o]<=0?h[o]=h[o]*this.FC[0]+this.FD[0]:h[o]>=e?h[o]=(h[o]-e)*this.FC[e]+this.FD[e]:(s=Math.floor(h[o]),i=h[o]-s,h[o]=((this.FA[s]*i+this.FB[s])*i+this.FC[s])*i+this.FD[s])},LUTRSpline.prototype.FTet=function(t){var i,s,h=new Float64Array(t),r=h.length,e=this.FM;if(this.fS)for(var o=0;o<r;o++)h[o]=(h[o]-this.fL)/this.fLH;this.sin&&this.ins.FCub(t);for(o=0;o<r;o++)h[o]*=e,h[o]<=0?h[o]=h[o]*this.FC[0]+this.FD[0]:h[o]>=e?h[o]=(h[o]-e)*this.FC[e]+this.FD[e]:(s=Math.floor(h[o]),i=h[o]-s,h[o]=(1-i)*this.FD[s]+i*this.FD[s+1])},LUTRSpline.prototype.FLin=function(t){var i,s,h=new Float64Array(t),r=h.length,e=this.FM;if(this.fS)for(var o=0;o<r;o++)h[o]=(h[o]-this.fL)/this.fLH;this.sin&&this.ins.FCub(t);for(o=0;o<r;o++)h[o]*=e,h[o]<=0?h[o]=h[o]*this.FC[0]+this.FD[0]:h[o]>=e?h[o]=(h[o]-e)*this.FC[e]+this.FD[e]:(s=Math.floor(h[o]),i=h[o]-s,h[o]=(1-i)*this.FD[s]+i*this.FD[s+1])},LUTRSpline.prototype.fRGBCub=function(t){return t=this.f(t),new Float64Array([t,t,t])},LUTRSpline.prototype.fRGBTet=function(t){return t=this.fLin(t),new Float64Array([t,t,t])},LUTRSpline.prototype.fRGBLin=function(t){return t=this.fLin(t),new Float64Array([t,t,t])},LUTRSpline.prototype.rgbCub=function(t){t=new Float64Array(t.buffer.slice(0));return this.FCub(t.buffer),t},LUTRSpline.prototype.rgbTet=function(t){t=new Float64Array(t.buffer.slice(0));return this.FLin(t.buffer),t},LUTRSpline.prototype.rgbLin=function(t){t=new Float64Array(t.buffer.slice(0));return this.FLin(t.buffer),t},LUTRSpline.prototype.RGBCub=function(t){this.FCub(out)},LUTRSpline.prototype.RGBTet=function(t){this.FLin(out)},LUTRSpline.prototype.RGBLin=function(t){this.FLin(out)},LUTRSpline.prototype.J=function(t){if(3!==t.length)return!1;var i,s,h=new Float64Array(t.buffer.slice(0)),r=new Float64Array(9),t=this.FM;return this.fS&&(h[0]=(h[0]-this.fL)/this.fLH,h[1]=(h[1]-this.fL)/this.fLH,h[2]=(h[2]-this.fL)/this.fLH),this.sin&&(h[0]=this.ins.f(h[0]),h[1]=this.ins.f(h[1]),h[2]=this.ins.f(h[2])),h[0]*=t,h[1]*=t,h[2]*=t,h[0]<=0?r[0]=this.FC[0]:h[0]>=t?r[0]=this.FC[t]:(s=Math.floor(h[0]),i=h[0]-s,r[0]=(3*this.FA[s]*i+2*this.FB[s])*i+this.FC[s]),h[1]<=0?r[4]=this.FC[0]:h[1]>=t?r[4]=this.FC[t]:(s=Math.floor(h[1]),i=h[1]-s,r[4]=(3*this.FA[s]*i+2*this.FB[s])*i+this.FC[s]),h[2]<=0?r[8]=this.FC[0]:h[2]>=t?r[8]=this.FC[t]:(s=Math.floor(h[2]),i=h[2]-s,r[8]=(3*this.FA[s]*i+2*this.FB[s])*i+this.FC[s]),r},LUTRSpline.prototype.JInv=function(t){t=this.J(t);return 0!==t[0]&&0!==t[4]&&0!==t[8]&&new Float64Array([1/t[0],0,0,0,1/t[4],0,0,0,1/t[8]])},LUTRSpline.prototype.getDetails=function(){return{title:this.title,format:this.format,dims:1,s:this.FM+1,min:new Float64Array([this.fL,this.fL,this.fL]),max:new Float64Array([this.fH,this.fH,this.fH]),C:[this.FD.buffer],meta:this.meta}},LUTRSpline.prototype.getL=function(){return this.FD.buffer},LUTRSpline.prototype.getRGB=function(){return[this.FD.buffer]},LUTRSpline.prototype.getSize=function(){return this.FM+1},LUTRSpline.prototype.is1D=function(){return!0},LUTRSpline.prototype.is3D=function(){return!1},LUTRSpline.prototype.getTitle=function(){return this.title},LUTRSpline.prototype.getMetadata=function(){return this.meta},LUTRSpline.prototype.r=function(t){var i=this.RM;return(t=i*(t-this.rL)/this.rLH)<=0?t*this.RC[0]+this.RD[0]:i<=t?(t-i)*this.RC[i]+this.RD[i]:(t=t-(i=Math.floor(t)),0===this.method?((this.RA[i]*t+this.RB[i])*t+this.RC[i])*t+this.RD[i]:(1-t)*this.RD[i]+t*this.RD[i+1])},LUTRSpline.prototype.R=function(t){for(var i,s,h=new Float64Array(t),r=h.length,e=this.RM,o=0;o<r;o++)h[o]=e*(h[o]-this.rL)/this.rLH,h[o]<=0?h[o]=h[o]*this.RC[0]+this.RD[0]:h[o]>=e?h[o]=(h[o]-e)*this.RC[e]+this.RD[e]:(s=Math.floor(h[o]),i=h[o]-s,0===this.method?h[o]=((this.RA[s]*i+this.RB[s])*i+this.RC[s])*i+this.RD[s]:h[o]=(1-i)*this.RD[s]+i*this.RD[s+1])},LUTRSpline.prototype.buildReverse=function(){var t,i=this.RM+1;this.RD=new Float64Array(i);for(var s=0;s<i;s++)t=s/(i-1)*this.rLH+this.rL,0===s||t<=0||isNaN(this.RD[s-1])||this.RD[s-1]<=-65534||65534<=this.RD[s-1]?this.RD[s]=this.brent.findRoot(t,t):this.RD[s]=this.brent.findRoot(this.RD[s-1],t),this.RD[s]<-65534?this.RD[s]=-65534:65534<this.RD[s]&&(this.RD[s]=65534);if(isNaN(this.RD[0]))for(s=0;s<i;s++)if(!isNaN(this.RD[s])){this.RD[0]=this.RD[s];break}for(s=1;s<i;s++)isNaN(this.RD[s])&&(this.RD[s]=this.RD[s-1]);for(s=1;s<i;s++)this.RD[s]=this.RD[s]*this.fLH+this.fL;mono=this.RD[i-1]-this.RD[0],0<=mono?mono=1:mono<0&&(mono=-1),this.RA=new Float64Array(i),this.RB=new Float64Array(i),this.RC=new Float64Array(i);for(var h=new Float64Array(i),r=new Float64Array(i),s=0;s<i;s++)0===s?(h[0]=this.RD[1],this.RC[0]=-.5*this.RD[2]+2*this.RD[1]-1.5*this.RD[0],this.RC[0]*mono<=0&&(this.RC[0]=.0075*mono/(i-1)),r[0]=(this.RD[2]-this.RD[0])/2):s<i-1?(h[s]=this.RD[s+1],this.RC[s]=(this.RD[s+1]-this.RD[s-1])/2,s===i-2?(r[s]=.5*this.RD[s-1]-2*this.RD[s]+1.5*this.RD[s+1],r[s]*mono<=0&&(r[s]=.0075*mono/(i-1))):r[s]=(this.RD[s+2]-this.RD[s])/2):(h[s]=this.RD[s],this.RC[s]=r[s-1],r[s]=r[s-1]),this.RA[s]=2*this.RD[s]+this.RC[s]-2*h[s]+r[s],this.RB[s]=-3*this.RD[s]-2*this.RC[s]+3*h[s]-r[s]},LUTRSpline.prototype.setMethod=function(t){return"number"==typeof t&&(this.method=t,this.buildReverse(),!0)},LUTRSpline.prototype.getMethod=function(){return this.method},LUTRSpline.prototype.getReverse=function(){return this.RD.buffer},LUTRSpline.prototype.getMinMax=function(){for(var t=0,i=1,s=this.RD.length,h=0;h<s;h++)this.RD[h]>i?i=this.RD[h]:this.RD[h]<t&&(t=this.RD[h]);return{a:t,b:i}},LUTRSpline.prototype.getHighLow=function(){return{forH:this.fH,forL:this.fL,revH:this.rH,revL:this.rL}},LUTRSpline.prototype.getRM=function(){return this.RM+1},LUTRSpline.prototype.getR=function(){return this.RD.buffer},LUTQSpline.prototype.f=function(t){var i=this.FM;return(t*=i)<=0?t*this.FC[0]+this.FD[0]:i<=t?(t-i)*this.FC[i]+this.FD[i]:(t=t-(i=Math.floor(t)),((this.FA[i]*t+this.FB[i])*t+this.FC[i])*t+this.FD[i])},LUTQSpline.prototype.df=function(t){var i,s=this.FM;return(t*=s)<=0?s*this.FC[0]:s<=t?s*this.FC[s]:(t=t-(i=Math.floor(t)),s*((3*this.FA[i]*t+2*this.FB[i])*t+this.FC[i]))},LUTQSpline.prototype.fCub=function(t){var i=this.FM;return(t*=i)<=0?t*this.FC[0]+this.FD[0]:i<=t?(t-i)*this.FC[i]+this.FD[i]:(t=t-(i=Math.floor(t)),((this.FA[i]*t+this.FB[i])*t+this.FC[i])*t+this.FD[i])},LUTQSpline.prototype.fTet=function(t){var i=this.FM;return(t*=i)<=0?t*this.FC[0]+this.FD[0]:i<=t?(t-i)*this.FC[i]+this.FD[i]:(1-(t=t-(i=Math.floor(t))))*this.FD[i]+t*this.FD[i+1]},LUTQSpline.prototype.fLin=function(t){var i=this.FM;return(t*=i)<=0?t*this.FC[0]+this.FD[0]:i<=t?(t-i)*this.FC[i]+this.FD[i]:(1-(t=t-(i=Math.floor(t))))*this.FD[i]+t*this.FD[i+1]},LUTQSpline.prototype.FCub=function(t){for(var i,s,h=new Float64Array(t),r=h.length,e=this.FM,o=0;o<r;o++)h[o]*=e,h[o]<=0?h[o]=h[o]*this.FC[0]+this.FD[0]:h[o]>=e?h[o]=(h[o]-e)*this.FC[e]+this.FD[e]:(s=Math.floor(h[o]),i=h[o]-s,h[o]=((this.FA[s]*i+this.FB[s])*i+this.FC[s])*i+this.FD[s])},LUTQSpline.prototype.FTet=function(t){for(var i,s,h=new Float64Array(t),r=h.length,e=this.FM,o=0;o<r;o++)h[o]*=e,h[o]<=0?h[o]=h[o]*this.FC[0]+this.FD[0]:h[o]>=e?h[o]=(h[o]-e)*this.FC[e]+this.FD[e]:(s=Math.floor(h[o]),i=h[o]-s,h[o]=(1-i)*this.FD[s]+i*this.FD[s+1])},LUTQSpline.prototype.FLin=function(t){for(var i,s,h=new Float64Array(t),r=h.length,e=this.FM,o=0;o<r;o++)h[o]*=e,h[o]<=0?h[o]=h[o]*this.FC[0]+this.FD[0]:h[o]>=e?h[o]=(h[o]-e)*this.FC[e]+this.FD[e]:(s=Math.floor(h[o]),i=h[o]-s,h[o]=(1-i)*this.FD[s]+i*this.FD[s+1])},LUTQSpline.prototype.fRGBCub=function(t){return t=this.f(t),new Float64Array([t,t,t])},LUTQSpline.prototype.fRGBTet=function(t){return t=this.fLin(t),new Float64Array([t,t,t])},LUTQSpline.prototype.fRGBLin=function(t){return t=this.fLin(t),new Float64Array([t,t,t])},LUTQSpline.prototype.rgbCub=function(t){t=new Float64Array(t.buffer.slice(0));return this.FCub(t.buffer),t},LUTQSpline.prototype.rgbTet=function(t){t=new Float64Array(t.buffer.slice(0));return this.FLin(t.buffer),t},LUTQSpline.prototype.rgbLin=function(t){t=new Float64Array(t.buffer.slice(0));return this.FLin(t.buffer),t},LUTQSpline.prototype.RGBCub=function(t){this.FCub(out)},LUTQSpline.prototype.RGBTet=function(t){this.FLin(out)},LUTQSpline.prototype.RGBLin=function(t){this.FLin(out)},LUTQSpline.prototype.J=function(t){if(3!==t.length)return!1;var i,s,h=new Float64Array(t.buffer.slice(0)),r=new Float64Array(9),t=this.FM;return h[0]*=t,h[1]*=t,h[2]*=t,h[0]<=0?r[0]=this.FC[0]:h[0]>=t?r[0]=this.FC[t]:(s=Math.floor(h[0]),i=h[0]-s,r[0]=(3*this.FA[s]*i+2*this.FB[s])*i+this.FC[s]),h[1]<=0?r[4]=this.FC[0]:h[1]>=t?r[4]=this.FC[t]:(s=Math.floor(h[1]),i=h[1]-s,r[4]=(3*this.FA[s]*i+2*this.FB[s])*i+this.FC[s]),h[2]<=0?r[8]=this.FC[0]:h[2]>=t?r[8]=this.FC[t]:(s=Math.floor(h[2]),i=h[2]-s,r[8]=(3*this.FA[s]*i+2*this.FB[s])*i+this.FC[s]),r[0]*=t,r[4]*=t,r[8]*=t,r},LUTQSpline.prototype.JInv=function(t){t=this.J(t);return 0!==t[0]&&0!==t[4]&&0!==t[8]&&new Float64Array([1/t[0],0,0,0,1/t[4],0,0,0,1/t[8]])},LUTQSpline.prototype.getDetails=function(){return{title:"",format:"",dims:1,s:this.FM+1,min:new Float64Array([0,0,0]),max:new Float64Array([1,1,1]),C:[this.FD.buffer],meta:this.meta}},LUTQSpline.prototype.getL=function(){return this.FD.buffer},LUTQSpline.prototype.getRGB=function(){return[this.FD.buffer]},LUTQSpline.prototype.getSize=function(){return this.FM+1},LUTQSpline.prototype.is1D=function(){return!0},LUTQSpline.prototype.is3D=function(){return!1},LUTQSpline.prototype.getTitle=function(){return""},LUTQSpline.prototype.getMetadata=function(){return this.meta},LUTQSpline.prototype.dRGB=function(t){if(3!==t.length)return!1;var i,s,h=new Float64Array(t.buffer.slice(0)),r=new Float64Array(3),t=this.FM;return h[0]*=t,h[1]*=t,h[2]*=t,h[0]<=0?r[0]=this.FC[0]:h[0]>=t?r[0]=this.FC[t]:(s=Math.floor(h[0]),i=h[0]-s,r[0]=(3*this.FA[s]*i+2*this.FB[s])*i+this.FC[s]),h[1]<=0?r[1]=this.FC[0]:h[1]>=t?r[1]=this.FC[t]:(s=Math.floor(h[1]),i=h[1]-s,r[1]=(3*this.FA[s]*i+2*this.FB[s])*i+this.FC[s]),h[2]<=0?r[2]=this.FC[0]:h[2]>=t?r[2]=this.FC[t]:(s=Math.floor(h[2]),i=h[2]-s,r[2]=(3*this.FA[s]*i+2*this.FB[s])*i+this.FC[s]),r[0]*=t,r[1]*=t,r[2]*=t,r},LUTRGBSpline.prototype.buildMesh=function(){for(var t,i,s,h,r=0;r<3;r++){t=this.FD[r].length,0<=(i=this.FD[r][t-1]-this.FD[r][0])?i=1:i<0&&(i=-1),s=new Float64Array(t),h=new Float64Array(t);for(var e=0;e<t;e++)0===e?(s[0]=this.FD[r][1],this.FC[r][0]=-.5*this.FD[r][2]+2*this.FD[r][1]-1.5*this.FD[r][0],this.FC[r][0]*i<=0&&(this.FC[r][0]=.0075*i/(t-1)),h[0]=(this.FD[r][2]-this.FD[r][0])/2):e<t-1?(s[e]=this.FD[r][e+1],this.FC[r][e]=(this.FD[r][e+1]-this.FD[r][e-1])/2,e===t-2?(h[e]=.5*this.FD[r][e-1]-2*this.FD[r][e]+1.5*this.FD[r][e+1],h[e]*i<=0&&(h[e]=.0075*i/(t-1))):h[e]=(this.FD[r][e+2]-this.FD[r][e])/2):(s[e]=this.FD[r][e],this.FC[r][e]=h[e-1],h[e]=h[e-1]),this.FA[r][e]=2*this.FD[r][e]+this.FC[r][e]-2*s[e]+h[e],this.FB[r][e]=-3*this.FD[r][e]-2*this.FC[r][e]+3*s[e]-h[e]}},LUTRGBSpline.prototype.buildL=function(){this.fL[3]=Math.min(this.fL[0],this.fL[1],this.fL[2]),this.fH[3]=Math.max(this.fH[0],this.fH[1],this.fH[2]),this.fLH[3]=this.fH[3]-this.fL[3],this.FM[3]=Math.max(this.FM[0],this.FM[1],this.FM[2]),this.FM[3]<64&&(this.FM[3]=64);var t,i,s,h,r=this.FM[3]+1;this.FD[3]=new Float64Array(r);for(var e=0;e<r;e++){t=e*this.fLH[3]/(r-1)+this.fL[3];for(var o=0;o<3;o++)s=this.FM[o],i=(t-this.fL[o])/this.fLH[o],this.sin&&(i=this.ins.f(i)),i=(i*=s)<=0?i*this.FC[o][0]+this.FD[o][0]:s<=i?(i-s)*this.FC[o][s]+this.FD[o][s]:(s=i-(h=Math.floor(i)),((this.FA[o][h]*s+this.FB[o][h])*s+this.FC[o][h])*s+this.FD[o][h]),this.FD[3][e]+=i*this.Y[o]}this.FA[3]=new Float64Array(r),this.FB[3]=new Float64Array(r),this.FC[3]=new Float64Array(r);var a,n=new Float64Array(r),u=new Float64Array(r);0<=(a=this.FD[3][r-1]-this.FD[3][0])?a=1:a<0&&(a=-1);for(e=0;e<r;e++)0===e?(n[0]=this.FD[3][1],this.FC[3][0]=-.5*this.FD[3][2]+2*this.FD[3][1]-1.5*this.FD[3][0],this.FC[3][0]*a<=0&&(this.FC[3][0]=.0075*a/(r-1)),u[0]=(this.FD[3][2]-this.FD[3][0])/2):e<r-1?(n[e]=this.FD[3][e+1],this.FC[3][e]=(this.FD[3][e+1]-this.FD[3][e-1])/2,e===r-2?(u[e]=.5*this.FD[3][e-1]-2*this.FD[3][e]+1.5*this.FD[3][e+1],u[e]*a<=0&&(u[e]=.0075*a/(r-1))):u[e]=(this.FD[3][e+2]-this.FD[3][e])/2):(n[e]=this.FD[3][e],this.FC[3][e]=u[e-1],u[e]=u[e-1]),this.FA[3][e]=2*this.FD[3][e]+this.FC[3][e]-2*n[e]+u[e],this.FB[3][e]=-3*this.FD[3][e]-2*this.FC[3][e]+3*n[e]-u[e]},LUTRGBSpline.prototype.f=function(t){var i=this.FM[3];return this.fS?t=i*(t-this.fL[3])/this.fLH[3]:t*=i,t<=0?t*this.FC[3][0]+this.FD[3][0]:i<=t?(t-i)*this.FC[3][i]+this.FD[3][i]:(t=t-(i=Math.floor(t)),((this.FA[3][i]*t+this.FB[3][i])*t+this.FC[3][i])*t+this.FD[3][i])},LUTRGBSpline.prototype.df=function(t){var i,s=this.FM[3];return this.fS?t=s*(t-this.fL[3])/this.fLH[3]:t*=s,i=t<=0?s*this.FC[3][0]:s<=t?s*this.FC[3][s]:(t=t-(i=Math.floor(t)),s*((3*this.FA[3][i]*t+2*this.FB[3][i])*t+this.FC[3][i])),this.fS&&(i/=this.fLH[3]),i},LUTRGBSpline.prototype.fCub=function(t){var i=this.FM[3];return this.fS?t=i*(t-this.fL[3])/this.fLH[3]:t*=i,t<=0?t*this.FC[3][0]+this.FD[3][0]:i<=t?(t-i)*this.FC[3][i]+this.FD[3][i]:(t=t-(i=Math.floor(t)),((this.FA[3][i]*t+this.FB[3][i])*t+this.FC[3][i])*t+this.FD[3][i])},LUTRGBSpline.prototype.fTet=function(t){var i=this.FM[3];return this.fS?t=i*(t-this.fL[3])/this.fLH[3]:t*=i,t<=0?t*this.FC[3][0]+this.FD[3][0]:i<=t?(t-i)*this.FC[3][i]+this.FD[3][i]:(1-(t=t-(i=Math.floor(t))))*this.FD[3][i]+t*this.FD[3][i+1]},LUTRGBSpline.prototype.fLin=function(t){var i=this.FM[3];return this.fS?t=i*(t-this.fL[3])/this.fLH[3]:t*=i,t<=0?t*this.FC[3][0]+this.FD[3][0]:i<=t?(t-i)*this.FC[3][i]+this.FD[3][i]:(1-(t=t-(i=Math.floor(t))))*this.FD[3][i]+t*this.FD[3][i+1]},LUTRGBSpline.prototype.FCub=function(t){var i,s,h=new Float64Array(t),r=h.length,e=this.FM[3],o=this.fL[3],a=this.fLH[3];if(this.fS)for(var n=0;n<r;n++)h[n]=(h[n]-o)/a;for(n=0;n<r;n++)h[n]*=e,h[n]<=0?h[n]=h[n]*this.FC[3][0]+this.FD[3][0]:h[n]>=e?h[n]=(h[n]-e)*this.FC[3][e]+this.FD[3][e]:(s=Math.floor(h[n]),i=h[n]-s,h[n]=((this.FA[3][s]*i+this.FB[3][s])*i+this.FC[3][s])*i+this.FD[3][s])},LUTRGBSpline.prototype.FTet=function(t){var i,s,h=new Float64Array(t),r=h.length,e=this.FM[3],o=this.fL[3],a=this.fLH[3];if(this.fS)for(var n=0;n<r;n++)h[n]=e*(h[n]-o)/a;for(n=0;n<r;n++)h[n]*=e,h[n]<=0?h[n]=h[n]*this.FC[3][0]+this.FD[3][0]:h[n]>=e?h[n]=(h[n]-e)*this.FC[3][e]+this.FD[3][e]:(s=Math.floor(h[n]),i=h[n]-s,h[n]=(1-i)*this.FD[3][s]+i*this.FD[3][s+1])},LUTRGBSpline.prototype.FLin=function(t){var i,s,h=new Float64Array(t),r=h.length,e=this.FM[3],o=this.fL[3],a=this.fLH[3];if(this.fS)for(var n=0;n<r;n++)h[n]=e*(h[n]-o)/a;for(n=0;n<r;n++)h[n]*=e,h[n]<=0?h[n]=h[n]*this.FC[3][0]+this.FD[3][0]:h[n]>=e?h[n]=(h[n]-e)*this.FC[3][e]+this.FD[3][e]:(s=Math.floor(h[n]),i=h[n]-s,h[n]=(1-i)*this.FD[3][s]+i*this.FD[3][s+1])},LUTRGBSpline.prototype.fRGBCub=function(t){var i,s,h=new Float64Array(3);this.fS&&(h[0]=(t-this.fL[0])/this.fLH[0],h[1]=(t-this.fL[1])/this.fLH[1],h[2]=(t-this.fL[2])/this.fLH[2]),this.sin&&this.ins.FCub(h.buffer);for(var r=0;r<3;r++)i=this.FM[r],h[r]*=i,h[r]<=0?h[r]=h[r]*this.FC[r][0]+this.FD[r][0]:h[r]>=i?h[r]=(h[r]-i)*this.FC[r][i]+this.FD[r][i]:(s=Math.floor(h[r]),i=h[r]-s,h[r]=((this.FA[r][s]*i+this.FB[r][s])*i+this.FC[r][s])*i+this.FD[r][s]);return h},LUTRGBSpline.prototype.fRGBTet=function(t){var i,s,h=new Float64Array(3);this.fS&&(h[0]=(t-this.fL[0])/this.fLH[0],h[1]=(t-this.fL[1])/this.fLH[1],h[2]=(t-this.fL[2])/this.fLH[2]),this.sin&&this.ins.FCub(h.buffer);for(var r=0;r<3;r++)i=this.FM[r],h[r]*=i,h[r]<=0?h[r]=h[r]*this.FC[r][0]+this.FD[r][0]:h[r]>=i?h[r]=(h[r]-i)*this.FC[r][i]+this.FD[r][i]:(s=Math.floor(h[r]),i=h[r]-s,h[j]=(1-i)*this.FD[r][s]+i*this.FD[r][s+1]);return h},LUTRGBSpline.prototype.fRGBLin=function(t){var i,s,h=new Float64Array(3);this.fS&&(h[0]=(t-this.fL[0])/this.fLH[0],h[1]=(t-this.fL[1])/this.fLH[1],h[2]=(t-this.fL[2])/this.fLH[2]),this.sin&&this.ins.FCub(h.buffer);for(var r=0;r<3;r++)i=this.FM[r],h[r]*=i,h[r]<=0?h[r]=h[r]*this.FC[r][0]+this.FD[r][0]:h[r]>=i?h[r]=(h[r]-i)*this.FC[r][i]+this.FD[r][i]:(s=Math.floor(h[r]),i=h[r]-s,h[j]=(1-i)*this.FD[r][s]+i*this.FD[r][s+1]);return h},LUTRGBSpline.prototype.rgbCub=function(t){t=new Float64Array(t.buffer.slice(0));return this.RGBCub(t.buffer),t},LUTRGBSpline.prototype.rgbTet=function(t){t=new Float64Array(t.buffer.slice(0));return this.RGBLin(t.buffer),t},LUTRGBSpline.prototype.rgbLin=function(t){t=new Float64Array(t.buffer.slice(0));return this.RGBLin(t.buffer),t},LUTRGBSpline.prototype.RGBCub=function(t){var i,s,h,r,e=new Float64Array(t),o=e.length,a=this.fL,n=this.fLH;if(this.fS)for(var u=0;u<o;u+=3)e[u]=(e[u]-a[0])/n[0],e[u+1]=(e[u+1]-a[1])/n[1],e[u+2]=(e[u+2]-a[2])/n[2];this.sin&&this.ins.FCub(t);for(var f=0;f<3;f++){i=this.FM[f];for(u=0;u<o;u+=3)e[s=u+f]*=i,e[s]<=0?e[s]=e[s]*this.FC[f][0]+this.FD[f][0]:e[s]>=i?e[s]=(e[s]-i)*this.FC[f][i]+this.FD[f][i]:(h=Math.floor(e[s]),r=e[s]-h,e[s]=((this.FA[f][h]*r+this.FB[f][h])*r+this.FC[f][h])*r+this.FD[f][h])}},LUTRGBSpline.prototype.RGBTet=function(t){var i,s,h,r=new Float64Array(t),e=r.length,o=this.fL,a=this.fLH;if(this.fS)for(var n=0;n<e;n+=3)r[n]=(r[n]-o[0])/a[0],r[n+1]=(r[n+1]-o[1])/a[1],r[n+2]=(r[n+2]-o[2])/a[2];this.sin&&this.ins.FCub(t);for(var u=0;u<3;u++){i=this.FM[u];for(n=0;n<e;n+=3)r[h=n+u]*=i,r[h]<=0?r[h]=r[h]*this.FC[u][0]+this.FD[u][0]:r[h]>=i?r[h]=(r[h]-i)*this.FC[u][i]+this.FD[u][i]:(s=Math.floor(r[h]),h=r[h]-s,r[n]=(1-h)*this.FD[u][s]+h*this.FD[u][s+1])}},LUTRGBSpline.prototype.RGBLin=function(t){var i,s,h,r=new Float64Array(t),e=r.length,o=this.fL,a=this.fLH;if(this.fS)for(var n=0;n<e;n+=3)r[n]=(r[n]-o[0])/a[0],r[n+1]=(r[n+1]-o[1])/a[1],r[n+2]=(r[n+2]-o[2])/a[2];this.sin&&this.ins.FCub(t);for(var u=0;u<3;u++){i=this.FM[u];for(n=0;n<e;n+=3)r[h=n+u]*=i,r[h]<=0?r[h]=r[h]*this.FC[u][0]+this.FD[u][0]:r[h]>=i?r[h]=(r[h]-i)*this.FC[u][i]+this.FD[u][i]:(s=Math.floor(r[h]),h=r[h]-s,r[n]=(1-h)*this.FD[u][s]+h*this.FD[u][s+1])}},LUTRGBSpline.prototype.J=function(t){if(3!==t.length)return!1;var i,s,h,r=new Float64Array(t.buffer.slice(0)),e=new Float64Array(9);return this.fS&&(r[0]=(r[0]-this.fL[0])/this.fLH[0],r[1]=(r[1]-this.fL[1])/this.fLH[1],r[2]=(r[2]-this.fL[2])/this.fLH[2]),this.sin&&(r[0]=this.ins.f(r[0]),r[1]=this.ins.f(r[1]),r[2]=this.ins.f(r[2])),i=this.FM[0],r[0]*=i,r[0]<=0?e[0]=this.FC[0][0]:r[0]>=i?e[0]=this.FC[0][i]:(h=Math.floor(r[0]),s=r[0]-h,e[0]=(3*this.FA[0][h]*s+2*this.FB[0][h])*s+this.FC[0][h]),i=this.FM[1],r[1]*=i,r[1]<=0?e[4]=this.FC[1][0]:r[1]>=i?e[4]=this.FC[1][i]:(h=Math.floor(r[1]),s=r[1]-h,e[4]=(3*this.FA[1][h]*s+2*this.FB[1][h])*s+this.FC[1][h]),i=this.FM[2],r[2]*=i,r[2]<=0?e[8]=this.FC[2][0]:r[2]>=i?e[8]=this.FC[2][i]:(h=Math.floor(r[2]),s=r[2]-h,e[8]=(3*this.FA[2][h]*s+2*this.FB[2][h])*s+this.FC[2][h]),e[0]*=i,e[1]*=i,e[2]*=i,e[3]*=i,e[4]*=i,e[5]*=i,e[6]*=i,e[7]*=i,e[8]*=i,this.sin&&(t=this.ins.dRGB(t.buffer),e[0]*=t[0],e[1]*=t[1],e[2]*=t[2],e[3]*=t[0],e[4]*=t[1],e[5]*=t[2],e[6]*=t[0],e[7]*=t[1],e[8]*=t[2]),this.fS&&(e[0]/=fLH[0],e[1]/=fLH[1],e[2]/=fLH[2],e[3]/=fLH[0],e[4]/=fLH[1],e[5]/=fLH[2],e[6]/=fLH[0],e[7]/=fLH[1],e[8]/=fLH[2]),e},LUTRGBSpline.prototype.JInv=function(t){t=this.J(t);return 0!==t[0]&&0!==t[4]&&0!==t[8]&&new Float64Array([1/t[0],0,0,0,1/t[4],0,0,0,1/t[8]])},LUTRGBSpline.prototype.getDetails=function(t){t=void 0!==t&&t?{title:this.title,format:this.format,dims:1,s:this.FM[3]+1,min:new Float64Array([this.fL[3],this.fL[3],this.fL[3]]),max:new Float64Array([this.fH[3],this.fH[3],this.fH[3]]),C:[this.FD[3].buffer],meta:this.meta}:{title:this.title,format:this.format,dims:1,s:this.FM[3]+1,min:new Float64Array([this.fL[0],this.fL[1],this.fL[2]]),max:new Float64Array([this.fH[0],this.fH[1],this.fH[2]]),C:[this.FD[0].buffer,this.FD[1].buffer,this.FD[2].buffer],meta:this.meta};return t},LUTRGBSpline.prototype.getL=function(){return this.FD[3].buffer},LUTRGBSpline.prototype.getRGB=function(){return[this.FD[0].buffer,this.FD[1].buffer,this.FD[2].buffer]},LUTRGBSpline.prototype.getSize=function(){return this.FM[3]+1},LUTRGBSpline.prototype.is1D=function(){return!0},LUTRGBSpline.prototype.is3D=function(){return!1},LUTRGBSpline.prototype.getTitle=function(){return this.title},LUTRGBSpline.prototype.getMetadata=function(){return this.meta},LUTRGBSpline.prototype.isClamped=function(){var t,i;return void 0===this.clamped&&(i=this.minMax(),t=Math.min(i[0],i[1],i[2]),i=Math.max(i[3],i[4],i[5]),this.clamped=0===t&&i<=1||0<=t&&1===i),this.clamped},LUTRGBSpline.prototype.deClamp=function(){if(this.isClamped()){for(var t,i,s,h,r,e=0;e<3;e++){s=!1,n=(t=(i=this.FD[e]).length)-1;for(var o=u=0;o<t;o++)0<o&&0===i[o]&&(s=!0,u=o+1);for(var a,n,u,o=t-2;0<=o;o--)1===i[o]&&(s=!0,n=o-1);if(s){n<u&&(a=n,n=Math.min(u-2,t-1),u=Math.max(a+2,0)),h=n-u,r=new LUTQSpline(new Float64Array(i.subarray(u,1+h)).buffer),a=this.fL[e],this.fH[e];for(o=0;o<t;o++)o===u&&(o=n),i[o]=r.fCub((o-u)/h)}}this.buildMesh(),this.buildL(),this.clamped=!1}},LUTRGBSpline.prototype.getColourSpace=function(){this.d;var t=this.fL,i=this.fH,s=(this.fLH,{title:this.title+"CS",format:this.format,fLR:t[0],fLG:t[1],fLB:t[2],fHR:i[0],fHG:i[1],fHB:i[2]}),i=new LUTRSpline({buff:this.L.getL(),fH:i[3],fL:t[3]}),t=this.getRGB();return i.R(t[0]),i.R(t[1]),i.R(t[2]),s.buffR=t[0],s.buffG=t[1],s.buffB=t[2],new LUTRGBSpline(s)},LUTRGBSpline.prototype.compare=function(t,i,s){var h=new Float64Array(t.slice(0)),r=new Float64Array(i.slice(0)),e=h.length;if(e!==r.length)return!1;void 0!==s?"1"===(s=s.toString().toLowerCase())||"tet"===s?this.RGBTet(r.buffer):"2"===s||"lin"===s?this.RGBLin(r.buffer):this.RGBCub(r.buffer):this.RGBCub(r.buffer);for(var o=new Float64Array(3),a=0;a<e;a+=3)o[0]+=Math.pow(r[a]-h[a],2),o[1]+=Math.pow(r[a+1]-h[a+1],2),o[2]+=Math.pow(r[a+2]-h[a+2],2);return o[0]=Math.pow(3*o[0]/e,.5),o[1]=Math.pow(3*o[1]/e,.5),o[2]=Math.pow(3*o[2]/e,.5),o},LUTRGBSpline.prototype.minMax=function(){for(var t,i,s=new Float64Array([9999,9999,9999,-9999,-9999,-9999]),h=0;h<3;h++){i=(t=this.FD[h]).length;for(var r=0;r<i;r++)t[r]<s[h]&&(s[h]=t[r]),t[r]>s[h+3]&&(s[h+3]=t[r])}return s},LUTVolume.prototype.buildMesh=function(t,i,s){var h=new Float64Array(t),r=new Float64Array(i),e=new Float64Array(s);new Float64Array([.2126,.7152,.0722]);this.d=Math.round(Math.pow(h.length,1/3));var o=this.d;this.s=o-1;h.length;var a=o+2,n=(this.nd=a)*a,s=n*a,u=s,f=2*u;this.mesh=new Float64Array(3*s);var l=n+a+1,p=0;this.off=new Float64Array(64);for(var c=0;c<4;c++)for(var m=0;m<4;m++)for(var y=0;y<4;y++)this.off[y+4*m+16*c]=y+m*a+c*n;for(c=0;c<o;c++){for(m=0;m<o;m++){for(y=0;y<o;y++)this.mesh[l]=h[p],this.mesh[l+u]=r[p],this.mesh[l+f]=e[p],p++,l++;l+=2}l+=2*a}this.fillEdges(),this.rgb=new Float64Array(18),this.R=new Float64Array(8),this.G=new Float64Array(8),this.B=new Float64Array(8)},LUTVolume.prototype.buildL=function(){var t=this.fL[3],i=this.fH[3],s=i-t,h=this.getSize();h<65&&(h=65);for(var r,e=new Float64Array(h),o=new Float64Array(3*h),a=o.length,n=0;n<h;n++)o[r=3*n]=n*s/(h-1)+t,o[r+1]=o[r],o[r+2]=o[r];if(this.fS)for(n=0;n<a;n+=3)o[n]=(o[n]-this.fL[0])/this.fLH[0],o[n+1]=(o[n+1]-this.fL[1])/this.fLH[1],o[n+2]=(o[n+2]-this.fL[2])/this.fLH[2];this.sin&&this.ins.FCub(o.buffer),this.RGBCub(o.buffer);for(n=0;n<h;n++)r=3*n,e[n]=o[r]*this.Y[0]+o[r+1]*this.Y[1]+o[r+2]*this.Y[2];this.L=new LUTSpline({buff:e.buffer,fH:i,fL:t})},LUTVolume.prototype.f=function(t){return this.L.f(t)},LUTVolume.prototype.df=function(t){return this.L.df(t)},LUTVolume.prototype.fCub=function(t){return this.L.fCub(t)},LUTVolume.prototype.fTet=function(t){return this.L.fLin(t)},LUTVolume.prototype.fLin=function(t){return this.L.fLin(t)},LUTVolume.prototype.FCub=function(t){this.L.FCub(t)},LUTVolume.prototype.FTet=function(t){this.L.FLin(t)},LUTVolume.prototype.FLin=function(t){this.L.FLin(t)},LUTVolume.prototype.fRGBCub=function(t){t=new Float64Array([t,t,t]);return this.RGBCub(t.buffer),t},LUTVolume.prototype.fRGBTet=function(t){t=new Float64Array([t,t,t]);return this.RGBTet(t.buffer),t},LUTVolume.prototype.fRGBLin=function(t){t=new Float64Array([t,t,t]);return this.RGBLin(t.buffer),t},LUTVolume.prototype.rgbCub=function(t){t=new Float64Array(t.buffer.slice(0));return this.RGBCub(t.buffer),t},LUTVolume.prototype.rgbTet=function(t){t=new Float64Array(t.buffer.slice(0));return this.RGBTet(t.buffer),t},LUTVolume.prototype.rgbLin=function(t){t=new Float64Array(t.buffer.slice(0));return this.RGBLin(t.buffer),t},LUTVolume.prototype.RGBCub=function(t){var i,s,h=new Float64Array(t),r=this.mesh,e=this.off,o=this.rgb,a=h.length,n=Math.round(this.mesh.length/3),u=this.s,f=u+2+1,l=this.R,p=this.G,c=this.B,m=!1,y=!1,F=!1,L=!1;if(this.fS)for(var C=this.fL,S=this.fLH,d=0;d<a;d+=3)h[d]=(h[d]-C[0])/S[0],h[d+1]=(h[d+1]-C[1])/S[1],h[d+2]=(h[d+2]-C[2])/S[2];this.sin&&this.ins.FCub(t);for(d=0;d<a;d+=3)h[d]*=u,h[d+1]*=u,h[d+2]*=u,o[9]=Math.max(0,Math.min(u-1,Math.floor(h[d]))),o[10]=Math.max(0,Math.min(u-1,Math.floor(h[d+1]))),o[11]=Math.max(0,Math.min(u-1,Math.floor(h[d+2]))),h[d]-=o[9],h[d+1]-=o[10],h[d+2]-=o[11],o[0]=Math.max(0,Math.min(1,h[d])),o[1]=Math.max(0,Math.min(1,h[d+1])),o[2]=Math.max(0,Math.min(1,h[d+2])),o[0]!==h[d]&&(m=y=!0),o[1]!==h[d+1]&&(m=F=!0),o[2]!==h[d+2]&&(m=L=!0),o[3]=o[0]*o[0],o[4]=o[1]*o[1],o[5]=o[2]*o[2],o[6]=o[3]*o[0],o[7]=o[4]*o[1],o[8]=o[5]*o[2],l[0]=-.5*o[6]+o[3]-.5*o[0],l[1]=1.5*o[6]-2.5*o[3]+1,l[2]=-1.5*o[6]+2*o[3]+.5*o[0],l[3]=.5*o[6]-.5*o[3],p[0]=-.5*o[7]+o[4]-.5*o[1],p[1]=1.5*o[7]-2.5*o[4]+1,p[2]=-1.5*o[7]+2*o[4]+.5*o[1],p[3]=.5*o[7]-.5*o[4],c[0]=-.5*o[8]+o[5]-.5*o[2],c[1]=1.5*o[8]-2.5*o[5]+1,c[2]=-1.5*o[8]+2*o[5]+.5*o[2],c[3]=.5*o[8]-.5*o[5],y&&(o[12]=h[d]-o[0]),F&&(o[13]=h[d+1]-o[1]),L&&(o[14]=h[d+2]-o[2]),i=s=o[9]+(o[10]+o[11]*f)*f,h[d]=((l[0]*r[i+e[0]]+l[1]*r[i+e[1]]+l[2]*r[i+e[2]]+l[3]*r[i+e[3]])*p[0]+(l[0]*r[i+e[4]]+l[1]*r[i+e[5]]+l[2]*r[i+e[6]]+l[3]*r[i+e[7]])*p[1]+(l[0]*r[i+e[8]]+l[1]*r[i+e[9]]+l[2]*r[i+e[10]]+l[3]*r[i+e[11]])*p[2]+(l[0]*r[i+e[12]]+l[1]*r[i+e[13]]+l[2]*r[i+e[14]]+l[3]*r[i+e[15]])*p[3])*c[0]+((l[0]*r[i+e[16]]+l[1]*r[i+e[17]]+l[2]*r[i+e[18]]+l[3]*r[i+e[19]])*p[0]+(l[0]*r[i+e[20]]+l[1]*r[i+e[21]]+l[2]*r[i+e[22]]+l[3]*r[i+e[23]])*p[1]+(l[0]*r[i+e[24]]+l[1]*r[i+e[25]]+l[2]*r[i+e[26]]+l[3]*r[i+e[27]])*p[2]+(l[0]*r[i+e[28]]+l[1]*r[i+e[29]]+l[2]*r[i+e[30]]+l[3]*r[i+e[31]])*p[3])*c[1]+((l[0]*r[i+e[32]]+l[1]*r[i+e[33]]+l[2]*r[i+e[34]]+l[3]*r[i+e[35]])*p[0]+(l[0]*r[i+e[36]]+l[1]*r[i+e[37]]+l[2]*r[i+e[38]]+l[3]*r[i+e[39]])*p[1]+(l[0]*r[i+e[40]]+l[1]*r[i+e[41]]+l[2]*r[i+e[42]]+l[3]*r[i+e[43]])*p[2]+(l[0]*r[i+e[44]]+l[1]*r[i+e[45]]+l[2]*r[i+e[46]]+l[3]*r[i+e[47]])*p[3])*c[2]+((l[0]*r[i+e[48]]+l[1]*r[i+e[49]]+l[2]*r[i+e[50]]+l[3]*r[i+e[51]])*p[0]+(l[0]*r[i+e[52]]+l[1]*r[i+e[53]]+l[2]*r[i+e[54]]+l[3]*r[i+e[55]])*p[1]+(l[0]*r[i+e[56]]+l[1]*r[i+e[57]]+l[2]*r[i+e[58]]+l[3]*r[i+e[59]])*p[2]+(l[0]*r[i+e[60]]+l[1]*r[i+e[61]]+l[2]*r[i+e[62]]+l[3]*r[i+e[63]])*p[3])*c[3],i+=n,h[d+1]=((l[0]*r[i+e[0]]+l[1]*r[i+e[1]]+l[2]*r[i+e[2]]+l[3]*r[i+e[3]])*p[0]+(l[0]*r[i+e[4]]+l[1]*r[i+e[5]]+l[2]*r[i+e[6]]+l[3]*r[i+e[7]])*p[1]+(l[0]*r[i+e[8]]+l[1]*r[i+e[9]]+l[2]*r[i+e[10]]+l[3]*r[i+e[11]])*p[2]+(l[0]*r[i+e[12]]+l[1]*r[i+e[13]]+l[2]*r[i+e[14]]+l[3]*r[i+e[15]])*p[3])*c[0]+((l[0]*r[i+e[16]]+l[1]*r[i+e[17]]+l[2]*r[i+e[18]]+l[3]*r[i+e[19]])*p[0]+(l[0]*r[i+e[20]]+l[1]*r[i+e[21]]+l[2]*r[i+e[22]]+l[3]*r[i+e[23]])*p[1]+(l[0]*r[i+e[24]]+l[1]*r[i+e[25]]+l[2]*r[i+e[26]]+l[3]*r[i+e[27]])*p[2]+(l[0]*r[i+e[28]]+l[1]*r[i+e[29]]+l[2]*r[i+e[30]]+l[3]*r[i+e[31]])*p[3])*c[1]+((l[0]*r[i+e[32]]+l[1]*r[i+e[33]]+l[2]*r[i+e[34]]+l[3]*r[i+e[35]])*p[0]+(l[0]*r[i+e[36]]+l[1]*r[i+e[37]]+l[2]*r[i+e[38]]+l[3]*r[i+e[39]])*p[1]+(l[0]*r[i+e[40]]+l[1]*r[i+e[41]]+l[2]*r[i+e[42]]+l[3]*r[i+e[43]])*p[2]+(l[0]*r[i+e[44]]+l[1]*r[i+e[45]]+l[2]*r[i+e[46]]+l[3]*r[i+e[47]])*p[3])*c[2]+((l[0]*r[i+e[48]]+l[1]*r[i+e[49]]+l[2]*r[i+e[50]]+l[3]*r[i+e[51]])*p[0]+(l[0]*r[i+e[52]]+l[1]*r[i+e[53]]+l[2]*r[i+e[54]]+l[3]*r[i+e[55]])*p[1]+(l[0]*r[i+e[56]]+l[1]*r[i+e[57]]+l[2]*r[i+e[58]]+l[3]*r[i+e[59]])*p[2]+(l[0]*r[i+e[60]]+l[1]*r[i+e[61]]+l[2]*r[i+e[62]]+l[3]*r[i+e[63]])*p[3])*c[3],i+=n,h[d+2]=((l[0]*r[i+e[0]]+l[1]*r[i+e[1]]+l[2]*r[i+e[2]]+l[3]*r[i+e[3]])*p[0]+(l[0]*r[i+e[4]]+l[1]*r[i+e[5]]+l[2]*r[i+e[6]]+l[3]*r[i+e[7]])*p[1]+(l[0]*r[i+e[8]]+l[1]*r[i+e[9]]+l[2]*r[i+e[10]]+l[3]*r[i+e[11]])*p[2]+(l[0]*r[i+e[12]]+l[1]*r[i+e[13]]+l[2]*r[i+e[14]]+l[3]*r[i+e[15]])*p[3])*c[0]+((l[0]*r[i+e[16]]+l[1]*r[i+e[17]]+l[2]*r[i+e[18]]+l[3]*r[i+e[19]])*p[0]+(l[0]*r[i+e[20]]+l[1]*r[i+e[21]]+l[2]*r[i+e[22]]+l[3]*r[i+e[23]])*p[1]+(l[0]*r[i+e[24]]+l[1]*r[i+e[25]]+l[2]*r[i+e[26]]+l[3]*r[i+e[27]])*p[2]+(l[0]*r[i+e[28]]+l[1]*r[i+e[29]]+l[2]*r[i+e[30]]+l[3]*r[i+e[31]])*p[3])*c[1]+((l[0]*r[i+e[32]]+l[1]*r[i+e[33]]+l[2]*r[i+e[34]]+l[3]*r[i+e[35]])*p[0]+(l[0]*r[i+e[36]]+l[1]*r[i+e[37]]+l[2]*r[i+e[38]]+l[3]*r[i+e[39]])*p[1]+(l[0]*r[i+e[40]]+l[1]*r[i+e[41]]+l[2]*r[i+e[42]]+l[3]*r[i+e[43]])*p[2]+(l[0]*r[i+e[44]]+l[1]*r[i+e[45]]+l[2]*r[i+e[46]]+l[3]*r[i+e[47]])*p[3])*c[2]+((l[0]*r[i+e[48]]+l[1]*r[i+e[49]]+l[2]*r[i+e[50]]+l[3]*r[i+e[51]])*p[0]+(l[0]*r[i+e[52]]+l[1]*r[i+e[53]]+l[2]*r[i+e[54]]+l[3]*r[i+e[55]])*p[1]+(l[0]*r[i+e[56]]+l[1]*r[i+e[57]]+l[2]*r[i+e[58]]+l[3]*r[i+e[59]])*p[2]+(l[0]*r[i+e[60]]+l[1]*r[i+e[61]]+l[2]*r[i+e[62]]+l[3]*r[i+e[63]])*p[3])*c[3],m&&(y&&(l[4]=-1.5*o[3]+2*o[0]-.5,l[5]=4.5*o[3]-5*o[0],l[6]=-4.5*o[3]+4*o[0]+.5,l[7]=1.5*o[3]-o[0],i=s,o[15]=((l[4]*r[i+e[0]]+l[5]*r[i+e[1]]+l[6]*r[i+e[2]]+l[7]*r[i+e[3]])*p[0]+(l[4]*r[i+e[4]]+l[5]*r[i+e[5]]+l[6]*r[i+e[6]]+l[7]*r[i+e[7]])*p[1]+(l[4]*r[i+e[8]]+l[5]*r[i+e[9]]+l[6]*r[i+e[10]]+l[7]*r[i+e[11]])*p[2]+(l[4]*r[i+e[12]]+l[5]*r[i+e[13]]+l[6]*r[i+e[14]]+l[7]*r[i+e[15]])*p[3])*c[0]+((l[4]*r[i+e[16]]+l[5]*r[i+e[17]]+l[6]*r[i+e[18]]+l[7]*r[i+e[19]])*p[0]+(l[4]*r[i+e[20]]+l[5]*r[i+e[21]]+l[6]*r[i+e[22]]+l[7]*r[i+e[23]])*p[1]+(l[4]*r[i+e[24]]+l[5]*r[i+e[25]]+l[6]*r[i+e[26]]+l[7]*r[i+e[27]])*p[2]+(l[4]*r[i+e[28]]+l[5]*r[i+e[29]]+l[6]*r[i+e[30]]+l[7]*r[i+e[31]])*p[3])*c[1]+((l[4]*r[i+e[32]]+l[5]*r[i+e[33]]+l[6]*r[i+e[34]]+l[7]*r[i+e[35]])*p[0]+(l[4]*r[i+e[36]]+l[5]*r[i+e[37]]+l[6]*r[i+e[38]]+l[7]*r[i+e[39]])*p[1]+(l[4]*r[i+e[40]]+l[5]*r[i+e[41]]+l[6]*r[i+e[42]]+l[7]*r[i+e[43]])*p[2]+(l[4]*r[i+e[44]]+l[5]*r[i+e[45]]+l[6]*r[i+e[46]]+l[7]*r[i+e[47]])*p[3])*c[2]+((l[4]*r[i+e[48]]+l[5]*r[i+e[49]]+l[6]*r[i+e[50]]+l[7]*r[i+e[51]])*p[0]+(l[4]*r[i+e[52]]+l[5]*r[i+e[53]]+l[6]*r[i+e[54]]+l[7]*r[i+e[55]])*p[1]+(l[4]*r[i+e[56]]+l[5]*r[i+e[57]]+l[6]*r[i+e[58]]+l[7]*r[i+e[59]])*p[2]+(l[4]*r[i+e[60]]+l[5]*r[i+e[61]]+l[6]*r[i+e[62]]+l[7]*r[i+e[63]])*p[3])*c[3],i+=n,o[16]=((l[4]*r[i+e[0]]+l[5]*r[i+e[1]]+l[6]*r[i+e[2]]+l[7]*r[i+e[3]])*p[0]+(l[4]*r[i+e[4]]+l[5]*r[i+e[5]]+l[6]*r[i+e[6]]+l[7]*r[i+e[7]])*p[1]+(l[4]*r[i+e[8]]+l[5]*r[i+e[9]]+l[6]*r[i+e[10]]+l[7]*r[i+e[11]])*p[2]+(l[4]*r[i+e[12]]+l[5]*r[i+e[13]]+l[6]*r[i+e[14]]+l[7]*r[i+e[15]])*p[3])*c[0]+((l[4]*r[i+e[16]]+l[5]*r[i+e[17]]+l[6]*r[i+e[18]]+l[7]*r[i+e[19]])*p[0]+(l[4]*r[i+e[20]]+l[5]*r[i+e[21]]+l[6]*r[i+e[22]]+l[7]*r[i+e[23]])*p[1]+(l[4]*r[i+e[24]]+l[5]*r[i+e[25]]+l[6]*r[i+e[26]]+l[7]*r[i+e[27]])*p[2]+(l[4]*r[i+e[28]]+l[5]*r[i+e[29]]+l[6]*r[i+e[30]]+l[7]*r[i+e[31]])*p[3])*c[1]+((l[4]*r[i+e[32]]+l[5]*r[i+e[33]]+l[6]*r[i+e[34]]+l[7]*r[i+e[35]])*p[0]+(l[4]*r[i+e[36]]+l[5]*r[i+e[37]]+l[6]*r[i+e[38]]+l[7]*r[i+e[39]])*p[1]+(l[4]*r[i+e[40]]+l[5]*r[i+e[41]]+l[6]*r[i+e[42]]+l[7]*r[i+e[43]])*p[2]+(l[4]*r[i+e[44]]+l[5]*r[i+e[45]]+l[6]*r[i+e[46]]+l[7]*r[i+e[47]])*p[3])*c[2]+((l[4]*r[i+e[48]]+l[5]*r[i+e[49]]+l[6]*r[i+e[50]]+l[7]*r[i+e[51]])*p[0]+(l[4]*r[i+e[52]]+l[5]*r[i+e[53]]+l[6]*r[i+e[54]]+l[7]*r[i+e[55]])*p[1]+(l[4]*r[i+e[56]]+l[5]*r[i+e[57]]+l[6]*r[i+e[58]]+l[7]*r[i+e[59]])*p[2]+(l[4]*r[i+e[60]]+l[5]*r[i+e[61]]+l[6]*r[i+e[62]]+l[7]*r[i+e[63]])*p[3])*c[3],i+=n,o[27]=((l[4]*r[i+e[0]]+l[5]*r[i+e[1]]+l[6]*r[i+e[2]]+l[7]*r[i+e[3]])*p[0]+(l[4]*r[i+e[4]]+l[5]*r[i+e[5]]+l[6]*r[i+e[6]]+l[7]*r[i+e[7]])*p[1]+(l[4]*r[i+e[8]]+l[5]*r[i+e[9]]+l[6]*r[i+e[10]]+l[7]*r[i+e[11]])*p[2]+(l[4]*r[i+e[12]]+l[5]*r[i+e[13]]+l[6]*r[i+e[14]]+l[7]*r[i+e[15]])*p[3])*c[0]+((l[4]*r[i+e[16]]+l[5]*r[i+e[17]]+l[6]*r[i+e[18]]+l[7]*r[i+e[19]])*p[0]+(l[4]*r[i+e[20]]+l[5]*r[i+e[21]]+l[6]*r[i+e[22]]+l[7]*r[i+e[23]])*p[1]+(l[4]*r[i+e[24]]+l[5]*r[i+e[25]]+l[6]*r[i+e[26]]+l[7]*r[i+e[27]])*p[2]+(l[4]*r[i+e[28]]+l[5]*r[i+e[29]]+l[6]*r[i+e[30]]+l[7]*r[i+e[31]])*p[3])*c[1]+((l[4]*r[i+e[32]]+l[5]*r[i+e[33]]+l[6]*r[i+e[34]]+l[7]*r[i+e[35]])*p[0]+(l[4]*r[i+e[36]]+l[5]*r[i+e[37]]+l[6]*r[i+e[38]]+l[7]*r[i+e[39]])*p[1]+(l[4]*r[i+e[40]]+l[5]*r[i+e[41]]+l[6]*r[i+e[42]]+l[7]*r[i+e[43]])*p[2]+(l[4]*r[i+e[44]]+l[5]*r[i+e[45]]+l[6]*r[i+e[46]]+l[7]*r[i+e[47]])*p[3])*c[2]+((l[4]*r[i+e[48]]+l[5]*r[i+e[49]]+l[6]*r[i+e[50]]+l[7]*r[i+e[51]])*p[0]+(l[4]*r[i+e[52]]+l[5]*r[i+e[53]]+l[6]*r[i+e[54]]+l[7]*r[i+e[55]])*p[1]+(l[4]*r[i+e[56]]+l[5]*r[i+e[57]]+l[6]*r[i+e[58]]+l[7]*r[i+e[59]])*p[2]+(l[4]*r[i+e[60]]+l[5]*r[i+e[61]]+l[6]*r[i+e[62]]+l[7]*r[i+e[63]])*p[3])*c[3],h[d]+=o[12]*o[15],h[d+1]+=o[12]*o[16],h[d+2]+=o[12]*o[17]),F&&(p[4]=-1.5*o[4]+2*o[1]-.5,p[5]=4.5*o[4]-5*o[1],p[6]=-4.5*o[4]+4*o[1]+.5,p[7]=1.5*o[4]-o[1],i=s,o[15]=((l[0]*r[i+e[0]]+l[1]*r[i+e[1]]+l[2]*r[i+e[2]]+l[3]*r[i+e[3]])*p[4]+(l[0]*r[i+e[4]]+l[1]*r[i+e[5]]+l[2]*r[i+e[6]]+l[3]*r[i+e[7]])*p[5]+(l[0]*r[i+e[8]]+l[1]*r[i+e[9]]+l[2]*r[i+e[10]]+l[3]*r[i+e[11]])*p[6]+(l[0]*r[i+e[12]]+l[1]*r[i+e[13]]+l[2]*r[i+e[14]]+l[3]*r[i+e[15]])*p[7])*c[0]+((l[0]*r[i+e[16]]+l[1]*r[i+e[17]]+l[2]*r[i+e[18]]+l[3]*r[i+e[19]])*p[4]+(l[0]*r[i+e[20]]+l[1]*r[i+e[21]]+l[2]*r[i+e[22]]+l[3]*r[i+e[23]])*p[5]+(l[0]*r[i+e[24]]+l[1]*r[i+e[25]]+l[2]*r[i+e[26]]+l[3]*r[i+e[27]])*p[6]+(l[0]*r[i+e[28]]+l[1]*r[i+e[29]]+l[2]*r[i+e[30]]+l[3]*r[i+e[31]])*p[7])*c[1]+((l[0]*r[i+e[32]]+l[1]*r[i+e[33]]+l[2]*r[i+e[34]]+l[3]*r[i+e[35]])*p[4]+(l[0]*r[i+e[36]]+l[1]*r[i+e[37]]+l[2]*r[i+e[38]]+l[3]*r[i+e[39]])*p[5]+(l[0]*r[i+e[40]]+l[1]*r[i+e[41]]+l[2]*r[i+e[42]]+l[3]*r[i+e[43]])*p[6]+(l[0]*r[i+e[44]]+l[1]*r[i+e[45]]+l[2]*r[i+e[46]]+l[3]*r[i+e[47]])*p[7])*c[2]+((l[0]*r[i+e[48]]+l[1]*r[i+e[49]]+l[2]*r[i+e[50]]+l[3]*r[i+e[51]])*p[4]+(l[0]*r[i+e[52]]+l[1]*r[i+e[53]]+l[2]*r[i+e[54]]+l[3]*r[i+e[55]])*p[5]+(l[0]*r[i+e[56]]+l[1]*r[i+e[57]]+l[2]*r[i+e[58]]+l[3]*r[i+e[59]])*p[6]+(l[0]*r[i+e[60]]+l[1]*r[i+e[61]]+l[2]*r[i+e[62]]+l[3]*r[i+e[63]])*p[7])*c[3],i+=n,o[16]=((l[0]*r[i+e[0]]+l[1]*r[i+e[1]]+l[2]*r[i+e[2]]+l[3]*r[i+e[3]])*p[4]+(l[0]*r[i+e[4]]+l[1]*r[i+e[5]]+l[2]*r[i+e[6]]+l[3]*r[i+e[7]])*p[5]+(l[0]*r[i+e[8]]+l[1]*r[i+e[9]]+l[2]*r[i+e[10]]+l[3]*r[i+e[11]])*p[6]+(l[0]*r[i+e[12]]+l[1]*r[i+e[13]]+l[2]*r[i+e[14]]+l[3]*r[i+e[15]])*p[7])*c[0]+((l[0]*r[i+e[16]]+l[1]*r[i+e[17]]+l[2]*r[i+e[18]]+l[3]*r[i+e[19]])*p[4]+(l[0]*r[i+e[20]]+l[1]*r[i+e[21]]+l[2]*r[i+e[22]]+l[3]*r[i+e[23]])*p[5]+(l[0]*r[i+e[24]]+l[1]*r[i+e[25]]+l[2]*r[i+e[26]]+l[3]*r[i+e[27]])*p[6]+(l[0]*r[i+e[28]]+l[1]*r[i+e[29]]+l[2]*r[i+e[30]]+l[3]*r[i+e[31]])*p[7])*c[1]+((l[0]*r[i+e[32]]+l[1]*r[i+e[33]]+l[2]*r[i+e[34]]+l[3]*r[i+e[35]])*p[4]+(l[0]*r[i+e[36]]+l[1]*r[i+e[37]]+l[2]*r[i+e[38]]+l[3]*r[i+e[39]])*p[5]+(l[0]*r[i+e[40]]+l[1]*r[i+e[41]]+l[2]*r[i+e[42]]+l[3]*r[i+e[43]])*p[6]+(l[0]*r[i+e[44]]+l[1]*r[i+e[45]]+l[2]*r[i+e[46]]+l[3]*r[i+e[47]])*p[7])*c[2]+((l[0]*r[i+e[48]]+l[1]*r[i+e[49]]+l[2]*r[i+e[50]]+l[3]*r[i+e[51]])*p[4]+(l[0]*r[i+e[52]]+l[1]*r[i+e[53]]+l[2]*r[i+e[54]]+l[3]*r[i+e[55]])*p[5]+(l[0]*r[i+e[56]]+l[1]*r[i+e[57]]+l[2]*r[i+e[58]]+l[3]*r[i+e[59]])*p[6]+(l[0]*r[i+e[60]]+l[1]*r[i+e[61]]+l[2]*r[i+e[62]]+l[3]*r[i+e[63]])*p[7])*c[3],i+=n,o[17]=((l[0]*r[i+e[0]]+l[1]*r[i+e[1]]+l[2]*r[i+e[2]]+l[3]*r[i+e[3]])*p[4]+(l[0]*r[i+e[4]]+l[1]*r[i+e[5]]+l[2]*r[i+e[6]]+l[3]*r[i+e[7]])*p[5]+(l[0]*r[i+e[8]]+l[1]*r[i+e[9]]+l[2]*r[i+e[10]]+l[3]*r[i+e[11]])*p[6]+(l[0]*r[i+e[12]]+l[1]*r[i+e[13]]+l[2]*r[i+e[14]]+l[3]*r[i+e[15]])*p[7])*c[0]+((l[0]*r[i+e[16]]+l[1]*r[i+e[17]]+l[2]*r[i+e[18]]+l[3]*r[i+e[19]])*p[4]+(l[0]*r[i+e[20]]+l[1]*r[i+e[21]]+l[2]*r[i+e[22]]+l[3]*r[i+e[23]])*p[5]+(l[0]*r[i+e[24]]+l[1]*r[i+e[25]]+l[2]*r[i+e[26]]+l[3]*r[i+e[27]])*p[6]+(l[0]*r[i+e[28]]+l[1]*r[i+e[29]]+l[2]*r[i+e[30]]+l[3]*r[i+e[31]])*p[7])*c[1]+((l[0]*r[i+e[32]]+l[1]*r[i+e[33]]+l[2]*r[i+e[34]]+l[3]*r[i+e[35]])*p[4]+(l[0]*r[i+e[36]]+l[1]*r[i+e[37]]+l[2]*r[i+e[38]]+l[3]*r[i+e[39]])*p[5]+(l[0]*r[i+e[40]]+l[1]*r[i+e[41]]+l[2]*r[i+e[42]]+l[3]*r[i+e[43]])*p[6]+(l[0]*r[i+e[44]]+l[1]*r[i+e[45]]+l[2]*r[i+e[46]]+l[3]*r[i+e[47]])*p[7])*c[2]+((l[0]*r[i+e[48]]+l[1]*r[i+e[49]]+l[2]*r[i+e[50]]+l[3]*r[i+e[51]])*p[4]+(l[0]*r[i+e[52]]+l[1]*r[i+e[53]]+l[2]*r[i+e[54]]+l[3]*r[i+e[55]])*p[5]+(l[0]*r[i+e[56]]+l[1]*r[i+e[57]]+l[2]*r[i+e[58]]+l[3]*r[i+e[59]])*p[6]+(l[0]*r[i+e[60]]+l[1]*r[i+e[61]]+l[2]*r[i+e[62]]+l[3]*r[i+e[63]])*p[7])*c[3],h[d]+=o[13]*o[15],h[d+1]+=o[13]*o[16],h[d+2]+=o[13]*o[17]),L&&(c[4]=-1.5*o[5]+2*o[2]-.5,c[5]=4.5*o[5]-5*o[2],c[6]=-4.5*o[5]+4*o[2]+.5,c[7]=1.5*o[5]-o[2],i=s,o[15]=((l[0]*r[i+e[0]]+l[1]*r[i+e[1]]+l[2]*r[i+e[2]]+l[3]*r[i+e[3]])*p[0]+(l[0]*r[i+e[4]]+l[1]*r[i+e[5]]+l[2]*r[i+e[6]]+l[3]*r[i+e[7]])*p[1]+(l[0]*r[i+e[8]]+l[1]*r[i+e[9]]+l[2]*r[i+e[10]]+l[3]*r[i+e[11]])*p[2]+(l[0]*r[i+e[12]]+l[1]*r[i+e[13]]+l[2]*r[i+e[14]]+l[3]*r[i+e[15]])*p[3])*c[4]+((l[0]*r[i+e[16]]+l[1]*r[i+e[17]]+l[2]*r[i+e[18]]+l[3]*r[i+e[19]])*p[0]+(l[0]*r[i+e[20]]+l[1]*r[i+e[21]]+l[2]*r[i+e[22]]+l[3]*r[i+e[23]])*p[1]+(l[0]*r[i+e[24]]+l[1]*r[i+e[25]]+l[2]*r[i+e[26]]+l[3]*r[i+e[27]])*p[2]+(l[0]*r[i+e[28]]+l[1]*r[i+e[29]]+l[2]*r[i+e[30]]+l[3]*r[i+e[31]])*p[3])*c[5]+((l[0]*r[i+e[32]]+l[1]*r[i+e[33]]+l[2]*r[i+e[34]]+l[3]*r[i+e[35]])*p[0]+(l[0]*r[i+e[36]]+l[1]*r[i+e[37]]+l[2]*r[i+e[38]]+l[3]*r[i+e[39]])*p[1]+(l[0]*r[i+e[40]]+l[1]*r[i+e[41]]+l[2]*r[i+e[42]]+l[3]*r[i+e[43]])*p[2]+(l[0]*r[i+e[44]]+l[1]*r[i+e[45]]+l[2]*r[i+e[46]]+l[3]*r[i+e[47]])*p[3])*c[6]+((l[0]*r[i+e[48]]+l[1]*r[i+e[49]]+l[2]*r[i+e[50]]+l[3]*r[i+e[51]])*p[0]+(l[0]*r[i+e[52]]+l[1]*r[i+e[53]]+l[2]*r[i+e[54]]+l[3]*r[i+e[55]])*p[1]+(l[0]*r[i+e[56]]+l[1]*r[i+e[57]]+l[2]*r[i+e[58]]+l[3]*r[i+e[59]])*p[2]+(l[0]*r[i+e[60]]+l[1]*r[i+e[61]]+l[2]*r[i+e[62]]+l[3]*r[i+e[63]])*p[3])*c[7],i+=n,o[16]=((l[0]*r[i+e[0]]+l[1]*r[i+e[1]]+l[2]*r[i+e[2]]+l[3]*r[i+e[3]])*p[0]+(l[0]*r[i+e[4]]+l[1]*r[i+e[5]]+l[2]*r[i+e[6]]+l[3]*r[i+e[7]])*p[1]+(l[0]*r[i+e[8]]+l[1]*r[i+e[9]]+l[2]*r[i+e[10]]+l[3]*r[i+e[11]])*p[2]+(l[0]*r[i+e[12]]+l[1]*r[i+e[13]]+l[2]*r[i+e[14]]+l[3]*r[i+e[15]])*p[3])*c[4]+((l[0]*r[i+e[16]]+l[1]*r[i+e[17]]+l[2]*r[i+e[18]]+l[3]*r[i+e[19]])*p[0]+(l[0]*r[i+e[20]]+l[1]*r[i+e[21]]+l[2]*r[i+e[22]]+l[3]*r[i+e[23]])*p[1]+(l[0]*r[i+e[24]]+l[1]*r[i+e[25]]+l[2]*r[i+e[26]]+l[3]*r[i+e[27]])*p[2]+(l[0]*r[i+e[28]]+l[1]*r[i+e[29]]+l[2]*r[i+e[30]]+l[3]*r[i+e[31]])*p[3])*c[5]+((l[0]*r[i+e[32]]+l[1]*r[i+e[33]]+l[2]*r[i+e[34]]+l[3]*r[i+e[35]])*p[0]+(l[0]*r[i+e[36]]+l[1]*r[i+e[37]]+l[2]*r[i+e[38]]+l[3]*r[i+e[39]])*p[1]+(l[0]*r[i+e[40]]+l[1]*r[i+e[41]]+l[2]*r[i+e[42]]+l[3]*r[i+e[43]])*p[2]+(l[0]*r[i+e[44]]+l[1]*r[i+e[45]]+l[2]*r[i+e[46]]+l[3]*r[i+e[47]])*p[3])*c[6]+((l[0]*r[i+e[48]]+l[1]*r[i+e[49]]+l[2]*r[i+e[50]]+l[3]*r[i+e[51]])*p[0]+(l[0]*r[i+e[52]]+l[1]*r[i+e[53]]+l[2]*r[i+e[54]]+l[3]*r[i+e[55]])*p[1]+(l[0]*r[i+e[56]]+l[1]*r[i+e[57]]+l[2]*r[i+e[58]]+l[3]*r[i+e[59]])*p[2]+(l[0]*r[i+e[60]]+l[1]*r[i+e[61]]+l[2]*r[i+e[62]]+l[3]*r[i+e[63]])*p[3])*c[7],i+=n,o[17]=((l[0]*r[i+e[0]]+l[1]*r[i+e[1]]+l[2]*r[i+e[2]]+l[3]*r[i+e[3]])*p[0]+(l[0]*r[i+e[4]]+l[1]*r[i+e[5]]+l[2]*r[i+e[6]]+l[3]*r[i+e[7]])*p[1]+(l[0]*r[i+e[8]]+l[1]*r[i+e[9]]+l[2]*r[i+e[10]]+l[3]*r[i+e[11]])*p[2]+(l[0]*r[i+e[12]]+l[1]*r[i+e[13]]+l[2]*r[i+e[14]]+l[3]*r[i+e[15]])*p[3])*c[4]+((l[0]*r[i+e[16]]+l[1]*r[i+e[17]]+l[2]*r[i+e[18]]+l[3]*r[i+e[19]])*p[0]+(l[0]*r[i+e[20]]+l[1]*r[i+e[21]]+l[2]*r[i+e[22]]+l[3]*r[i+e[23]])*p[1]+(l[0]*r[i+e[24]]+l[1]*r[i+e[25]]+l[2]*r[i+e[26]]+l[3]*r[i+e[27]])*p[2]+(l[0]*r[i+e[28]]+l[1]*r[i+e[29]]+l[2]*r[i+e[30]]+l[3]*r[i+e[31]])*p[3])*c[5]+((l[0]*r[i+e[32]]+l[1]*r[i+e[33]]+l[2]*r[i+e[34]]+l[3]*r[i+e[35]])*p[0]+(l[0]*r[i+e[36]]+l[1]*r[i+e[37]]+l[2]*r[i+e[38]]+l[3]*r[i+e[39]])*p[1]+(l[0]*r[i+e[40]]+l[1]*r[i+e[41]]+l[2]*r[i+e[42]]+l[3]*r[i+e[43]])*p[2]+(l[0]*r[i+e[44]]+l[1]*r[i+e[45]]+l[2]*r[i+e[46]]+l[3]*r[i+e[47]])*p[3])*c[6]+((l[0]*r[i+e[48]]+l[1]*r[i+e[49]]+l[2]*r[i+e[50]]+l[3]*r[i+e[51]])*p[0]+(l[0]*r[i+e[52]]+l[1]*r[i+e[53]]+l[2]*r[i+e[54]]+l[3]*r[i+e[55]])*p[1]+(l[0]*r[i+e[56]]+l[1]*r[i+e[57]]+l[2]*r[i+e[58]]+l[3]*r[i+e[59]])*p[2]+(l[0]*r[i+e[60]]+l[1]*r[i+e[61]]+l[2]*r[i+e[62]]+l[3]*r[i+e[63]])*p[3])*c[7],h[d]+=o[14]*o[15],h[d+1]+=o[14]*o[16],h[d+2]+=o[14]*o[17]),L=F=y=m=!1)},LUTVolume.prototype.RGBTet=function(t){var i,s,h=new Float64Array(t),r=this.mesh,e=this.off,o=this.rgb,a=h.length,n=Math.round(this.mesh.length/3),u=this.s,f=u+2+1,l=this.R,p=this.G,c=this.B,m=!1,y=!1,F=!1,L=!1;if(this.fS)for(var C=this.fL,S=this.fLH,d=0;d<a;d+=3)h[d]=(h[d]-C[0])/S[0],h[d+1]=(h[d+1]-C[1])/S[1],h[d+2]=(h[d+2]-C[2])/S[2];this.sin&&this.ins.FCub(t);for(d=0;d<a;d+=3){switch(h[d]*=u,h[d+1]*=u,h[d+2]*=u,o[9]=Math.max(0,Math.min(u-1,Math.floor(h[d]))),o[10]=Math.max(0,Math.min(u-1,Math.floor(h[d+1]))),o[11]=Math.max(0,Math.min(u-1,Math.floor(h[d+2]))),h[d]-=o[9],h[d+1]-=o[10],h[d+2]-=o[11],o[0]=Math.max(0,Math.min(1,h[d])),o[1]=Math.max(0,Math.min(1,h[d+1])),o[2]=Math.max(0,Math.min(1,h[d+2])),o[0]!==h[d]&&(m=y=!0),o[1]!==h[d+1]&&(m=F=!0),o[2]!==h[d+2]&&(m=L=!0),y&&(o[12]=h[d]-o[0]),F&&(o[13]=h[d+1]-o[1]),L&&(o[14]=h[d+2]-o[2]),i=s=o[9]+(o[10]+o[11]*f)*f,(o[0]>o[1])+2*(o[1]>o[2])+4*(o[2]>o[0])){case 0:h[d]=(1-o[0])*r[i+e[21]]+o[0]*r[i+e[42]],i+=n,h[d+1]=(1-o[1])*r[i+e[21]]+o[1]*r[i+e[42]],i+=n,h[d+2]=(1-o[2])*r[i+e[21]]+o[2]*r[i+e[42]];break;case 1:h[d]=(1-o[0])*r[i+e[21]]+(o[0]-o[2])*r[i+e[22]]+(o[2]-o[1])*r[i+e[38]]+o[1]*r[i+e[42]],i+=n,h[d+1]=(1-o[0])*r[i+e[21]]+(o[0]-o[2])*r[i+e[22]]+(o[2]-o[1])*r[i+e[38]]+o[1]*r[i+e[42]],i+=n,h[d+2]=(1-o[0])*r[i+e[21]]+(o[0]-o[2])*r[i+e[22]]+(o[2]-o[1])*r[i+e[38]]+o[1]*r[i+e[42]];break;case 2:h[d]=(1-o[1])*r[i+e[21]]+(o[1]-o[0])*r[i+e[25]]+(o[0]-o[2])*r[i+e[26]]+o[2]*r[i+e[42]],i+=n,h[d+1]=(1-o[1])*r[i+e[21]]+(o[1]-o[0])*r[i+e[25]]+(o[0]-o[2])*r[i+e[26]]+o[2]*r[i+e[42]],i+=n,h[d+2]=(1-o[1])*r[i+e[21]]+(o[1]-o[0])*r[i+e[25]]+(o[0]-o[2])*r[i+e[26]]+o[2]*r[i+e[42]];break;case 3:h[d]=(1-o[0])*r[i+e[21]]+(o[0]-o[1])*r[i+e[22]]+(o[1]-o[2])*r[i+e[26]]+o[2]*r[i+e[42]],i+=n,h[d+1]=(1-o[0])*r[i+e[21]]+(o[0]-o[1])*r[i+e[22]]+(o[1]-o[2])*r[i+e[26]]+o[2]*r[i+e[42]],i+=n,h[d+2]=(1-o[0])*r[i+e[21]]+(o[0]-o[1])*r[i+e[22]]+(o[1]-o[2])*r[i+e[26]]+o[2]*r[i+e[42]];break;case 4:h[d]=(1-o[2])*r[i+e[21]]+(o[2]-o[1])*r[i+e[37]]+(o[1]-o[0])*r[i+e[41]]+o[0]*r[i+e[42]],i+=n,h[d+1]=(1-o[2])*r[i+e[21]]+(o[2]-o[1])*r[i+e[37]]+(o[1]-o[0])*r[i+e[41]]+o[0]*r[i+e[42]],i+=n,h[d+2]=(1-o[2])*r[i+e[21]]+(o[2]-o[1])*r[i+e[37]]+(o[1]-o[0])*r[i+e[41]]+o[0]*r[i+e[42]];break;case 5:h[d]=(1-o[2])*r[i+e[21]]+(o[2]-o[0])*r[i+e[37]]+(o[0]-o[1])*r[i+e[38]]+o[1]*r[i+e[42]],i+=n,h[d+1]=(1-o[2])*r[i+e[21]]+(o[2]-o[0])*r[i+e[37]]+(o[0]-o[1])*r[i+e[38]]+o[1]*r[i+e[42]],i+=n,h[d+2]=(1-o[2])*r[i+e[21]]+(o[2]-o[0])*r[i+e[37]]+(o[0]-o[1])*r[i+e[38]]+o[1]*r[i+e[42]];break;case 6:h[d]=(1-o[1])*r[i+e[21]]+(o[1]-o[2])*r[i+e[25]]+(o[2]-o[0])*r[i+e[41]]+o[0]*r[i+e[42]],i+=n,h[d+1]=(1-o[1])*r[i+e[21]]+(o[1]-o[2])*r[i+e[25]]+(o[2]-o[0])*r[i+e[41]]+o[0]*r[i+e[42]],i+=n,h[d+2]=(1-o[1])*r[i+e[21]]+(o[1]-o[2])*r[i+e[25]]+(o[2]-o[0])*r[i+e[41]]+o[0]*r[i+e[42]];break;default:h[d]=(((1-o[0])*r[i+e[21]]+o[0]*r[i+e[22]])*(1-o[1])+((1-o[0])*r[i+e[25]]+o[0]*r[i+e[26]])*o[1])*(1-o[2])+(((1-o[0])*r[i+e[37]]+o[0]*r[i+e[38]])*(1-o[1])+((1-o[0])*r[i+e[41]]+o[0]*r[i+e[42]])*o[1])*o[2],i+=n,h[d+1]=(((1-o[0])*r[i+e[21]]+o[0]*r[i+e[22]])*(1-o[1])+((1-o[0])*r[i+e[25]]+o[0]*r[i+e[26]])*o[1])*(1-o[2])+(((1-o[0])*r[i+e[37]]+o[0]*r[i+e[38]])*(1-o[1])+((1-o[0])*r[i+e[41]]+o[0]*r[i+e[42]])*o[1])*o[2],i+=n,h[d+2]=(((1-o[0])*r[i+e[21]]+o[0]*r[i+e[22]])*(1-o[1])+((1-o[0])*r[i+e[25]]+o[0]*r[i+e[26]])*o[1])*(1-o[2])+(((1-o[0])*r[i+e[37]]+o[0]*r[i+e[38]])*(1-o[1])+((1-o[0])*r[i+e[41]]+o[0]*r[i+e[42]])*o[1])*o[2]}m&&(l[0]=1-o[0],l[1]=o[0],p[0]=1-o[1],p[1]=o[1],c[0]=1-o[2],c[1]=o[2],y&&(i=s,o[15]=((r[i+e[22]]-r[i+e[21]])*p[0]+(r[i+e[26]]-r[i+e[25]])*p[1])*c[0]+((r[i+e[38]]-r[i+e[37]])*p[0]+(r[i+e[42]]-r[i+e[41]])*p[1])*c[1],i+=n,o[16]=((r[i+e[22]]-r[i+e[21]])*p[0]+(r[i+e[26]]-r[i+e[25]])*p[1])*c[0]+((r[i+e[38]]-r[i+e[37]])*p[0]+(r[i+e[42]]-r[i+e[41]])*p[1])*c[1],i+=n,o[17]=((r[i+e[22]]-r[i+e[21]])*p[0]+(r[i+e[26]]-r[i+e[25]])*p[1])*c[0]+((r[i+e[38]]-r[i+e[37]])*p[0]+(r[i+e[42]]-r[i+e[41]])*p[1])*c[1],h[d]+=o[12]*o[15],h[d+1]+=o[12]*o[16],h[d+2]+=o[12]*o[17]),F&&(i=s,o[15]=((r[i+e[25]]-r[i+e[21]])*l[0]+(r[i+e[26]]-r[i+e[22]])*l[1])*c[0]+((r[i+e[41]]-r[i+e[37]])*l[0]+(r[i+e[42]]-r[i+e[38]])*l[1])*c[1],i+=n,o[16]=((r[i+e[25]]-r[i+e[21]])*l[0]+(r[i+e[26]]-r[i+e[22]])*l[1])*c[0]+((r[i+e[41]]-r[i+e[37]])*l[0]+(r[i+e[42]]-r[i+e[38]])*l[1])*c[1],i+=n,o[17]=((r[i+e[25]]-r[i+e[21]])*l[0]+(r[i+e[26]]-r[i+e[22]])*l[1])*c[0]+((r[i+e[41]]-r[i+e[37]])*l[0]+(r[i+e[42]]-r[i+e[38]])*l[1])*c[1],h[d]+=o[13]*o[15],h[d+1]+=o[13]*o[16],h[d+2]+=o[13]*o[17]),L&&(i=s,o[15]=((r[i+e[37]]-r[i+e[21]])*l[0]+(r[i+e[38]]-r[i+e[22]])*l[1])*p[0]+((r[i+e[41]]-r[i+e[25]])*l[0]+(r[i+e[42]]-r[i+e[26]])*l[1])*p[1],i+=n,o[16]=((r[i+e[37]]-r[i+e[21]])*l[0]+(r[i+e[38]]-r[i+e[22]])*l[1])*p[0]+((r[i+e[41]]-r[i+e[25]])*l[0]+(r[i+e[42]]-r[i+e[26]])*l[1])*p[1],i+=n,o[17]=((r[i+e[37]]-r[i+e[21]])*l[0]+(r[i+e[38]]-r[i+e[22]])*l[1])*p[0]+((r[i+e[41]]-r[i+e[25]])*l[0]+(r[i+e[42]]-r[i+e[26]])*l[1])*p[1],h[d]+=o[14]*o[15],h[d+1]+=o[14]*o[16],h[d+2]+=o[14]*o[17]),L=F=y=m=!1)}},LUTVolume.prototype.RGBLin=function(t){var i,s,h=new Float64Array(t),r=this.mesh,e=this.off,o=this.rgb,a=h.length,n=Math.round(this.mesh.length/3),u=this.s,f=u+2+1,l=this.R,p=this.G,c=this.B,m=!1,y=!1,F=!1,L=!1;if(this.fS)for(var C=this.fL,S=this.fLH,d=0;d<a;d+=3)h[d]=(h[d]-C[0])/S[0],h[d+1]=(h[d+1]-C[1])/S[1],h[d+2]=(h[d+2]-C[2])/S[2];this.sin&&this.ins.FCub(t);for(d=0;d<a;d+=3)h[d]*=u,h[d+1]*=u,h[d+2]*=u,o[9]=Math.max(0,Math.min(u-1,Math.floor(h[d]))),o[10]=Math.max(0,Math.min(u-1,Math.floor(h[d+1]))),o[11]=Math.max(0,Math.min(u-1,Math.floor(h[d+2]))),h[d]-=o[9],h[d+1]-=o[10],h[d+2]-=o[11],o[0]=Math.max(0,Math.min(1,h[d])),o[1]=Math.max(0,Math.min(1,h[d+1])),o[2]=Math.max(0,Math.min(1,h[d+2])),o[0]!==h[d]&&(m=y=!0),o[1]!==h[d+1]&&(m=F=!0),o[2]!==h[d+2]&&(m=L=!0),l[0]=1-o[0],l[1]=o[0],p[0]=1-o[1],p[1]=o[1],c[0]=1-o[2],c[1]=o[2],y&&(o[12]=h[d]-o[0]),F&&(o[13]=h[d+1]-o[1]),L&&(o[14]=h[d+2]-o[2]),i=s=o[9]+(o[10]+o[11]*f)*f,h[d]=((l[0]*r[i+e[21]]+l[1]*r[i+e[22]])*p[0]+(l[0]*r[i+e[25]]+l[1]*r[i+e[26]])*p[1])*c[0]+((l[0]*r[i+e[37]]+l[1]*r[i+e[38]])*p[0]+(l[0]*r[i+e[41]]+l[1]*r[i+e[42]])*p[1])*c[1],i+=n,h[d+1]=((l[0]*r[i+e[21]]+l[1]*r[i+e[22]])*p[0]+(l[0]*r[i+e[25]]+l[1]*r[i+e[26]])*p[1])*c[0]+((l[0]*r[i+e[37]]+l[1]*r[i+e[38]])*p[0]+(l[0]*r[i+e[41]]+l[1]*r[i+e[42]])*p[1])*c[1],i+=n,h[d+2]=((l[0]*r[i+e[21]]+l[1]*r[i+e[22]])*p[0]+(l[0]*r[i+e[25]]+l[1]*r[i+e[26]])*p[1])*c[0]+((l[0]*r[i+e[37]]+l[1]*r[i+e[38]])*p[0]+(l[0]*r[i+e[41]]+l[1]*r[i+e[42]])*p[1])*c[1],m&&(y&&(i=s,o[15]=((r[i+e[22]]-r[i+e[21]])*p[0]+(r[i+e[26]]-r[i+e[25]])*p[1])*c[0]+((r[i+e[38]]-r[i+e[37]])*p[0]+(r[i+e[42]]-r[i+e[41]])*p[1])*c[1],i+=n,o[16]=((r[i+e[22]]-r[i+e[21]])*p[0]+(r[i+e[26]]-r[i+e[25]])*p[1])*c[0]+((r[i+e[38]]-r[i+e[37]])*p[0]+(r[i+e[42]]-r[i+e[41]])*p[1])*c[1],i+=n,o[17]=((r[i+e[22]]-r[i+e[21]])*p[0]+(r[i+e[26]]-r[i+e[25]])*p[1])*c[0]+((r[i+e[38]]-r[i+e[37]])*p[0]+(r[i+e[42]]-r[i+e[41]])*p[1])*c[1],h[d]+=o[12]*o[15],h[d+1]+=o[12]*o[16],h[d+2]+=o[12]*o[17]),F&&(i=s,o[15]=((r[i+e[25]]-r[i+e[21]])*l[0]+(r[i+e[26]]-r[i+e[22]])*l[1])*c[0]+((r[i+e[41]]-r[i+e[37]])*l[0]+(r[i+e[42]]-r[i+e[38]])*l[1])*c[1],i+=n,o[16]=((r[i+e[25]]-r[i+e[21]])*l[0]+(r[i+e[26]]-r[i+e[22]])*l[1])*c[0]+((r[i+e[41]]-r[i+e[37]])*l[0]+(r[i+e[42]]-r[i+e[38]])*l[1])*c[1],i+=n,o[17]=((r[i+e[25]]-r[i+e[21]])*l[0]+(r[i+e[26]]-r[i+e[22]])*l[1])*c[0]+((r[i+e[41]]-r[i+e[37]])*l[0]+(r[i+e[42]]-r[i+e[38]])*l[1])*c[1],h[d]+=o[13]*o[15],h[d+1]+=o[13]*o[16],h[d+2]+=o[13]*o[17]),L&&(i=s,o[15]=((r[i+e[37]]-r[i+e[21]])*l[0]+(r[i+e[38]]-r[i+e[22]])*l[1])*p[0]+((r[i+e[41]]-r[i+e[25]])*l[0]+(r[i+e[42]]-r[i+e[26]])*l[1])*p[1],i+=n,o[16]=((r[i+e[37]]-r[i+e[21]])*l[0]+(r[i+e[38]]-r[i+e[22]])*l[1])*p[0]+((r[i+e[41]]-r[i+e[25]])*l[0]+(r[i+e[42]]-r[i+e[26]])*l[1])*p[1],i+=n,o[17]=((r[i+e[37]]-r[i+e[21]])*l[0]+(r[i+e[38]]-r[i+e[22]])*l[1])*p[0]+((r[i+e[41]]-r[i+e[25]])*l[0]+(r[i+e[42]]-r[i+e[26]])*l[1])*p[1],h[d]+=o[14]*o[15],h[d+1]+=o[14]*o[16],h[d+2]+=o[14]*o[17]),L=F=y=m=!1)},LUTVolume.prototype.J=function(t){if(3!==t.length)return!1;var i,s=new Float64Array(t.buffer.slice(0)),h=new Float64Array(9),r=this.mesh,e=this.off,o=this.s,a=this.rgb,n=this.R,u=this.G,f=this.B,l=o+2+1,p=this.fL,c=this.fLH;if(this.fS)for(var y=0;y<m;y+=3)s[0]=(s[0]-p[0])/c[0],s[1]=(s[1]-p[1])/c[1],s[2]=(s[2]-p[2])/c[2];return this.sin&&this.ins.FCub(s.buffer),s[0]*=o,s[1]*=o,s[2]*=o,a[9]=Math.max(0,Math.min(o-1,Math.floor(s[y]))),a[10]=Math.max(0,Math.min(o-1,Math.floor(s[y+1]))),a[11]=Math.max(0,Math.min(o-1,Math.floor(s[y+2]))),s[0]-=a[9],s[1]-=a[10],s[2]-=a[11],a[0]=Math.max(0,Math.min(1,s[0])),a[1]=Math.max(0,Math.min(1,s[1])),a[2]=Math.max(0,Math.min(1,s[2])),a[3]=a[0]*a[0],a[4]=a[1]*a[1],a[5]=a[2]*a[2],a[6]=a[3]*a[0],a[7]=a[4]*a[1],a[8]=a[5]*a[2],n[0]=-.5*a[6]+a[3]-.5*a[0],n[1]=1.5*a[6]-2.5*a[3]+1,n[2]=-1.5*a[6]+2*a[3]+.5*a[0],n[3]=.5*a[6]-.5*a[3],u[0]=-.5*a[7]+a[4]-.5*a[1],u[1]=1.5*a[7]-2.5*a[4]+1,u[2]=-1.5*a[7]+2*a[4]+.5*a[1],u[3]=.5*a[7]-.5*a[4],f[0]=-.5*a[8]+a[5]-.5*a[2],f[1]=1.5*a[8]-2.5*a[5]+1,f[2]=-1.5*a[8]+2*a[5]+.5*a[2],f[3]=.5*a[8]-.5*a[5],i=a[9]+(a[10]+a[11]*l)*l,n[4]=-1.5*a[3]+2*a[0]-.5,n[5]=4.5*a[3]-5*a[0],n[6]=-4.5*a[3]+4*a[0]+.5,n[7]=1.5*a[3]-a[0],l=i,h[0]=((n[4]*r[l+e[0]]+n[5]*r[l+e[1]]+n[6]*r[l+e[2]]+n[7]*r[l+e[3]])*u[0]+(n[4]*r[l+e[4]]+n[5]*r[l+e[5]]+n[6]*r[l+e[6]]+n[7]*r[l+e[7]])*u[1]+(n[4]*r[l+e[8]]+n[5]*r[l+e[9]]+n[6]*r[l+e[10]]+n[7]*r[l+e[11]])*u[2]+(n[4]*r[l+e[12]]+n[5]*r[l+e[13]]+n[6]*r[l+e[14]]+n[7]*r[l+e[15]])*u[3])*f[0]+((n[4]*r[l+e[16]]+n[5]*r[l+e[17]]+n[6]*r[l+e[18]]+n[7]*r[l+e[19]])*u[0]+(n[4]*r[l+e[20]]+n[5]*r[l+e[21]]+n[6]*r[l+e[22]]+n[7]*r[l+e[23]])*u[1]+(n[4]*r[l+e[24]]+n[5]*r[l+e[25]]+n[6]*r[l+e[26]]+n[7]*r[l+e[27]])*u[2]+(n[4]*r[l+e[28]]+n[5]*r[l+e[29]]+n[6]*r[l+e[30]]+n[7]*r[l+e[31]])*u[3])*f[1]+((n[4]*r[l+e[32]]+n[5]*r[l+e[33]]+n[6]*r[l+e[34]]+n[7]*r[l+e[35]])*u[0]+(n[4]*r[l+e[36]]+n[5]*r[l+e[37]]+n[6]*r[l+e[38]]+n[7]*r[l+e[39]])*u[1]+(n[4]*r[l+e[40]]+n[5]*r[l+e[41]]+n[6]*r[l+e[42]]+n[7]*r[l+e[43]])*u[2]+(n[4]*r[l+e[44]]+n[5]*r[l+e[45]]+n[6]*r[l+e[46]]+n[7]*r[l+e[47]])*u[3])*f[2]+((n[4]*r[l+e[48]]+n[5]*r[l+e[49]]+n[6]*r[l+e[50]]+n[7]*r[l+e[51]])*u[0]+(n[4]*r[l+e[52]]+n[5]*r[l+e[53]]+n[6]*r[l+e[54]]+n[7]*r[l+e[55]])*u[1]+(n[4]*r[l+e[56]]+n[5]*r[l+e[57]]+n[6]*r[l+e[58]]+n[7]*r[l+e[59]])*u[2]+(n[4]*r[l+e[60]]+n[5]*r[l+e[61]]+n[6]*r[l+e[62]]+n[7]*r[l+e[63]])*u[3])*f[3],l+=mm,h[3]=((n[4]*r[l+e[0]]+n[5]*r[l+e[1]]+n[6]*r[l+e[2]]+n[7]*r[l+e[3]])*u[0]+(n[4]*r[l+e[4]]+n[5]*r[l+e[5]]+n[6]*r[l+e[6]]+n[7]*r[l+e[7]])*u[1]+(n[4]*r[l+e[8]]+n[5]*r[l+e[9]]+n[6]*r[l+e[10]]+n[7]*r[l+e[11]])*u[2]+(n[4]*r[l+e[12]]+n[5]*r[l+e[13]]+n[6]*r[l+e[14]]+n[7]*r[l+e[15]])*u[3])*f[0]+((n[4]*r[l+e[16]]+n[5]*r[l+e[17]]+n[6]*r[l+e[18]]+n[7]*r[l+e[19]])*u[0]+(n[4]*r[l+e[20]]+n[5]*r[l+e[21]]+n[6]*r[l+e[22]]+n[7]*r[l+e[23]])*u[1]+(n[4]*r[l+e[24]]+n[5]*r[l+e[25]]+n[6]*r[l+e[26]]+n[7]*r[l+e[27]])*u[2]+(n[4]*r[l+e[28]]+n[5]*r[l+e[29]]+n[6]*r[l+e[30]]+n[7]*r[l+e[31]])*u[3])*f[1]+((n[4]*r[l+e[32]]+n[5]*r[l+e[33]]+n[6]*r[l+e[34]]+n[7]*r[l+e[35]])*u[0]+(n[4]*r[l+e[36]]+n[5]*r[l+e[37]]+n[6]*r[l+e[38]]+n[7]*r[l+e[39]])*u[1]+(n[4]*r[l+e[40]]+n[5]*r[l+e[41]]+n[6]*r[l+e[42]]+n[7]*r[l+e[43]])*u[2]+(n[4]*r[l+e[44]]+n[5]*r[l+e[45]]+n[6]*r[l+e[46]]+n[7]*r[l+e[47]])*u[3])*f[2]+((n[4]*r[l+e[48]]+n[5]*r[l+e[49]]+n[6]*r[l+e[50]]+n[7]*r[l+e[51]])*u[0]+(n[4]*r[l+e[52]]+n[5]*r[l+e[53]]+n[6]*r[l+e[54]]+n[7]*r[l+e[55]])*u[1]+(n[4]*r[l+e[56]]+n[5]*r[l+e[57]]+n[6]*r[l+e[58]]+n[7]*r[l+e[59]])*u[2]+(n[4]*r[l+e[60]]+n[5]*r[l+e[61]]+n[6]*r[l+e[62]]+n[7]*r[l+e[63]])*u[3])*f[3],l+=mm,h[6]=((n[4]*r[l+e[0]]+n[5]*r[l+e[1]]+n[6]*r[l+e[2]]+n[7]*r[l+e[3]])*u[0]+(n[4]*r[l+e[4]]+n[5]*r[l+e[5]]+n[6]*r[l+e[6]]+n[7]*r[l+e[7]])*u[1]+(n[4]*r[l+e[8]]+n[5]*r[l+e[9]]+n[6]*r[l+e[10]]+n[7]*r[l+e[11]])*u[2]+(n[4]*r[l+e[12]]+n[5]*r[l+e[13]]+n[6]*r[l+e[14]]+n[7]*r[l+e[15]])*u[3])*f[0]+((n[4]*r[l+e[16]]+n[5]*r[l+e[17]]+n[6]*r[l+e[18]]+n[7]*r[l+e[19]])*u[0]+(n[4]*r[l+e[20]]+n[5]*r[l+e[21]]+n[6]*r[l+e[22]]+n[7]*r[l+e[23]])*u[1]+(n[4]*r[l+e[24]]+n[5]*r[l+e[25]]+n[6]*r[l+e[26]]+n[7]*r[l+e[27]])*u[2]+(n[4]*r[l+e[28]]+n[5]*r[l+e[29]]+n[6]*r[l+e[30]]+n[7]*r[l+e[31]])*u[3])*f[1]+((n[4]*r[l+e[32]]+n[5]*r[l+e[33]]+n[6]*r[l+e[34]]+n[7]*r[l+e[35]])*u[0]+(n[4]*r[l+e[36]]+n[5]*r[l+e[37]]+n[6]*r[l+e[38]]+n[7]*r[l+e[39]])*u[1]+(n[4]*r[l+e[40]]+n[5]*r[l+e[41]]+n[6]*r[l+e[42]]+n[7]*r[l+e[43]])*u[2]+(n[4]*r[l+e[44]]+n[5]*r[l+e[45]]+n[6]*r[l+e[46]]+n[7]*r[l+e[47]])*u[3])*f[2]+((n[4]*r[l+e[48]]+n[5]*r[l+e[49]]+n[6]*r[l+e[50]]+n[7]*r[l+e[51]])*u[0]+(n[4]*r[l+e[52]]+n[5]*r[l+e[53]]+n[6]*r[l+e[54]]+n[7]*r[l+e[55]])*u[1]+(n[4]*r[l+e[56]]+n[5]*r[l+e[57]]+n[6]*r[l+e[58]]+n[7]*r[l+e[59]])*u[2]+(n[4]*r[l+e[60]]+n[5]*r[l+e[61]]+n[6]*r[l+e[62]]+n[7]*r[l+e[63]])*u[3])*f[3],u[4]=-1.5*a[4]+2*a[1]-.5,u[5]=4.5*a[4]-5*a[1],u[6]=-4.5*a[4]+4*a[1]+.5,u[7]=1.5*a[4]-a[1],l=i,h[1]=((n[0]*r[l+e[0]]+n[1]*r[l+e[1]]+n[2]*r[l+e[2]]+n[3]*r[l+e[3]])*u[4]+(n[0]*r[l+e[4]]+n[1]*r[l+e[5]]+n[2]*r[l+e[6]]+n[3]*r[l+e[7]])*u[5]+(n[0]*r[l+e[8]]+n[1]*r[l+e[9]]+n[2]*r[l+e[10]]+n[3]*r[l+e[11]])*u[6]+(n[0]*r[l+e[12]]+n[1]*r[l+e[13]]+n[2]*r[l+e[14]]+n[3]*r[l+e[15]])*u[7])*f[0]+((n[0]*r[l+e[16]]+n[1]*r[l+e[17]]+n[2]*r[l+e[18]]+n[3]*r[l+e[19]])*u[4]+(n[0]*r[l+e[20]]+n[1]*r[l+e[21]]+n[2]*r[l+e[22]]+n[3]*r[l+e[23]])*u[5]+(n[0]*r[l+e[24]]+n[1]*r[l+e[25]]+n[2]*r[l+e[26]]+n[3]*r[l+e[27]])*u[6]+(n[0]*r[l+e[28]]+n[1]*r[l+e[29]]+n[2]*r[l+e[30]]+n[3]*r[l+e[31]])*u[7])*f[1]+((n[0]*r[l+e[32]]+n[1]*r[l+e[33]]+n[2]*r[l+e[34]]+n[3]*r[l+e[35]])*u[4]+(n[0]*r[l+e[36]]+n[1]*r[l+e[37]]+n[2]*r[l+e[38]]+n[3]*r[l+e[39]])*u[5]+(n[0]*r[l+e[40]]+n[1]*r[l+e[41]]+n[2]*r[l+e[42]]+n[3]*r[l+e[43]])*u[6]+(n[0]*r[l+e[44]]+n[1]*r[l+e[45]]+n[2]*r[l+e[46]]+n[3]*r[l+e[47]])*u[7])*f[2]+((n[0]*r[l+e[48]]+n[1]*r[l+e[49]]+n[2]*r[l+e[50]]+n[3]*r[l+e[51]])*u[4]+(n[0]*r[l+e[52]]+n[1]*r[l+e[53]]+n[2]*r[l+e[54]]+n[3]*r[l+e[55]])*u[5]+(n[0]*r[l+e[56]]+n[1]*r[l+e[57]]+n[2]*r[l+e[58]]+n[3]*r[l+e[59]])*u[6]+(n[0]*r[l+e[60]]+n[1]*r[l+e[61]]+n[2]*r[l+e[62]]+n[3]*r[l+e[63]])*u[7])*f[3],l+=mm,h[4]=((n[0]*r[l+e[0]]+n[1]*r[l+e[1]]+n[2]*r[l+e[2]]+n[3]*r[l+e[3]])*u[4]+(n[0]*r[l+e[4]]+n[1]*r[l+e[5]]+n[2]*r[l+e[6]]+n[3]*r[l+e[7]])*u[5]+(n[0]*r[l+e[8]]+n[1]*r[l+e[9]]+n[2]*r[l+e[10]]+n[3]*r[l+e[11]])*u[6]+(n[0]*r[l+e[12]]+n[1]*r[l+e[13]]+n[2]*r[l+e[14]]+n[3]*r[l+e[15]])*u[7])*f[0]+((n[0]*r[l+e[16]]+n[1]*r[l+e[17]]+n[2]*r[l+e[18]]+n[3]*r[l+e[19]])*u[4]+(n[0]*r[l+e[20]]+n[1]*r[l+e[21]]+n[2]*r[l+e[22]]+n[3]*r[l+e[23]])*u[5]+(n[0]*r[l+e[24]]+n[1]*r[l+e[25]]+n[2]*r[l+e[26]]+n[3]*r[l+e[27]])*u[6]+(n[0]*r[l+e[28]]+n[1]*r[l+e[29]]+n[2]*r[l+e[30]]+n[3]*r[l+e[31]])*u[7])*f[1]+((n[0]*r[l+e[32]]+n[1]*r[l+e[33]]+n[2]*r[l+e[34]]+n[3]*r[l+e[35]])*u[4]+(n[0]*r[l+e[36]]+n[1]*r[l+e[37]]+n[2]*r[l+e[38]]+n[3]*r[l+e[39]])*u[5]+(n[0]*r[l+e[40]]+n[1]*r[l+e[41]]+n[2]*r[l+e[42]]+n[3]*r[l+e[43]])*u[6]+(n[0]*r[l+e[44]]+n[1]*r[l+e[45]]+n[2]*r[l+e[46]]+n[3]*r[l+e[47]])*u[7])*f[2]+((n[0]*r[l+e[48]]+n[1]*r[l+e[49]]+n[2]*r[l+e[50]]+n[3]*r[l+e[51]])*u[4]+(n[0]*r[l+e[52]]+n[1]*r[l+e[53]]+n[2]*r[l+e[54]]+n[3]*r[l+e[55]])*u[5]+(n[0]*r[l+e[56]]+n[1]*r[l+e[57]]+n[2]*r[l+e[58]]+n[3]*r[l+e[59]])*u[6]+(n[0]*r[l+e[60]]+n[1]*r[l+e[61]]+n[2]*r[l+e[62]]+n[3]*r[l+e[63]])*u[7])*f[3],l+=mm,h[7]=((n[0]*r[l+e[0]]+n[1]*r[l+e[1]]+n[2]*r[l+e[2]]+n[3]*r[l+e[3]])*u[4]+(n[0]*r[l+e[4]]+n[1]*r[l+e[5]]+n[2]*r[l+e[6]]+n[3]*r[l+e[7]])*u[5]+(n[0]*r[l+e[8]]+n[1]*r[l+e[9]]+n[2]*r[l+e[10]]+n[3]*r[l+e[11]])*u[6]+(n[0]*r[l+e[12]]+n[1]*r[l+e[13]]+n[2]*r[l+e[14]]+n[3]*r[l+e[15]])*u[7])*f[0]+((n[0]*r[l+e[16]]+n[1]*r[l+e[17]]+n[2]*r[l+e[18]]+n[3]*r[l+e[19]])*u[4]+(n[0]*r[l+e[20]]+n[1]*r[l+e[21]]+n[2]*r[l+e[22]]+n[3]*r[l+e[23]])*u[5]+(n[0]*r[l+e[24]]+n[1]*r[l+e[25]]+n[2]*r[l+e[26]]+n[3]*r[l+e[27]])*u[6]+(n[0]*r[l+e[28]]+n[1]*r[l+e[29]]+n[2]*r[l+e[30]]+n[3]*r[l+e[31]])*u[7])*f[1]+((n[0]*r[l+e[32]]+n[1]*r[l+e[33]]+n[2]*r[l+e[34]]+n[3]*r[l+e[35]])*u[4]+(n[0]*r[l+e[36]]+n[1]*r[l+e[37]]+n[2]*r[l+e[38]]+n[3]*r[l+e[39]])*u[5]+(n[0]*r[l+e[40]]+n[1]*r[l+e[41]]+n[2]*r[l+e[42]]+n[3]*r[l+e[43]])*u[6]+(n[0]*r[l+e[44]]+n[1]*r[l+e[45]]+n[2]*r[l+e[46]]+n[3]*r[l+e[47]])*u[7])*f[2]+((n[0]*r[l+e[48]]+n[1]*r[l+e[49]]+n[2]*r[l+e[50]]+n[3]*r[l+e[51]])*u[4]+(n[0]*r[l+e[52]]+n[1]*r[l+e[53]]+n[2]*r[l+e[54]]+n[3]*r[l+e[55]])*u[5]+(n[0]*r[l+e[56]]+n[1]*r[l+e[57]]+n[2]*r[l+e[58]]+n[3]*r[l+e[59]])*u[6]+(n[0]*r[l+e[60]]+n[1]*r[l+e[61]]+n[2]*r[l+e[62]]+n[3]*r[l+e[63]])*u[7])*f[3],f[4]=-1.5*a[5]+2*a[2]-.5,f[5]=4.5*a[5]-5*a[2],f[6]=-4.5*a[5]+4*a[2]+.5,f[7]=1.5*a[5]-a[2],l=i,h[2]=((n[0]*r[l+e[0]]+n[1]*r[l+e[1]]+n[2]*r[l+e[2]]+n[3]*r[l+e[3]])*u[0]+(n[0]*r[l+e[4]]+n[1]*r[l+e[5]]+n[2]*r[l+e[6]]+n[3]*r[l+e[7]])*u[1]+(n[0]*r[l+e[8]]+n[1]*r[l+e[9]]+n[2]*r[l+e[10]]+n[3]*r[l+e[11]])*u[2]+(n[0]*r[l+e[12]]+n[1]*r[l+e[13]]+n[2]*r[l+e[14]]+n[3]*r[l+e[15]])*u[3])*f[4]+((n[0]*r[l+e[16]]+n[1]*r[l+e[17]]+n[2]*r[l+e[18]]+n[3]*r[l+e[19]])*u[0]+(n[0]*r[l+e[20]]+n[1]*r[l+e[21]]+n[2]*r[l+e[22]]+n[3]*r[l+e[23]])*u[1]+(n[0]*r[l+e[24]]+n[1]*r[l+e[25]]+n[2]*r[l+e[26]]+n[3]*r[l+e[27]])*u[2]+(n[0]*r[l+e[28]]+n[1]*r[l+e[29]]+n[2]*r[l+e[30]]+n[3]*r[l+e[31]])*u[3])*f[5]+((n[0]*r[l+e[32]]+n[1]*r[l+e[33]]+n[2]*r[l+e[34]]+n[3]*r[l+e[35]])*u[0]+(n[0]*r[l+e[36]]+n[1]*r[l+e[37]]+n[2]*r[l+e[38]]+n[3]*r[l+e[39]])*u[1]+(n[0]*r[l+e[40]]+n[1]*r[l+e[41]]+n[2]*r[l+e[42]]+n[3]*r[l+e[43]])*u[2]+(n[0]*r[l+e[44]]+n[1]*r[l+e[45]]+n[2]*r[l+e[46]]+n[3]*r[l+e[47]])*u[3])*f[6]+((n[0]*r[l+e[48]]+n[1]*r[l+e[49]]+n[2]*r[l+e[50]]+n[3]*r[l+e[51]])*u[0]+(n[0]*r[l+e[52]]+n[1]*r[l+e[53]]+n[2]*r[l+e[54]]+n[3]*r[l+e[55]])*u[1]+(n[0]*r[l+e[56]]+n[1]*r[l+e[57]]+n[2]*r[l+e[58]]+n[3]*r[l+e[59]])*u[2]+(n[0]*r[l+e[60]]+n[1]*r[l+e[61]]+n[2]*r[l+e[62]]+n[3]*r[l+e[63]])*u[3])*f[7],l+=mm,h[5]=((n[0]*r[l+e[0]]+n[1]*r[l+e[1]]+n[2]*r[l+e[2]]+n[3]*r[l+e[3]])*u[0]+(n[0]*r[l+e[4]]+n[1]*r[l+e[5]]+n[2]*r[l+e[6]]+n[3]*r[l+e[7]])*u[1]+(n[0]*r[l+e[8]]+n[1]*r[l+e[9]]+n[2]*r[l+e[10]]+n[3]*r[l+e[11]])*u[2]+(n[0]*r[l+e[12]]+n[1]*r[l+e[13]]+n[2]*r[l+e[14]]+n[3]*r[l+e[15]])*u[3])*f[4]+((n[0]*r[l+e[16]]+n[1]*r[l+e[17]]+n[2]*r[l+e[18]]+n[3]*r[l+e[19]])*u[0]+(n[0]*r[l+e[20]]+n[1]*r[l+e[21]]+n[2]*r[l+e[22]]+n[3]*r[l+e[23]])*u[1]+(n[0]*r[l+e[24]]+n[1]*r[l+e[25]]+n[2]*r[l+e[26]]+n[3]*r[l+e[27]])*u[2]+(n[0]*r[l+e[28]]+n[1]*r[l+e[29]]+n[2]*r[l+e[30]]+n[3]*r[l+e[31]])*u[3])*f[5]+((n[0]*r[l+e[32]]+n[1]*r[l+e[33]]+n[2]*r[l+e[34]]+n[3]*r[l+e[35]])*u[0]+(n[0]*r[l+e[36]]+n[1]*r[l+e[37]]+n[2]*r[l+e[38]]+n[3]*r[l+e[39]])*u[1]+(n[0]*r[l+e[40]]+n[1]*r[l+e[41]]+n[2]*r[l+e[42]]+n[3]*r[l+e[43]])*u[2]+(n[0]*r[l+e[44]]+n[1]*r[l+e[45]]+n[2]*r[l+e[46]]+n[3]*r[l+e[47]])*u[3])*f[6]+((n[0]*r[l+e[48]]+n[1]*r[l+e[49]]+n[2]*r[l+e[50]]+n[3]*r[l+e[51]])*u[0]+(n[0]*r[l+e[52]]+n[1]*r[l+e[53]]+n[2]*r[l+e[54]]+n[3]*r[l+e[55]])*u[1]+(n[0]*r[l+e[56]]+n[1]*r[l+e[57]]+n[2]*r[l+e[58]]+n[3]*r[l+e[59]])*u[2]+(n[0]*r[l+e[60]]+n[1]*r[l+e[61]]+n[2]*r[l+e[62]]+n[3]*r[l+e[63]])*u[3])*f[7],l+=mm,h[8]=((n[0]*r[l+e[0]]+n[1]*r[l+e[1]]+n[2]*r[l+e[2]]+n[3]*r[l+e[3]])*u[0]+(n[0]*r[l+e[4]]+n[1]*r[l+e[5]]+n[2]*r[l+e[6]]+n[3]*r[l+e[7]])*u[1]+(n[0]*r[l+e[8]]+n[1]*r[l+e[9]]+n[2]*r[l+e[10]]+n[3]*r[l+e[11]])*u[2]+(n[0]*r[l+e[12]]+n[1]*r[l+e[13]]+n[2]*r[l+e[14]]+n[3]*r[l+e[15]])*u[3])*f[4]+((n[0]*r[l+e[16]]+n[1]*r[l+e[17]]+n[2]*r[l+e[18]]+n[3]*r[l+e[19]])*u[0]+(n[0]*r[l+e[20]]+n[1]*r[l+e[21]]+n[2]*r[l+e[22]]+n[3]*r[l+e[23]])*u[1]+(n[0]*r[l+e[24]]+n[1]*r[l+e[25]]+n[2]*r[l+e[26]]+n[3]*r[l+e[27]])*u[2]+(n[0]*r[l+e[28]]+n[1]*r[l+e[29]]+n[2]*r[l+e[30]]+n[3]*r[l+e[31]])*u[3])*f[5]+((n[0]*r[l+e[32]]+n[1]*r[l+e[33]]+n[2]*r[l+e[34]]+n[3]*r[l+e[35]])*u[0]+(n[0]*r[l+e[36]]+n[1]*r[l+e[37]]+n[2]*r[l+e[38]]+n[3]*r[l+e[39]])*u[1]+(n[0]*r[l+e[40]]+n[1]*r[l+e[41]]+n[2]*r[l+e[42]]+n[3]*r[l+e[43]])*u[2]+(n[0]*r[l+e[44]]+n[1]*r[l+e[45]]+n[2]*r[l+e[46]]+n[3]*r[l+e[47]])*u[3])*f[6]+((n[0]*r[l+e[48]]+n[1]*r[l+e[49]]+n[2]*r[l+e[50]]+n[3]*r[l+e[51]])*u[0]+(n[0]*r[l+e[52]]+n[1]*r[l+e[53]]+n[2]*r[l+e[54]]+n[3]*r[l+e[55]])*u[1]+(n[0]*r[l+e[56]]+n[1]*r[l+e[57]]+n[2]*r[l+e[58]]+n[3]*r[l+e[59]])*u[2]+(n[0]*r[l+e[60]]+n[1]*r[l+e[61]]+n[2]*r[l+e[62]]+n[3]*r[l+e[63]])*u[3])*f[7],h[0]*=o,h[1]*=o,h[2]*=o,h[3]*=o,h[4]*=o,h[5]*=o,h[6]*=o,h[7]*=o,h[8]*=o,this.sin&&(t=this.ins.dRGB(t.buffer),h[0]*=t[0],h[1]*=t[1],h[2]*=t[2],h[3]*=t[0],h[4]*=t[1],h[5]*=t[2],h[6]*=t[0],h[7]*=t[1],h[8]*=t[2]),this.fS&&(h[0]/=c[0],h[1]/=c[1],h[2]/=c[2],h[3]/=c[0],h[4]/=c[1],h[5]/=c[2],h[6]/=c[0],h[7]/=c[1],h[8]/=c[2]),h},LUTVolume.prototype.JInv=function(t){var i=this.J(t),t=i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]);return 0!=t&&new Float64Array([(i[4]*i[8]-i[5]*i[7])/t,(i[2]*i[7]-i[1]*i[8])/t,(i[1]*i[5]-i[2]*i[4])/t,(i[5]*i[6]-i[3]*i[8])/t,(i[0]*i[8]-i[2]*i[6])/t,(i[2]*i[3]-i[0]*i[5])/t,(i[3]*i[7]-i[4]*i[6])/t,(i[1]*i[6]-i[0]*i[7])/t,(i[0]*i[4]-i[1]*i[3])/t])},LUTVolume.prototype.getDetails=function(){return{title:this.title,format:this.format,dims:3,s:this.d,min:new Float64Array([this.fL[0],this.fL[1],this.fL[2]]),max:new Float64Array([this.fH[0],this.fH[1],this.fH[2]]),C:this.getRGB(),meta:this.meta}},LUTVolume.prototype.getL=function(){return this.L.getL()},LUTVolume.prototype.getRGB=function(){for(var t,i,s=this.d,h=s+2,r=s*s*s,e=h*h*h,o=new Float64Array(r),a=new Float64Array(r),n=new Float64Array(r),u=this.mesh,f=0;f<s;f++)for(var l=0;l<s;l++)for(var p=0;p<s;p++)i=p+1+(l+1+(f+1)*h)*h,o[t=p+(l+f*s)*s]=u[i],i+=e,a[t]=u[i],i+=e,n[t]=u[i];return[o.buffer,a.buffer,n.buffer]},LUTVolume.prototype.getSize=function(){return this.d},LUTVolume.prototype.is1D=function(){return!1},LUTVolume.prototype.is3D=function(){return!0},LUTVolume.prototype.getTitle=function(){return this.title},LUTVolume.prototype.getMetadata=function(){return this.meta},LUTVolume.prototype.isClamped=function(){var t,i;return void 0===this.clamped&&(i=this.minMax(),t=Math.min(i[0],i[1],i[2]),i=Math.max(i[3],i[4],i[5]),this.clamped=0===t&&i<=1||0<=t&&1===i),this.clamped},LUTVolume.prototype.deClamp=function(){this.isClamped()&&(this.deClamp1D(),this.deClamp3D())},LUTVolume.prototype.getColourSpace=function(){this.d;var t=this.fL,i=this.fH,s=(this.fLH,{title:this.title+"CS",format:this.format,fLR:t[0],fLG:t[1],fLB:t[2],fHR:i[0],fHG:i[1],fHB:i[2]}),i=new LUTRSpline({buff:this.L.getL(),fH:i[3],fL:t[3]}),t=this.getRGB();return i.R(t[0]),i.R(t[1]),i.R(t[2]),s.buffR=t[0],s.buffG=t[1],s.buffB=t[2],new LUTVolume(s)},LUTVolume.prototype.deClamp1D=function(){for(var t,i=this.d,s=new Float64Array(i),h=new Float64Array(i),r=new Float64Array(i),e=0,o=0,a=0,n=i-1,u=i-1,f=i-1,l=this.d+2,p=l*l*l,c=this.mesh,m=!1,y=!1,F=!1,L=Math.min(this.fL[0],this.fL[1],this.fL[2]),C=Math.max(this.fH[0],this.fH[1],this.fH[2]),S=C-L,d=0;d<i;d++)t=d+1+(d+1+(d+1)*l)*l,s[d]=c[t],t+=p,h[d]=c[t],t+=p,r[d]=c[t],0<d&&(0===s[d]&&(m=!0,e=d+1),0===h[d]&&(y=!0,o=d+1),0===r[d]&&(F=!0,a=d+1));for(var b,w,g,d=i-2;0<=d;d--)1===s[d]&&(m=!0,n=d-1),1===h[d]&&(y=!0,u=d-1),1===r[d]&&(F=!0,f=d-1);if(m||y||F){n<e&&(g=n,n=Math.min(e-2,i-1),e=Math.max(g+2,0)),u<o&&(g=u,u=Math.min(o-2,i-1),o=Math.max(g+2,0)),f<a&&(g=f,f=Math.min(a-2,i-1),a=Math.max(g+2,0)),b=new LUTQSpline((m?new Float64Array(s.subarray(e,n-e+1)):s).buffer),w=new LUTQSpline((y?new Float64Array(h.subarray(o,u-o+1)):h).buffer),g=new LUTQSpline((F?new Float64Array(r.subarray(a,f-a+1)):r).buffer);var M=i;i<65&&(M=65);new Float64Array(M);for(var A=new Float64Array(M),d=0;d<M;d++)A[d]=d*S/(M-1)+L;var x=new Float64Array(A),T=new Float64Array(A);if(this.fS)for(d=0;d<M;d++)A[d]=(A[d]-this.fL[0])/this.fLH[0],x[d]=(x[d]-this.fL[1])/this.fLH[1],T[d]=(T[d]-this.fL[2])/this.fLH[2];this.sin&&(this.ins.FCub(A.buffer),this.ins.FCub(x.buffer),this.ins.FCub(T.buffer));for(d=0;d<M;d++)A[d]=(A[d]*(i-1)-e)/(n-e),x[d]=(x[d]*(i-1)-o)/(u-o),T[d]=(T[d]*(i-1)-a)/(f-a);b.FCub(A.buffer),w.FCub(x.buffer),g.FCub(T.buffer);for(d=0;d<M;d++)A[d]=A[d]*this.Y[0]+x[d]*this.Y[1]+T[d]*this.Y[2];return this.L=new LUTSpline({buff:A.buffer,fH:C,fL:L}),!(this.clamped=!1)}return!1},LUTVolume.prototype.deClamp3D=function(){for(var t,i,s,h,r,e,o,a,n,u,f,l=this.d,p=l+2,c=p*p*p,y=this.mesh,F=new Float64Array(l),L=new Float64Array(l),C=new Float64Array(l),S=this.minMax(),d=Math.min(0,Math.min(S[0],S[1],S[2])),S=Math.max(1,Math.max(S[3],S[4],S[5])),b=new Float64Array([d,S,d-.1,S+.175]),w=0;w<l;w++)for(var g=0;g<l;g++){u=n=a=l-1,h=s=i=!1;for(var M=o=e=r=0;M<l;M++)t=M+1+(g+1+(w+1)*p)*p,F[M]=y[t],t=g+1+(M+1+(w+1)*p)*p+c,L[M]=y[t],t=g+1+(w+1+(M+1)*p)*p+2*c,C[M]=y[t],0<M&&(0===F[M]&&(i=!0,r=M+1),0===L[M]&&(s=!0,e=M+1),0===C[M]&&(h=!0,o=M+1));for(M=l-2;0<=M;M--)1===F[M]&&(i=!0,a=M-1),1===L[M]&&(s=!0,n=M-1),1===C[M]&&(h=!0,u=M-1);if(i){a<r&&(f=a,a=Math.min(r-2,m-1),r=Math.max(f+2,0)),this.extrap(F,r,a,b);for(M=0;M<l;M++)M===r&&(M=a),y[t=M+1+(g+1+(w+1)*p)*p]=F[M]}if(s){n<e&&(f=n,n=Math.min(e-2,m-1),e=Math.max(f+2,0)),this.extrap(L,e,n,b);for(M=0;M<l;M++)M===e&&(M=n),y[t=g+1+(M+1+(w+1)*p)*p+c]=L[M]}if(h){u<o&&(f=u,u=Math.min(o-2,m-1),o=Math.max(f+2,0)),this.extrap(C,o,u,b);for(M=0;M<l;M++)M===o&&(M=u),y[t=g+1+(w+1+(M+1)*p)*p+2*c]=C[M]}}l--;for(w=1;w<l;w++){for(g=0;g<l;g++)this.n3b(w,g,0),this.n3b(w,g,l),this.n3b(w,0,g),this.n3b(w,l,g),this.n3b(0,w,g),this.n3b(l,w,g);this.n3b(w,0,0),this.n3b(w,0,l),this.n3b(w,l,0),this.n3b(w,l,l),this.n3b(0,w,0),this.n3b(0,w,l),this.n3b(l,w,0),this.n3b(l,w,l),this.n3b(0,0,w),this.n3b(0,l,w),this.n3b(l,0,w),this.n3b(l,l,w)}this.n3b(0,0,0),this.n3b(0,0,l),this.n3b(0,l,0),this.n3b(0,l,l),this.n3b(l,0,0),this.n3b(l,0,l),this.n3b(l,l,0),this.n3b(l,l,l),this.fillEdges(),this.clamped=!1},LUTVolume.prototype.extrap=function(t,i,s,h){var r,e=t.length,o=2<s-i?(r=.1*t[i+3]-.8*t[i+2]+2.3*t[i+1]-1.6*t[i],-.1*t[s-3]+.8*t[s-2]-2.3*t[s-1]+1.6*t[s]):1<s-i?r=1:(r=t[i+1]-t[i],t[s]-t[s-1]);if(0<i)for(var a=0;a<i;a++)t[a]=t[i]+(a-i)*r;if(s<e-1)for(a=s+1;a<e;a++)t[a]=t[s]+(a-s)*o;if(void 0!==h)for(var n=h[0],u=h[1],f=h[2],l=h[3],p=Math.pow(f-n,2),c=f-n,m=Math.pow(l-u,2),y=l-u,a=0;a<e;a++)a===i&&(a=s+1),t[a]<n?t[a]=f-p/(r*(t[a]-n)+c):t[a]>u&&(t[a]=l-m/(o*(t[a]-u)+y))},LUTVolume.prototype.fillEdges=function(){for(var t=this.d,i=0;i<t;i++){for(var s=0;s<t;s++)this.n3(i,s,-1),this.n3(i,s,t),this.n3(i,-1,s),this.n3(i,t,s),this.n3(-1,i,s),this.n3(t,i,s);this.n3(i,-1,-1),this.n3(i,-1,t),this.n3(i,t,-1),this.n3(i,t,t),this.n3(-1,i,-1),this.n3(-1,i,t),this.n3(t,i,-1),this.n3(t,i,t),this.n3(-1,-1,i),this.n3(-1,t,i),this.n3(t,-1,i),this.n3(t,t,i)}this.n3(-1,-1,-1),this.n3(-1,-1,t),this.n3(-1,t,-1),this.n3(-1,t,t),this.n3(t,-1,-1),this.n3(t,-1,t),this.n3(t,t,-1),this.n3(t,t,t)},LUTVolume.prototype.setP=function(t,i,s,h){var r=this.mesh,e=this.d-1,o=e-4,a=this.nd,n=a*a,u=n*a,f=2*u,a=t+1+(i+1)*a+(s+1)*n,n=new Float64Array([r[a],r[a+u],r[a+f]]);return r[a]=h[0],r[a+u]=h[1],r[a+f]=h[2],t<4&&(this.n3(-1,i,s),i===t&&this.n3(-1,-1,s),i===o-t&&this.n3(-1,e,s),s===t&&this.n3(-1,i,-1),s===o-t&&this.n3(-1,i,e),i===t&&s===t&&this.n3(-1,-1,-1),i===o-t&&s===t&&this.n3(-1,e,-1),i===o-t&&s===o-t&&this.n3(-1,e,e),i===t&&s===o-t&&this.n3(-1,-1,e)),o<t&&(this.n3(e,i,s),i===t&&this.n3(e,e,s),i===t-o&&this.n3(e,-1,s),s===t&&this.n3(e,i,e),s===t-o&&this.n3(e,i,-1),i===t&&s===t&&this.n3(e,e,e),i===t-o&&s===t&&this.n3(e,-1,e),i===t-o&&s===t-o&&this.n3(e,-1,-1),i===t&&s===t-o&&this.n3(e,e,-1)),i<4&&(this.n3(t,-1,s),s===i&&this.n3(t,-1,-1),s===o-i&&this.n3(t,-1,e)),o<i&&(this.n3(t,e,s),s===i&&this.n3(t,e,-1),s===i-o&&this.n3(t,e,e)),s<4&&this.n3(t,i,-1),o<s&&this.n3(t,i,e),n},LUTVolume.prototype.getP=function(t,i,s){var h=this.mesh,r=this.nd,e=r*r,o=e*r,a=2*o,e=t+1+(i+1)*r+(s+1)*e;return new Float64Array([h[e],h[e+o],h[e+a]])},LUTVolume.prototype.n3=function(t,i,s,h){var r,e=this.d-1,o=this.pR,a=this.pG,n=this.pB,u=this.nd,f=u*u,l=t+1+(i+1)*u+(s+1)*f,p=t<0?1:e<t?-1:0,c=i<0?1:e<i?-1:0,m=s<0?1:e<s?-1:0,t=this.mesh,i=f*u,e=2*i,s=l+p+c*u+m*f;o[3]=t[s],a[3]=t[s+i],n[3]=t[s+e],s+=p+c*u+m*f,o[2]=t[s],a[2]=t[s+i],n[2]=t[s+e],s+=p+c*u+m*f,o[1]=t[s],a[1]=t[s+i],n[1]=t[s+e],s+=p+c*u+m*f,o[0]=t[s],a[0]=t[s+i],n[0]=t[s+e],s=0,o[3]===o[1]?t[l]=o[2]:s=o[3]>o[1]?1:-1,0!==s&&(((r=-.4*o[0]+2.2*o[1]-4.2*o[2]+3.4*o[3])-o[2])*s<=0&&((r=o[1]-3*o[2]+3*o[3])-o[2])*s<=0&&(r=o[2]),t[l]=r),s=0,a[3]===a[1]?t[l+i]=a[2]:s=a[3]>a[1]?1:-1,0!==s&&(((r=-.4*a[0]+2.2*a[1]-4.2*a[2]+3.4*a[3])-a[2])*s<=0&&((r=a[1]-3*a[2]+3*a[3])-a[2])*s<=0&&(r=a[2]),t[l+i]=r),s=0,n[3]===n[1]?t[l+e]=n[2]:s=n[3]>n[1]?1:-1,0!==s&&(((r=-.4*n[0]+2.2*n[1]-4.2*n[2]+3.4*n[3])-n[2])*s<=0&&((r=n[1]-3*n[2]+3*n[3])-n[2])*s<=0&&(r=n[2]),t[l+e]=r)},LUTVolume.prototype.n3b=function(t,i,s){var h=this.d-1,r=this.pR,e=this.pG,o=this.pB,a=this.nd,n=a*a,u=t+1+(i+1)*a+(s+1)*n,f=t<=0?1:h<=t?-1:0,l=i<=0?1:h<=i?-1:0,p=s<=0?1:h<=s?-1:0,t=this.mesh,i=n*a,h=2*i,s=u+f+l*a+p*n;r[3]=t[s],e[3]=t[s+i],o[3]=t[s+h],s+=f+l*a+p*n,r[2]=t[s],e[2]=t[s+i],o[2]=t[s+h],s+=f+l*a+p*n,r[1]=t[s],e[1]=t[s+i],o[1]=t[s+h],s+=f+l*a+p*n,r[0]=t[s],e[0]=t[s+i],o[0]=t[s+h],t[u]=-.1*r[0]+.8*r[1]-2.3*r[2]+2.6*r[3],t[u+i]=-.1*e[0]+.8*e[1]-2.3*e[2]+2.6*e[3],t[u+h]=-.1*o[0]+.8*o[1]-2.3*o[2]+2.6*o[3]},LUTVolume.prototype.compare=function(t,i,s){var h=new Float64Array(t.slice(0)),r=new Float64Array(i.slice(0)),e=h.length;if(e!==r.length)return!1;void 0!==s?"1"===(s=s.toString().toLowerCase())||"tet"===s?this.RGBTet(r.buffer):"2"===s||"lin"===s?this.RGBLin(r.buffer):this.RGBCub(r.buffer):this.RGBCub(r.buffer);for(var o=new Float64Array(3),a=0;a<e;a+=3)o[0]+=Math.pow(r[a]-h[a],2),o[1]+=Math.pow(r[a+1]-h[a+1],2),o[2]+=Math.pow(r[a+2]-h[a+2],2);return o[0]=Math.pow(3*o[0]/e,.5),o[1]=Math.pow(3*o[1]/e,.5),o[2]=Math.pow(3*o[2]/e,.5),o},LUTVolume.prototype.NR3D=function(t,i,s,h){if(3!==t.length)return!1;var r,e,o,a,n="number"==typeof i?i:1e-8;n*=n,r="number"==typeof maxItrss?maxItrs:50,e=void 0!==h&&3===h.length?new Float64Array([h[0],h[1],h[2]],0):new Float64Array([t[0],t[1],t[2]],0);for(var u=0;u<r;u++){if(o=this.rgbCub(e),JInv=this.JInv(e),!JInv)return!1;if(o[0]-=t[0],o[1]-=t[1],o[2]-=t[2],e[3]=o[0]*o[0]+o[1]*o[1]+o[2]*o[2],e[3]<n)return e[3]=0,e;if(u===r-1)return e[3]=Math.pow(e[3],.5),e;e[0]-=a[0]*o[0]+JInv[1]*o[1]+JInv[2]*o[2],e[1]-=a[3]*o[0]+JInv[4]*o[1]+JInv[5]*o[2],e[2]-=a[6]*o[0]+JInv[7]*o[1]+JInv[8]*o[2]}},LUTVolume.prototype.minMax=function(){for(var t,i=this.mesh,s=new Float64Array([9999,9999,9999,-9999,-9999,-9999]),h=(new Float64Array(3),this.d),r=this.d+2,e=r*r*r,o=0;o<h;o++)for(var a=0;a<h;a++)for(var n=0;n<h;n++)i[t=n+1+(a+1+(o+1)*r)*r]<s[0]?s[0]=i[t]:i[t]>s[3]&&(s[3]=i[t]),i[t+=e]<s[1]?s[1]=i[t]:i[t]>s[4]&&(s[4]=i[t]),i[t+=e]<s[2]?s[2]=i[t]:i[t]>s[5]&&(s[5]=i[t]);return s},LUTVolume.prototype.getLimits=function(t){for(var i,s=this.mesh,h=void 0!==t?t:this.minMax(),r=new Float64Array([9999,9999,9999,-9999,9999,9999,-9999,-9999,9999,9999,-9999,9999,9999,-9999,-9999,9999,9999,-9999,-9999,9999,-9999,-9999,-9999,-9999]),e=new Float64Array(24),o=new Float64Array([9999,9999,9999,9999,9999,9999,9999,9999]),a=new Float64Array(3),n=this.d,u=this.d+2,f=u*u*u,l=n-1,p=0;p<n;p++)for(var c=0;c<n;c++)for(var m=0;m<n;m++)i=m+1+(c+1+(p+1)*u)*u,a[0]=s[i],i+=f,a[1]=s[i],i+=f,a[2]=s[i],(i=Math.pow(a[0]-h[0],2)+Math.pow(a[1]-h[1],2)+Math.pow(a[2]-h[2],2))<o[0]&&(r[0]=a[0],r[1]=a[1],r[2]=a[2],e[0]=m,e[1]=c,e[2]=p,o[0]=i),(i=Math.pow(a[0]-h[3],2)+Math.pow(a[1]-h[1],2)+Math.pow(a[2]-h[2],2))<o[1]&&(r[3]=a[0],r[4]=a[1],r[5]=a[2],e[3]=m,e[4]=c,e[5]=p,o[1]=i),(i=Math.pow(a[0]-h[3],2)+Math.pow(a[1]-h[4],2)+Math.pow(a[2]-h[2],2))<o[2]&&(r[6]=a[0],r[7]=a[1],r[8]=a[2],e[6]=m,e[7]=c,e[8]=p,o[2]=i),(i=Math.pow(a[0]-h[0],2)+Math.pow(a[1]-h[4],2)+Math.pow(a[2]-h[2],2))<o[3]&&(r[9]=a[0],r[10]=a[1],r[11]=a[2],e[9]=m,e[10]=c,e[11]=p,o[3]=i),(i=Math.pow(a[0]-h[0],2)+Math.pow(a[1]-h[4],2)+Math.pow(a[2]-h[5],2))<o[4]&&(r[12]=a[0],r[13]=a[1],r[14]=a[2],e[12]=m,e[13]=c,e[14]=p,o[4]=i),(i=Math.pow(a[0]-h[0],2)+Math.pow(a[1]-h[1],2)+Math.pow(a[2]-h[5],2))<o[5]&&(r[15]=a[0],r[16]=a[1],r[17]=a[2],e[15]=m,e[16]=c,e[17]=p,o[5]=i),(i=Math.pow(a[0]-h[3],2)+Math.pow(a[1]-h[1],2)+Math.pow(a[2]-h[5],2))<o[6]&&(r[18]=a[0],r[19]=a[1],r[20]=a[2],e[18]=m,e[19]=c,e[20]=p,o[6]=i),(i=Math.pow(a[0]-h[3],2)+Math.pow(a[1]-h[4],2)+Math.pow(a[2]-h[5],2))<o[7]&&(r[21]=a[0],r[22]=a[1],r[23]=a[2],e[21]=m,e[22]=c,e[23]=p,o[7]=i);for(var y=0;y<24;y++)e[y]/=l;if(this.sin&&new LUTRSpline({buff:this.ins.getL()}).R(e.buffer),this.fS)for(var F=this.fL,L=this.fLH,y=0;y<24;y+=3)e[y]=e[y]*L[0]+F[0],e[y+1]=e[y+1]*L[1]+F[1],e[y+2]=e[y+2]*L[2]+F[2];return{minMax:h,i:e,o:r}};var workerLUTString=getLUTString();function Ring(){this.title="",this.s=1024,this.r=1,this.p=!1,this.mod=!1}function getRingString(){var t,i="";for(t in i+=Ring.toString()+"\n",Ring.prototype)i+="Ring.prototype."+t+"="+Ring.prototype[t].toString()+"\n";return i}Ring.prototype.getSize=function(){return this.s},Ring.prototype.getDetails=function(){return{title:this.title,s:this.s,r:this.r,p:this.p,L:this.L.buffer}},Ring.prototype.setDetails=function(t){this.title=t.title,void 0!==t.L&&(this.L=new Float64Array(t.L),this.s=this.L.length,"boolean"==typeof t.p?("number"==typeof t.r?this.r=t.r:this.r=this.L[this.s-1]-this.L[0],this.p=t.p):(this.p=!1,this.r=0)),"number"==typeof t.mod?this.mod=t.mod:this.mod=!1},Ring.prototype.reset=function(){this.title="",this.s=1024,this.r=1,this.p=!1},Ring.prototype.setL=function(t){this.L=new Float64Array(t),this.s=this.L.length},Ring.prototype.getL=function(){return this.L.buffer},Ring.prototype.f=function(t){var i=this.s-1;(t%=1)<0&&(t+=1),t*=i;var s,h=Math.floor(t),r=this.L[h],e=h===i?((s=this.L[1]+this.r)-this.L[h-1])/2:0===h?((s=this.L[1])-this.L[i-1]+this.r)/2:((s=this.L[h+1])-this.L[h-1])/2,i=i-2<h?(this.L[(h+3)%i]+this.r-this.L[h])/2:(this.L[h+2]-this.L[h])/2;return(((2*r+e-2*s+i)*(t-=h)+(-3*r-2*e+3*s-i))*t+e)*t+r},Ring.prototype.fCub=function(t){return this.mod?this.cubMod(t):this.cub(t)},Ring.prototype.fLin=function(t){return this.mod?this.linMod(t):this.lin(t)},Ring.prototype.cub=function(t){var i=this.s-1;(t%=1)<0&&(t+=1),t*=i;var s,h=Math.floor(t),r=this.L[h],e=h===i?((s=this.L[1]+this.r)-this.L[h-1])/2:0===h?((s=this.L[1])-this.L[i-1]+this.r)/2:((s=this.L[h+1])-this.L[h-1])/2,i=i-2<h?(this.L[(h+3)%i]+this.r-this.L[h])/2:(this.L[h+2]-this.L[h])/2;return(((2*r+e-2*s+i)*(t-=h)+(-3*r-2*e+3*s-i))*t+e)*t+r},Ring.prototype.cubMod=function(t){var i=this.s-1;(t%=1)<0&&(t+=1),t*=i;var s,h=Math.floor(t),r=this.mod,e=.5*r,o=this.L[h],a=h===i?(s=this.L[1]+this.r,this.L[h-1]):0===h?(s=this.L[1],this.L[i-1]-this.r):(s=this.L[h+1],this.L[h-1]),i=i-2<h?this.L[(h+3)%i]+this.r:this.L[h+2];return e<o-a?a+=r:e<a-o&&(a-=r),e<o-s?s+=r:e<s-o&&(s-=r),e<o-i?i+=r:e<i-o&&(i-=r),(((2*(o%=r)+(a=((s%=r)-(a%=r))/2)-2*s+(i=((i%=r)-o)/2))*(t-=h)+(-3*o-2*a+3*s-i))*t+a)*t+o},Ring.prototype.lin=function(t){var i=this.s-1;(t%=1)<0&&(t+=1),t*=i;var s=Math.floor(t),t=t-s;return s===i?this.L[s]*(1-t)+(this.L[1]+this.r)*t:this.L[s]*(1-t)+this.L[s+1]*t},Ring.prototype.linMod=function(t){var i=this.s-1,s=this.mod,h=.5*s;(t%=1)<0&&(t+=1),t*=i;var r=Math.floor(t),e=t-r,t=this.L[r],r=r===i?this.L[1]+this.r:this.L[r+1];return h<t-r?r+=s:h<r-t&&(r-=s),t*(1-e)+(r%=s)*e},Ring.prototype.lLsCub=function(t){this.mod?this.cubsMod(t):this.cubs(t)},Ring.prototype.cubs=function(t){for(var i,s,h,r,e,o,a=new Float64Array(t),n=a.length,u=this.s-1,f=0;f<n;f++)a[f]=a[f]%1,a[f]<0&&(a[f]+=1),a[f]*=u,i=Math.floor(a[f]),h=2*(o=this.L[i])+(e=i===u?((s=this.L[1]+this.r)-this.L[i-1])/2:0===i?((s=this.L[1])-this.L[u-1]+this.r)/2:(s=this.L[i+1],(this.L[i+1]-this.L[i-1])/2))-2*s+(r=u-2<i?(this.L[(i+3)%u]+this.r-this.L[i])/2:(this.L[i+2]-this.L[i])/2),r=-3*o-2*e+3*s-r,e=e,o=o,a[f]-=i,a[f]=((h*a[f]+r)*a[f]+e)*a[f]+o},Ring.prototype.cubsMod=function(t){for(var i,s,h,r,e,o,a=new Float64Array(t),n=a.length,u=this.s-1,f=this.mod,l=.5*f,p=0;p<n;p++)a[p]=a[p]%1,a[p]<0&&(a[p]+=1),a[p]*=u,i=Math.floor(a[p]),l<(o=this.L[i])-(r=i===u?(s=this.L[1]+this.r,this.L[i-1]):0===i?(s=this.L[1],this.L[u-1]-this.r):(s=this.L[i+1],this.L[i-1]))?r+=f:l<r-o&&(r-=f),l<o-s?s+=f:l<s-o&&(s-=f),l<o-(h=u-2<i?this.L[(i+3)%u]+this.r:this.L[i+2])?h+=f:l<h-o&&(h-=f),h=2*(o%=f)+(e=((s%=f)-(r%=f))/2)-2*s+(r=((h%=f)-o)/2),r=-3*o-2*e+3*s-r,e=e,o=o,a[p]-=i,a[p]=((h*a[p]+r)*a[p]+e)*a[p]+o},Ring.prototype.lLsLin=function(t){this.mod?this.linsMod(t):this.lins(t)},Ring.prototype.lins=function(t){for(var i=new Float64Array(t),s=i.length,h=this.s-1,r=0;r<s;r++){i[r]=i[r]%1,i[r]<0&&(i[r]+=1),i[r]*=h;var e=Math.floor(i[r]),o=i[r]-e;e===top?i[r]=this.L[e]*(1-o)+(this.L[1]+this.r)*o:i[r]=this.L[e]*(1-o)+this.L[e+1]*o}},Ring.prototype.linMod=function(t){for(var i,s,h,r=new Float64Array(t),e=r.length,o=this.s-1,a=this.mod,n=.5*a,u=0;u<e;u++)r[u]=r[u]%1,r[u]<0&&(r[u]+=1),r[u]*=top,h=Math.floor(r[u]),i=r[u]-h,n<(s=this.L[h])-(h=h===o?this.L[1]+this.r:this.L[h+1])?h+=a:n<h-s&&(h-=a),h%=a,r[u]=s*(1-i)+h*i};var workerRingString=getRingString();